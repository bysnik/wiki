import{_ as i,c as a,o as t,ag as n}from"./chunks/framework.D4Vqf8I7.js";const o=JSON.parse('{"title":"tcpdump","description":"","frontmatter":{},"headers":[],"relativePath":"docs/disciplines/pm1/mdk11/tcpdump.md","filePath":"docs/disciplines/pm1/mdk11/tcpdump.md","lastUpdated":1760528747000}'),p={name:"docs/disciplines/pm1/mdk11/tcpdump.md"};function h(l,s,e,k,d,F){return t(),a("div",null,s[0]||(s[0]=[n(`<h1 id="tcpdump" tabindex="-1">tcpdump <a class="header-anchor" href="#tcpdump" aria-label="Permalink to &quot;tcpdump&quot;">​</a></h1><h2 id="_1-введение-что-такое-tcpdump" tabindex="-1"><strong>1. Введение: Что такое tcpdump?</strong> <a class="header-anchor" href="#_1-введение-что-такое-tcpdump" aria-label="Permalink to &quot;**1. Введение: Что такое tcpdump?**&quot;">​</a></h2><p><code>tcpdump</code> — это консольная утилита для перехвата и анализа сетевого трафика, проходящего через сетевой интерфейс. Это стандартный инструмент, присутствующий практически в любой Unix-подобной системе (Linux, BSD, macOS). Его часто называют «швейцарским ножом» сетевого администратора.</p><p><strong>Ключевые особенности:</strong></p><ul><li><strong>Мощность:</strong> Позволяет видеть raw-трафик, пакет за пакетом.</li><li><strong>Гибкость:</strong> Имеет чрезвычайно развитый язык фильтров для точного целевого захвата.</li><li><strong>Универсальность:</strong> Может декодировать огромное количество сетевых протоколов.</li><li><strong>Незаменимость:</strong> Работает там, где нет графического интерфейса (серверы, удаленные сессии).</li></ul><p><strong>Важное примечание о правах:</strong> Для захвата трафика требуются права суперпользователя. Всегда запускайте <code>tcpdump</code> через <code>sudo</code> или из-под root.</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tcpdump</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [опции] [фильтр]</span></span></code></pre></div><hr><h2 id="_2-основы-захвата-трафика" tabindex="-1"><strong>2. Основы захвата трафика</strong> <a class="header-anchor" href="#_2-основы-захвата-трафика" aria-label="Permalink to &quot;**2. Основы захвата трафика**&quot;">​</a></h2><p><strong>А. Выбор интерфейса</strong></p><p>По умолчанию <code>tcpdump</code> использует первый поднятый интерфейс (часто <code>eth0</code> или <code>ens192</code>). Чтобы выбрать интерфейс, используйте опцию <code>-i</code>.</p><ul><li><strong>Захват на конкретном интерфейсе:</strong><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tcpdump</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -i</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> eth0</span></span></code></pre></div></li><li><strong>Захват на всех интерфейсах:</strong><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tcpdump</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -i</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> any</span></span></code></pre></div></li><li><strong>Просмотр доступных интерфейсов:</strong><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tcpdump</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -D</span></span></code></pre></div></li></ul><p><strong>Б. Ключевые опции вывода</strong></p><ul><li><code>-n</code>: Не преобразовывать адреса в имена (no DNS resolution). <strong>Всегда используйте эту опцию</strong> для быстрого вывода и избежания лишнего DNS-трафика.</li><li><code>-nn</code>: Не преобразовывать ни адреса, ни порты. Еще более быстрый и четкий вывод.</li><li><code>-v</code>, <code>-vv</code>, <code>-vvv</code>: Увеличивают уровень детализации (verbosity) вывода (больше информации о пакетах).</li><li><code>-c &lt;число&gt;</code>: Остановить захват после получения указанного количества пакетов.<div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tcpdump</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -i</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> any</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -c</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 5</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -nn</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # Захватить 5 пакетов и выйти</span></span></code></pre></div></li><li><code>-w &lt;файл&gt;</code>: Записать сырые пакеты в файл (а не выводить на экран). Идеально для сохранения дампа для последующего анализа.<div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tcpdump</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -i</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> any</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -w</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> capture.pcap</span></span></code></pre></div></li><li><code>-r &lt;файл&gt;</code>: Читать пакеты из файла (а не с интерфейса). Анализ сохраненного дампа.<div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tcpdump</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -r</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> capture.pcap</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -nn</span></span></code></pre></div></li></ul><hr><h2 id="_3-фильтрация-сердце-tcpdump" tabindex="-1"><strong>3. Фильтрация: Сердце tcpdump</strong> <a class="header-anchor" href="#_3-фильтрация-сердце-tcpdump" aria-label="Permalink to &quot;**3. Фильтрация: Сердце tcpdump**&quot;">​</a></h2><p>Без фильтров вы утонете в море пакетов. Фильтры <code>tcpdump</code> основаны на синтаксисе <code>libpcap</code>/<code>BPF</code> (Berkeley Packet Filter).</p><p><strong>А. Фильтрация по хостам</strong></p><ul><li><strong>По IP-адресу:</strong><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tcpdump</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -i</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> any</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -nn</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> host</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 192.168.1.5</span></span></code></pre></div></li><li><strong>По отправителю (source) или получателю (destination):</strong><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tumpdump</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -i</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> any</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -nn</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> src</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 192.168.1.5</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tcpdump</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -i</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> any</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -nn</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dst</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 8.8.8.8</span></span></code></pre></div></li></ul><p><strong>Б. Фильтрация по портам и протоколам</strong></p><ul><li><strong>По порту:</strong><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tcpdump</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -i</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> any</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -nn</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> port</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 80</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tcpdump</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -i</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> any</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -nn</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dst</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> port</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 443</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tcpdump</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -i</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> any</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -nn</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> src</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> port</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 22</span></span></code></pre></div></li><li><strong>По диапазону портов:</strong><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tcpdump</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -i</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> any</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -nn</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> portrange</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 8000-9000</span></span></code></pre></div></li><li><strong>По протоколу:</strong><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tcpdump</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -i</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> any</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -nn</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> icmp</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   # Только ping-запросы</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tcpdump</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -i</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> any</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -nn</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tcp</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tcpdump</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -i</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> any</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -nn</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> udp</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tcpdump</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -i</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> any</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -nn</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> arp</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # Только ARP-запросы</span></span></code></pre></div></li></ul><p><strong>В. Комбинирование фильтров</strong></p><p>Можно использовать логические операторы для создания сложных условий.</p><ul><li><strong><code>and</code> (и) / <code>&amp;&amp;</code></strong><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Трафик с 192.168.1.5 на порт 80</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tcpdump</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -i</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> any</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -nn</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> src</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 192.168.1.5</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> and</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dst</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> port</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 80</span></span></code></pre></div></li><li><strong><code>or</code> (или) / <code>||</code></strong><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Трафик на порт 80 (HTTP) ИЛИ на порт 443 (HTTPS)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tcpdump</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -i</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> any</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -nn</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> port</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 80</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> or</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> port</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 443</span></span></code></pre></div></li><li><strong><code>not</code> (не) / <code>!</code></strong><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Весь трафик, КРОМЕ SSH (порт 22)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tcpdump</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -i</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> any</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -nn</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> not</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> port</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 22</span></span></code></pre></div></li><li><strong>Группировка с скобками:</strong> Скобки нужно экранировать от shell.<div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Трафик от (источник 1.1.1.1 ИЛИ 8.8.8.8) на порт 53</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tcpdump</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -i</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> any</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -nn</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;(src host 1.1.1.1 or src host 8.8.8.8) and dst port 53&quot;</span></span></code></pre></div></li></ul><hr><h2 id="_4-глубокии-анализ-заглядываем-внутрь-пакетов" tabindex="-1"><strong>4. Глубокий анализ: Заглядываем внутрь пакетов</strong> <a class="header-anchor" href="#_4-глубокии-анализ-заглядываем-внутрь-пакетов" aria-label="Permalink to &quot;**4. Глубокий анализ: Заглядываем внутрь пакетов**&quot;">​</a></h2><p><strong>А. Анализ конкретных полей пакетов</strong></p><p>Можно фильтровать не только по заголовкам, но и по данным внутри пакета.</p><ul><li><strong>Фильтр по флагам TCP:</strong><ul><li><code>tcp[13]</code> обращается к 13-му байту заголовка TCP, где хранятся флаги.</li><li><code>tcp-fin</code>, <code>tcp-syn</code>, <code>tcp-rst</code>, <code>tcp-push</code>, <code>tcp-ack</code>, <code>tcp-urg</code> — это предопределенные маски для этих флагов.</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Захватить только SYN-пакеты (начало TCP-сессии)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tcpdump</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -i</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> any</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -nn</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;tcp[tcpflags] &amp; tcp-syn != 0&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Захватить только RST-пакеты (принудительный разрыв)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tcpdump</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -i</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> any</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -nn</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;tcp[tcpflags] &amp; tcp-rst != 0&quot;</span></span></code></pre></div></li></ul><p><strong>Б. Чтение содержимого пакетов</strong></p><ul><li><code>-X</code>: Выводить содержимое пакета в hex и ASCII. Полезно для анализа Application Layer (HTTP, SMTP и т.д.).</li><li><code>-A</code>: Выводить содержимое пакета только в ASCII (удобно для текстовых протоколов).<div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Посмотреть содержимое HTTP-запросов</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tcpdump</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -i</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> any</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -nn</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -A</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> port</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 80</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Посмотреть содержимое и в hex, и в ASCII (например, для бинарных протоколов)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tcpdump</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -i</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> any</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -nn</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -X</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> port</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 25</span></span></code></pre></div></li></ul><hr><h2 id="_5-практические-примеры-для-диагностики" tabindex="-1"><strong>5. Практические примеры для диагностики</strong> <a class="header-anchor" href="#_5-практические-примеры-для-диагностики" aria-label="Permalink to &quot;**5. Практические примеры для диагностики**&quot;">​</a></h2><p><strong>Пример 1: Диагностика DNS</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Весь DNS-трафик (порт 53) с выводом содержимого</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tcpdump</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -i</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> any</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -nn</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -X</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> port</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 53</span></span></code></pre></div><p><strong>Пример 2: Поиск проблем с сетью</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Посмотреть, есть ли RST-пакеты, обрывающие соединение</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tcpdump</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -i</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> any</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -nn</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;tcp[tcpflags] &amp; tcp-rst != 0&quot;</span></span></code></pre></div><p><strong>Пример 3: Анализ веб-трафика конкретного хоста</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Весь HTTP/HTTPS трафик до/от сервера 10.0.0.10</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tcpdump</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -i</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> any</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -nn</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> host</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10.0.0.10</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> and</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">port</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 80</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> or</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> port</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 443</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\)</span></span></code></pre></div><p><strong>Пример 4: Поиск широковещательного (broadcast) трафика в сети</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tcpdump</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -i</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> any</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -nn</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> broadcast</span></span></code></pre></div><hr><h2 id="_6-советы-и-лучшие-практики" tabindex="-1"><strong>6. Советы и лучшие практики</strong> <a class="header-anchor" href="#_6-советы-и-лучшие-практики" aria-label="Permalink to &quot;**6. Советы и лучшие практики**&quot;">​</a></h2><ol><li><strong>Всегда используйте <code>-nn</code>:</strong> Избегает лишних DNS-запросов и делает вывод чище.</li><li><strong>Сужайте фокус:</strong> Всегда используйте фильтры. Захват всего трафика (<code>tcpdump -i any</code>) на загруженном интерфейсе может «убить» вашу сессию.</li><li><strong>Пишите в файл для анализа:</strong> Для анализа сложных проблем сначала сохраните трафик в файл (<code>-w</code>), а потом анализируйте его (<code>-r</code>) в спокойной обстановке.</li><li><strong>Комбинируйте с другими утилитами:</strong> <code>tcpdump</code> можно использовать вместе с <code>grep</code>, <code>awk</code>, <code>less</code> для дальнейшей обработки.<div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tcpdump</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -i</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> any</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -nn</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -l</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> grep</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;something&#39;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # -l для line buffering</span></span></code></pre></div></li><li><strong>Изучите Wireshark:</strong> <code>tcpdump</code> идеален для захвата на серверах. Для глубокого анализа сложных проблем с красивым GUI используйте Wireshark. Вы можете сохранить дамп в <code>tcpdump</code> (<code>-w</code>), а потом открыть его в Wireshark.</li></ol><hr><h2 id="_7-заключение" tabindex="-1"><strong>7. Заключение</strong> <a class="header-anchor" href="#_7-заключение" aria-label="Permalink to &quot;**7. Заключение**&quot;">​</a></h2><p><code>tcpdump</code> — это не просто утилита, это фундаментальный навык для любого ИТ-специалиста, работающего с сетями. Потратьте время на то, чтобы освоить его синтаксис фильтров. Это сэкономит вам countless hours при диагностике проблем и даст вам глубокое понимание того, как на самом деле работают сетевые приложения.</p><p><strong>Домашнее задание:</strong> Запустите <code>tcpdump -i any -nn</code> в одной консоли и сделайте <code>ping google.com</code> в другой. Посмотрите на вывод и попробуйте разобраться в каждом поле вывода. Повторите то же самое для <code>curl http://example.com</code>.</p>`,48)]))}const g=i(p,[["render",h]]);export{o as __pageData,g as default};
