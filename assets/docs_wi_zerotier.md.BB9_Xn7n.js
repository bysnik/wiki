import{_ as i,c as a,o as n,ag as e}from"./chunks/framework.D4Vqf8I7.js";const c=JSON.parse('{"title":"ZeroTier","description":"","frontmatter":{"outline":"deep"},"headers":[],"relativePath":"docs/wi/zerotier.md","filePath":"docs/wi/zerotier.md","lastUpdated":1759480092000}'),p={name:"docs/wi/zerotier.md"};function t(l,s,h,k,r,d){return n(),a("div",null,s[0]||(s[0]=[e(`<h1 id="zerotier" tabindex="-1">ZeroTier <a class="header-anchor" href="#zerotier" aria-label="Permalink to &quot;ZeroTier&quot;">​</a></h1><p><img src="https://www.zerotier.com/wp-content/uploads/2025/01/Default-OG-Image.jpg" alt=""></p><p>ZeroTier — это программное обеспечение с открытым исходным кодом, предназначенное для создания виртуальных частных сетей (VPN) на основе концепции «сети как услуги» (Network as a Service). Оно позволяет объединять устройства, находящиеся в разных физических сетях и географических локациях, в одну логическую сеть, как если бы они были подключены к одному локальному коммутатору. Это особенно полезно для удалённой работы, распределённых команд, IoT-устройств или гибридных облачных инфраструктур, где требуется безопасное и прозрачное сетевое взаимодействие.</p><p>Архитектура ZeroTier основана на децентрализованной модели с использованием глобальной распределённой системы управления, называемой планетой (Planet). Планета — это набор публичных корневых серверов (roots), которые обеспечивают начальное обнаружение узлов и маршрутизацию между ними. Каждая сеть в ZeroTier идентифицируется 64-битным идентификатором и управляется через веб-интерфейс или API. Администратор может настраивать правила доступа, IP-адресацию, маршруты и другие параметры, не требуя сложной настройки на каждом клиенте.</p><p>Когда устройство (нода) подключается к сети ZeroTier, оно получает виртуальный сетевой интерфейс с собственным MAC- и IP-адресом. Весь трафик между узлами шифруется с использованием современных криптографических протоколов (на основе Curve25519, Salsa20 и Poly1305), что обеспечивает высокий уровень безопасности. ZeroTier использует технологию peer-to-peer (P2P): как только узлы обнаруживают друг друга через корневые серверы, они стремятся установить прямое соединение, минуя центральные серверы, что снижает задержки и нагрузку на инфраструктуру.</p><p>Если прямое P2P-соединение невозможно (например, из-за NAT или файрволов), ZeroTier автоматически переключается на ретрансляцию трафика через промежуточные реле-серверы (relays), обеспечивая работоспособность сети в любых условиях. При этом вся логика маршрутизации и авторизации остаётся прозрачной для пользователя — достаточно установить клиент и присоединиться к нужной сети по её идентификатору.</p><p>ZeroTier поддерживает все основные операционные системы — Windows, macOS, Linux, Android, iOS, а также может работать на маршрутизаторах и встраиваемых устройствах. Это делает его универсальным решением для создания защищённых и масштабируемых сетей без необходимости в сложной настройке традиционных VPN-серверов или специализированного оборудования.</p><p>Важно отметить, что, несмотря на использование централизованных компонентов (планеты и реле), ZeroTier сохраняет контроль за сетью в руках её владельца: администратор полностью управляет политиками доступа, а трафик между доверенными узлами остаётся зашифрованным и не подвержен вмешательству со стороны третьих лиц, включая саму компанию ZeroTier. Это сочетание простоты, безопасности и гибкости делает ZeroTier популярным выбором как для частных пользователей, так и для корпоративных сред.</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>Ссылка на последнюю версю пакета для Альт Линукс <a href="https://git.altlinux.org/tasks/337183/build/100/x86_64/rpms/zerotier-one-1.12.2-alt1.x86_64.rpm" target="_blank" rel="noreferrer">https://git.altlinux.org/tasks/337183/build/100/x86_64/rpms/zerotier-one-1.12.2-alt1.x86_64.rpm</a></p><p>Сейчас последняя версия это 1.16.0, а для альта - 1.12.2, так как он был удалён из репозитория <a href="https://packages.altlinux.org/ru/sisyphus/srpms/zerotier-one/" target="_blank" rel="noreferrer">https://packages.altlinux.org/ru/sisyphus/srpms/zerotier-one/</a></p><p>Вот графический интерфейс контроллера: <a href="https://github.com/key-networks/ztncui" target="_blank" rel="noreferrer">https://github.com/key-networks/ztncui</a></p><p>Вот графический интерфейс клиента: <a href="https://github.com/zerotier/DesktopUI" target="_blank" rel="noreferrer">https://github.com/zerotier/DesktopUI</a></p></div><h2 id="мои-вроде-как-успешные-потуги-по-сборке-последнеи-версии" tabindex="-1">Мои, вроде как, успешные потуги по сборке последней версии <a class="header-anchor" href="#мои-вроде-как-успешные-потуги-по-сборке-последнеи-версии" aria-label="Permalink to &quot;Мои, вроде как, успешные потуги по сборке последней версии&quot;">​</a></h2><p>Тут описаны мои потуги по сборке последней версии ZeroTierOne для Альт Линукс П11 (версия 1.16.0 на момент написания статьи).</p><ol><li>Устновка необходимых пакетов (скорее всего тут перечислены не все)</li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">apt-get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rpmdevtools</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rpm-build</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gcc-c++</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> git-core</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gem-ronn-ng</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gem-ronn</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ronn</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> libstdc++-devel</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> libminiupnpc-devel</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rust</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rust-cargo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> udev-rules</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> clang</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> libssl-devel</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> libminiupnpc-devel</span></span></code></pre></div><ol start="2"><li>Не знаю почему, но я не использовал GEAR, так что собирал чисто с помощью rpmbuild. Подготавливаем дерево каталогов для сборки:</li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rpmdev-setuptree</span></span></code></pre></div><ol start="3"><li>Просто куда-нибудь клонируем два репозитория: один с исходниками и готовой спекой для 1.12 версии, и второй - последняя версия от разработчиков:</li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> clone</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://git.altlinux.org/gears/z/zerotier-one.git</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> clone</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://github.com/zerotier/ZeroTierOne.git</span></span></code></pre></div><ol start="4"><li>Переходим в директорию с 1.12 версией и начинаем шаманить:</li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> zerotier-one</span></span></code></pre></div><ul><li>Редактируем спеку, меняем только версию (можно ещё changelog написать, если охота):</li></ul><div class="language-spec vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">spec</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Version: 1.16.0</span></span></code></pre></div><ul><li>Копируем спеку в директорию сборки:</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> zerotier-one.spec</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~/RPM/SPECS/</span></span></code></pre></div><ul><li>Создаем директорию:</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mkdir</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> zerotier-one-development-1.16.0</span></span></code></pre></div><ul><li>Копируем какие-то растовские файлы:</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cp</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -R</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> zerotier-one/zeroidc</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> zerotier-one-development-1.16.0/</span></span></code></pre></div><ul><li>Проваливаемся в скопированные файлы:</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> zerotier-one-development/zeroidc</span></span></code></pre></div><ul><li>Генерируем директорию vendor:</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cargo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> vendor</span></span></code></pre></div><ul><li>Переносим сгенерированную директорию:</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mv</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ./vendor</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ../</span></span></code></pre></div><p>Должна получиться следующая структура:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">zerotier-one-development-1.16.0/</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">├──</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> vendor</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">└──</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> zeroidc</span></span></code></pre></div><ul><li>Поднимаемся на уровень выше:</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ..</span></span></code></pre></div><ul><li>Архивируем директорию и сразу переносим её в нашу сборочницу:</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tar</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cvf</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~/RPM/SOURCES/zerotier-one-development-1.16.0.tar</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> zerotier-one-development-1.16.0</span></span></code></pre></div><ol start="5"><li>Теперь работаем с исходниками.</li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ..</span></span></code></pre></div><ul><li>После клонирования должна быть директория ZeroTierOne. Переименовываем её:</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mv</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ZeroTierOne</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> zerotier-one-1.16.0</span></span></code></pre></div><ul><li>Архивируем директорию и сразу переносим её в нашу сборочницу:</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tar</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cvf</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~/RPM/SOURCES/zerotier-one-1.16.0.tar</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> zerotier-one-1.16.0</span></span></code></pre></div><ol start="6"><li>Если всё сделано правильно и я нигде не ошибся при описании, то можно проводить сборку пакета:</li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rpmbuild</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -ba</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~/RPM/SPECS/zerotier-one.spec</span></span></code></pre></div><ol start="7"><li>По завершению сборки должен появиться пакет <code>~/RPM/RPMS/x86_64/zerotier-one-1.16.0-alt1.x86_64.rpm</code>, который можно попробовать установить:</li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">apt-get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~/RPM/RPMS/x86_64/zerotier-one-1.16.0-alt1.x86_64.rpm</span></span></code></pre></div><ol start="8"><li>Проверьте его статус после установки (он не должен быть запущен) и действуйте дальше сами):</li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> status</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> zerotie-one</span></span></code></pre></div><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>Эта инструкция далеко не истина в последней инстанции. Собирал по наитию, как ёжик в тумане. А устанавливал этот пакет я вообще поверх уже установленной версии 1.12.2, и вот что плохое у меня случилось:</p><ol><li>Вроде как, консольные утилиты раньше можно было использовать не под рутом, а теперь они работают только под рутом (по хорошему перепроверить бы, память уже подводит) ).</li><li>После обновления, ztncui, не смотря на то, что увидел zerotier, выдает ошибку HTTPError: Response code 404 (Not Found), но при этом ZeroTier version 1.16.0 он определяет. Вот за это всё-таки обидно.</li></ol><p>P.S. по пункту 2:</p><p>Открыл я тут ZeroTier Release Notes 2025-08-21 -- Version 1.16.0 и вот что тут написано: <code>The network controller (\`controller/\`) is now under a commercial source-available license. Default binary builds no longer contain the controller.</code></p><p>То есть, он теперь идёт отдельно и не поставляется вместе с клиентом, который я собирал. Ну, теперь хотя бы понятно, почему вебморда контроллера не работает как надо)</p><p>Но при этом у меня продолжила спокойно работать сеть, созданная на сайте zerotier.com, панель управления увидила, что у меня последняя версия.</p><p>P.S.2 по пункту 2:</p><p>Контроллер по-прежнему существует в основном репозитории ZeroTierOne, но теперь находится в подкаталоге: ZeroTierOne/nonfree/controller/</p><p>Для некоммерческого использования: можно попробовать собрать из исходников с <code>ZT_NONFREE=1</code>. (<code>git clone https://github.com/zerotier/ZeroTierOne.git &amp;&amp; cd ZeroTierOne &amp;&amp; make ZT_NONFREE=1 &amp;&amp; sudo ./zerotier-one -D /var/lib/zerotier-one-controller</code> (насчёт последней команды запуская я не уверен) Возможно попробую потом на чистой машине это сделать)</p></div><p>В принципе, я считаю, что шалость удалась. Вот сама собранная rpm\`ка если кому надо: <a href="https://raw.githubusercontent.com/bysnik/wiki/main/rpms/zerotier-one-1.16.0-alt1.x86_64.rpm" target="_blank" rel="noreferrer">zerotier-one-1.16.0-alt1.x86_64.rpm</a></p><h2 id="desktop-ui" tabindex="-1">Desktop UI <a class="header-anchor" href="#desktop-ui" aria-label="Permalink to &quot;Desktop UI&quot;">​</a></h2><p>Соберём и сделаем автозапуск графического интерфейса, который будет висеть в трее. С помощью него можно подключаться к сетям и чёт там настраивать.</p><ol><li>Клонируем репозиторий:</li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> clone</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://github.com/zerotier/DesktopUI.git</span></span></code></pre></div><ol start="2"><li>Переходим в корень склонированного репозитория. Дальше я никуда перемещаться не буду. Все пути будут описаны от этой точки.</li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DesktopUI</span></span></code></pre></div><ol start="3"><li>Устанавливаем необходимые пакеты:</li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">apt-get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> meson</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ninja-build</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> libgtk+3-devel</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pkg-config</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> libayatana-appindicator3-devel</span></span></code></pre></div><ol start="4"><li>Редактируем файл <code>tray/Makefile</code> строки 24 и 25:</li></ol><div class="language-Makefile vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">Makefile</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">TRAY_CFLAGS := </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">$(</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">OPT_FLAGS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> -DTRAY_APPINDICATOR=1 </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">$(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">shell</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pkg-config --cflags appindicator3-0.1)</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> -std=c99</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">TRAY_LDFLAGS := </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">$(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">shell</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pkg-config --libs appindicator3-0.1)</span></span></code></pre></div><p>Необходимо заменить <code>appindicator3-0.1</code> на <code>ayatana-appindicator3-0.1</code>.</p><ol start="5"><li>Редактируем файл <code>tray/tray.h</code> строку 34</li></ol><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;libappindicator/app-indicator.h&gt;</span></span></code></pre></div><p>Необходимо заменить <code>libappindicator/app-indicator.h</code> на <code>libayatana-appindicator/app-indicator.h</code></p><ol start="6"><li>Редактируем файл <code>build.rs</code> строку 17:</li></ol><div class="language-rust vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">println!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;cargo:rustc-link-lib=dylib=appindicator3&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><p>Необходимо заменить <code>appindicator3</code> на <code>ayatana-appindicator3</code>.</p><ol start="7"><li>Начинаем процесс сборки:</li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">make</span></span></code></pre></div><ol start="8"><li>Далее будет настраивать автозапуск. Переносим собранный бинарный файл:</li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mv</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ./target/debug/zerotier_desktop_ui</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /usr/local/bin/</span></span></code></pre></div><ol start="9"><li>Будем создавать пользовательский юнит systemd. Создаём директорию для юнитов (если её нет):</li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mkdir</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~/.config/systemd/user</span></span></code></pre></div><ol start="10"><li>Создаём файл юнита:</li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nano</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~/.config/systemd/user/zerotier-desktop-ui.service</span></span></code></pre></div><ol start="11"><li>Вставляем следующее содержимое:</li></ol><div class="language-systemd vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">systemd</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">[Unit]</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">Description</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ZeroTier Desktop UI</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">After</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">graphical-session.target</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">PartOf</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">graphical-session.target</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">[Service]</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">Type</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">simple</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">ExecStart</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/usr/local/bin/zerotier_desktop_ui</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">Restart</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">on-failure</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">RestartSec</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">Environment</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">DISPLAY</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:0</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">Environment</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">XDG_RUNTIME_DIR</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/run/user/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">%U</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">[Install]</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">WantedBy</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">default.target</span></span></code></pre></div><ol start="12"><li>Перезагрузка конфигурации systemd для пользователя:</li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --user</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> daemon-reload</span></span></code></pre></div><ol start="13"><li>Включение автозапуска:</li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --user</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> enable</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> zerotier-desktop-ui.service</span></span></code></pre></div><ol start="14"><li>Запустк сервиса:</li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --user</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> start</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> zerotier-desktop-ui.service</span></span></code></pre></div><h3 id="немного-ии-шаманства" tabindex="-1">Немного ИИ шаманства <a class="header-anchor" href="#немного-ии-шаманства" aria-label="Permalink to &quot;Немного ИИ шаманства&quot;">​</a></h3><p>За эту работу пока что не ручаюсь, ибо это просто черновик)</p><p>Ниже приведён пример <strong>полноценного <code>.spec</code> файла</strong>, который учитывает все шаги, включая патчи под <code>ayatana-appindicator</code>, сборку через <code>make</code>, установку бинарника и создание systemd user unit.</p><h4 id="zerotier-desktop-ui-spec" tabindex="-1"><code>zerotier-desktop-ui.spec</code> <a class="header-anchor" href="#zerotier-desktop-ui-spec" aria-label="Permalink to &quot;\`zerotier-desktop-ui.spec\`&quot;">​</a></h4><div class="language-spec vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">spec</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># Замените на актуальную версию, если известна</span></span>
<span class="line"><span>%global commit 0000000000000000000000000000000000000000</span></span>
<span class="line"><span>%global shortcommit %(echo %{commit} | cut -c1-7)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Name:           zerotier-desktop-ui</span></span>
<span class="line"><span>Version:        1.8.3</span></span>
<span class="line"><span>Release:        alt1</span></span>
<span class="line"><span>Summary:        ZeroTier Desktop UI — system tray application for managing ZeroTier networks</span></span>
<span class="line"><span></span></span>
<span class="line"><span>License:        GPL-3.0-or-later</span></span>
<span class="line"><span>URL:            https://github.com/zerotier/DesktopUI</span></span>
<span class="line"><span>Source0:        https://github.com/zerotier/DesktopUI/archive/%{commit}/%{name}-%{shortcommit}.tar.gz</span></span>
<span class="line"><span></span></span>
<span class="line"><span># Build dependencies</span></span>
<span class="line"><span>BuildRequires:  meson</span></span>
<span class="line"><span>BuildRequires:  ninja-build</span></span>
<span class="line"><span>BuildRequires:  pkgconfig(gtk+-3.0)</span></span>
<span class="line"><span>BuildRequires:  pkgconfig(ayatana-appindicator3-0.1)</span></span>
<span class="line"><span>BuildRequires:  rust</span></span>
<span class="line"><span>BuildRequires:  cargo</span></span>
<span class="line"><span></span></span>
<span class="line"><span># Runtime dependencies</span></span>
<span class="line"><span>Requires:       zerotier-one</span></span>
<span class="line"><span>Requires:       libayatana-appindicator3</span></span>
<span class="line"><span></span></span>
<span class="line"><span># Патчи для совместимости с Ayatana AppIndicator</span></span>
<span class="line"><span>Patch0:         use-ayatana-appindicator.patch</span></span>
<span class="line"><span></span></span>
<span class="line"><span>%description</span></span>
<span class="line"><span>ZeroTier Desktop UI is a system tray application that allows you to manage ZeroTier networks</span></span>
<span class="line"><span>from your desktop environment. This RPM builds the UI with Ayatana AppIndicator support.</span></span>
<span class="line"><span></span></span>
<span class="line"><span>%prep</span></span>
<span class="line"><span>%autosetup -n DesktopUI-%{commit}</span></span>
<span class="line"><span></span></span>
<span class="line"><span># Применяем патч для замены appindicator → ayatana-appindicator</span></span>
<span class="line"><span>%patch0 -p1</span></span>
<span class="line"><span></span></span>
<span class="line"><span>%build</span></span>
<span class="line"><span># Сборка через make (внутри Makefile вызывается cargo и meson)</span></span>
<span class="line"><span>make %{?_smp_mflags}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>%install</span></span>
<span class="line"><span># Очистка</span></span>
<span class="line"><span>rm -rf %{buildroot}</span></span>
<span class="line"><span></span></span>
<span class="line"><span># Установка бинарника</span></span>
<span class="line"><span>install -Dm755 target/debug/zerotier_desktop_ui \\</span></span>
<span class="line"><span>    %{buildroot}%{_bindir}/zerotier_desktop_ui</span></span>
<span class="line"><span></span></span>
<span class="line"><span># Установка systemd user unit</span></span>
<span class="line"><span>install -Dm644 packaging/systemd/zerotier-desktop-ui.service \\</span></span>
<span class="line"><span>    %{buildroot}%{_userunitdir}/zerotier-desktop-ui.service</span></span>
<span class="line"><span></span></span>
<span class="line"><span>%files</span></span>
<span class="line"><span>%license LICENSE</span></span>
<span class="line"><span>%{_bindir}/zerotier_desktop_ui</span></span>
<span class="line"><span>%{_userunitdir}/zerotier-desktop-ui.service</span></span>
<span class="line"><span></span></span>
<span class="line"><span>%changelog</span></span>
<span class="line"><span>* Mon Oct 01 2025 Your Name &lt;your@email.com&gt; - 1.8.3-alt1</span></span>
<span class="line"><span>- Initial RPM package for ZeroTier Desktop UI with Ayatana AppIndicator support</span></span></code></pre></div><hr><h4 id="структура-сопутствующих-фаилов" tabindex="-1">Структура сопутствующих файлов <a class="header-anchor" href="#структура-сопутствующих-фаилов" aria-label="Permalink to &quot;Структура сопутствующих файлов&quot;">​</a></h4><p>Вам понадобится создать <strong>патч</strong>, который автоматизирует изменения, описанные в шагах 4–6.</p><h5 id="use-ayatana-appindicator-patch" tabindex="-1"><code>use-ayatana-appindicator.patch</code> <a class="header-anchor" href="#use-ayatana-appindicator-patch" aria-label="Permalink to &quot;\`use-ayatana-appindicator.patch\`&quot;">​</a></h5><div class="language-diff vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">diff</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">diff --git a/tray/Makefile b/tray/Makefile</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">index xxxxxxx..yyyyyyy 100644</span></span>
<span class="line"><span style="--shiki-light:#B31D28;--shiki-dark:#FDAEB7;">--- a/tray/Makefile</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+++ b/tray/Makefile</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-light-font-weight:bold;--shiki-dark:#B392F0;--shiki-dark-font-weight:bold;">@@ -21,8 +21,8 @@</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> OPT_FLAGS := -O2 -g -Wall -Wextra -Werror</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> # For AppIndicator support</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> TRAY_CFLAGS := $(OPT_FLAGS) -DTRAY_APPINDICATOR=1 $(shell pkg-config --cflags appindicator3-0.1) -std=c99</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> TRAY_LDFLAGS := $(shell pkg-config --libs appindicator3-0.1)</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+TRAY_CFLAGS := $(OPT_FLAGS) -DTRAY_APPINDICATOR=1 $(shell pkg-config --cflags ayatana-appindicator3-0.1) -std=c99</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+TRAY_LDFLAGS := $(shell pkg-config --libs ayatana-appindicator3-0.1)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> # Default target</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> all: tray</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">diff --git a/tray/tray.h b/tray/tray.h</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">index xxxxxxx..yyyyyyy 100644</span></span>
<span class="line"><span style="--shiki-light:#B31D28;--shiki-dark:#FDAEB7;">--- a/tray/tray.h</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+++ b/tray/tray.h</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-light-font-weight:bold;--shiki-dark:#B392F0;--shiki-dark-font-weight:bold;">@@ -31,7 +31,7 @@</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> #ifdef TRAY_APPINDICATOR</span></span>
<span class="line"><span style="--shiki-light:#B31D28;--shiki-dark:#FDAEB7;">-#include &lt;libappindicator/app-indicator.h&gt;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+#include &lt;libayatana-appindicator/app-indicator.h&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> #endif</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> struct tray_menu;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">diff --git a/build.rs b/build.rs</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">index xxxxxxx..yyyyyyy 100644</span></span>
<span class="line"><span style="--shiki-light:#B31D28;--shiki-dark:#FDAEB7;">--- a/build.rs</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+++ b/build.rs</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-light-font-weight:bold;--shiki-dark:#B392F0;--shiki-dark-font-weight:bold;">@@ -14,7 +14,7 @@</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> fn main() {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">     if cfg!(target_os = &quot;linux&quot;) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">         if cfg!(feature = &quot;appindicator&quot;) {</span></span>
<span class="line"><span style="--shiki-light:#B31D28;--shiki-dark:#FDAEB7;">-            println!(&quot;cargo:rustc-link-lib=dylib=appindicator3&quot;);</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+            println!(&quot;cargo:rustc-link-lib=dylib=ayatana-appindicator3&quot;);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">         }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">     }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }</span></span></code></pre></div><blockquote><p>💡 <strong>Примечание</strong>: точные строки могут отличаться — убедитесь, что патч корректно применяется. Можно сгенерировать его командой <code>diff -u</code> после внесения изменений.</p></blockquote><hr><h4 id="дополнительно-systemd-unit" tabindex="-1">Дополнительно: systemd unit <a class="header-anchor" href="#дополнительно-systemd-unit" aria-label="Permalink to &quot;Дополнительно: systemd unit&quot;">​</a></h4><p>Создайте папку <code>packaging/systemd/</code> в корне исходников и поместите туда:</p><h5 id="packaging-systemd-zerotier-desktop-ui-service" tabindex="-1"><code>packaging/systemd/zerotier-desktop-ui.service</code> <a class="header-anchor" href="#packaging-systemd-zerotier-desktop-ui-service" aria-label="Permalink to &quot;\`packaging/systemd/zerotier-desktop-ui.service\`&quot;">​</a></h5><div class="language-ini vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ini</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">[Unit]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Description</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=ZeroTier Desktop UI</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">After</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=graphical-session.target</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">PartOf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=graphical-session.target</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">[Service]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=simple</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ExecStart</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=%{_bindir}/zerotier_desktop_ui</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Restart</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=on-failure</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RestartSec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=5</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Environment</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">DISPLAY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=:0</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Environment</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">XDG_RUNTIME_DIR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=/run/user/%U</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">[Install]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">WantedBy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=default.target</span></span></code></pre></div><blockquote><p>В <code>.spec</code> файле используется макрос <code>%{_userunitdir}</code>, который в Fedora/RHEL обычно раскрывается в <code>/usr/lib/systemd/user</code>.</p></blockquote><hr><h4 id="как-собрать-rpm" tabindex="-1">Как собрать RPM <a class="header-anchor" href="#как-собрать-rpm" aria-label="Permalink to &quot;Как собрать RPM&quot;">​</a></h4><ol><li><p>Установите зависимости:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apt-get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rpm-build</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> meson</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ninja-build</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gtk3-devel</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> libayatana-appindicator3-devel</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rust</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cargo</span></span></code></pre></div></li><li><p>Подготовьте дерево:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mkdir</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~/rpmbuild/{SOURCES,SPECS}</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> zerotier-desktop-ui.spec</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~/rpmbuild/SPECS/</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> use-ayatana-appindicator.patch</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~/rpmbuild/SOURCES/</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Скачайте исходники (или используйте spectool -g)</span></span></code></pre></div></li><li><p>Соберите:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rpmbuild</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -ba</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~/rpmbuild/SPECS/zerotier-desktop-ui.spec</span></span></code></pre></div></li></ol><hr><h4 id="что-делает-этот-пакет" tabindex="-1">Что делает этот пакет: <a class="header-anchor" href="#что-делает-этот-пакет" aria-label="Permalink to &quot;Что делает этот пакет:&quot;">​</a></h4><ul><li>Собирает UI с поддержкой <strong>Ayatana AppIndicator</strong> (актуально для Fedora, RHEL, openSUSE и др.)</li><li>Устанавливает бинарник в <code>/usr/bin/</code></li><li>Устанавливает <strong>systemd user unit</strong> в <code>/usr/lib/systemd/user/</code></li><li>Пользователь может включить автозапуск командой:<div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --user</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> enable</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --now</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> zerotier-desktop-ui.service</span></span></code></pre></div></li></ul><blockquote><p>⚠️ Обратите внимание: пользователь должен быть в графической сессии (graphical session), и <code>XDG_RUNTIME_DIR</code> должен быть установлен (обычно это делает display manager).</p></blockquote>`,110)]))}const g=i(p,[["render",t]]);export{c as __pageData,g as default};
