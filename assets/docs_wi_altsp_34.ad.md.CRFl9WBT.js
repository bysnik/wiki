import{_ as i,c as a,o as t,ag as e}from"./chunks/framework.D4Vqf8I7.js";const l="/wiki/assets/authsamba.D665AD1N.png",p="/wiki/assets/listall.XYzEffCk.png",n="/wiki/assets/getlink.VUX4tnL0.png",u=JSON.parse('{"title":"Простая настройка простого контроллера домена","description":"","frontmatter":{},"headers":[],"relativePath":"docs/wi/altsp/34.ad.md","filePath":"docs/wi/altsp/34.ad.md","lastUpdated":1755763892000}'),h={name:"docs/wi/altsp/34.ad.md"};function d(o,s,k,r,c,g){return t(),a("div",null,s[0]||(s[0]=[e(`<p>Операционная система должна иметь возможность ввода в домен Samba-DC или Active Directory с поддержкой следующего функционала:</p><ul><li>аутентификация рабочих станций;</li><li>авторизация и предоставление ресурсов без дополнительного ввода пароля (Single Sign-On);</li><li>поддержка ролей и привилегий (назначение ролей группам);</li><li>групповые политики (GPO).</li></ul><p>Реализация функционала должна быть обеспечена как консольными, так и графическими утилитами.</p><hr><p><a href="https://www.basealt.ru/fileadmin/user_upload/manual/ALT_Domain_guide.pdf" target="_blank" rel="noreferrer">https://www.basealt.ru/fileadmin/user_upload/manual/ALT_Domain_guide.pdf</a></p><h1 id="простая-настроика-простого-контроллера-домена" tabindex="-1">Простая настройка простого контроллера домена <a class="header-anchor" href="#простая-настроика-простого-контроллера-домена" aria-label="Permalink to &quot;Простая настройка простого контроллера домена&quot;">​</a></h1><p>Samba поддерживает две реализации Kerberos – Heimdal и MIT. Для Samba DC на базе Heimdal Kerberos необходимо установить пакет <code>task-samba-dc</code> (этот шаг можно пропустить, если при установке системы на этапе «Установка системы» был выбран профиль «Сервер Samba DC (контроллер AD)»):</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">apt-get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> task-samba-dc</span></span></code></pre></div><p>Так как Samba в режиме контроллера домена (Domain Controller, DC) использует свой сервер LDAP, свой центр распределения ключей Kerberos и свой сервер DNS (если не включен плагин BIND9_DLZ), перед установкой необходимо остановить конфликтующие службы <code>krb5kdc</code> и <code>slapd</code>, а также <code>bind</code>:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> service </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> smb</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nmb</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> krb5kdc</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> slapd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">do</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> disable</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $service; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> stop</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $service; </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">done</span></span></code></pre></div><p>Для сервера, на котором будет разворачиваться контроллер домена, должно быть установлено правильное имя узла и домена.</p><p>Для установки имени узла и домена следует выполнить команды:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">hostnamectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> set-hostname</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dc1.test.alt</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">domainname</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> test.alt</span></span></code></pre></div><p>Настройка сервера времени chrony в качестве NTP-сервера:</p><p>установить пакет <code>chrony</code>:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">apt-get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> chrony</span></span></code></pre></div><p>включить доступ к серверу chrony:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">control</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> chrony</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> server</span></span></code></pre></div><p>установить синхронизацию с российским пулом NTP:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sed</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -i</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -r</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;s/^(pool.*)/#\\1\\npool ru.pool.ntp.org iburst/&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/chrony.conf</span></span></code></pre></div><p>включить и запустить службу по умолчанию:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> enable</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --now</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> chronyd</span></span></code></pre></div><p>убедиться в нормальной работе NTP-сервера:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> status</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> chronyd.service</span></span></code></pre></div><blockquote><p>Примечание. Параметр iburst используется для ускорения начальной синхронизации</p></blockquote><p>Контроллер домена предоставляет внутренний DNS-сервер, который поддерживает основные функции, необходимые для «Альт Домена». Он прост в настройке и не требует дополнительного программного обеспечения или знаний о DNS. Создание домена с внутренним DNS-сервером рекомендуется для простых настроек DNS.</p><p>Внутренний DNS-сервер Samba имеет следующие недостатки:</p><ul><li>нельзя использовать как кеширующий сервер (caching resolver);</li><li>не поддерживает рекурсивные запросы;</li><li>не поддерживает подпись транзакции с общим ключом (TSIG) (shared-key transaction signature);</li><li>не поддерживает работу с зонами-заглушками (stub zones);</li><li>не поддерживает передачу зоны DNS (zone transfers);</li><li>не поддерживает балансировку нагрузки циклического перебора между контроллерами домена (Round Robin load balancing among DC&#39;s).</li></ul><p>Внутренний DNS-сервер может разрешать только DNS-зоны домена. Чтобы включить рекурсивные запросы других зон, следует в параметре dns forwarder (файл <code>smb.conf</code>) указать один или несколько IP-адресов DNS-серверов, поддерживающих рекурсивное разрешение.</p><p>Например:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">dns</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> forwarder</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 192.168.0.190</span></span></code></pre></div><p>Для корректного распознавания всех локальных DNS-запросов в файле /etc/resolvconf.conf должна присутствовать строка:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">name_servers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">127.0.0.1</span></span></code></pre></div><p>Иначе в конец этого файла следует добавить эту строку и перезапустить сервис <code>resolvconf</code>:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">resolvconf</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -u</span></span></code></pre></div><p>Необходимо очистить базы и конфигурацию Samba (домен, если он создавался до этого, будет удалён):</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rm</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/samba/smb.conf</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rm</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -rf</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/lib/samba</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rm</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -rf</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/cache/samba</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mkdir</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/lib/samba/sysvol</span></span></code></pre></div><p>Для запуска интерактивной установки необходимо выполнить команду:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">samba-tool</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> domain</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> provision</span></span></code></pre></div><p>В ответе на первые два вопроса нужно указать доменное имя и имя рабочей группы:</p><p><code>Realm [TEST.ALT]:</code></p><p><code>Domain [TEST]:</code></p><blockquote><p>Примечание. Чтобы принять значение по умолчанию, необходимо нажать &lt;Enter&gt;.</p></blockquote><p>Далее нужно указать тип серверной роли и бэкенд DNS-сервера:</p><p><code>Server Role (dc, member, standalone) [dc]:</code></p><p>\`DNS backend (SAMBA_INTERNAL, BIND9_FLATFILE, BIND9_DLZ, NONE)[SAMBA_INTERNAL]:</p><p>При запросе «DNS forwarder IP address» можно указать внешний DNS-сервер, чтобы DC мог разрешать внешние доменные имена:</p><p>\`DNS forwarder IP address (write &#39;none&#39; to disable forwarding)[127.0.0.1]: 8.8.8.8</p><p>Задать пароль для администратора:</p><p><code>Administrator password:</code></p><p><code>Retype password:</code></p><blockquote><p>Примечание. Пароль администратора должен быть не менее 7 символов и содержать символы как минимум трёх групп из четырёх возможных: латинских букв в верхнем и нижнем регистрах, чисел и других небуквенно-цифровых символов. Пароль, не полностью соответствующий требованиям, – это одна из причин завершения развертывания домена ошибкой.</p></blockquote><p>Начнется процесс конфигурации</p><p>После успешного создания домена, будет выведена информация о домене.</p><p>Перегрузить сервер для применения изменений</p><p>Установить службу samba запускаемой по умолчанию и запустить её:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> enable</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --now</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> samba</span></span></code></pre></div><blockquote><p>Примечание. Если служба <code>samba</code> после установки никаким способом не запускается, необходимо перезагрузить сервер</p></blockquote><p>После создания домена необходимо внести изменения в файл <code>/etc/krb5.conf</code>. В этом файле следует раскомментировать строку <code>default_realm</code> и содержимое разделов <code>realms</code> и <code>domain_realm</code> и указать название домена (следует обратить внимание на регистр символов), в строке <code>dns_lookup_realm</code> должно быть установлено значение <code>false</code>:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">includedir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/krb5.conf.d/</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[logging]</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># default = FILE:/var/log/krb5libs.log</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># kdc = FILE:/var/log/krb5kdc.log</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># admin_server = FILE:/var/log/kadmind.log</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[libdefaults]</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">dns_lookup_kdc</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">dns_lookup_realm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ticket_lifetime</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 24h</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">renew_lifetime</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 7d</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">forwardable</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rdns</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">default_realm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> TEST.ALT</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># default_ccache_name = KEYRING:persistent:%{uid}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[realms]</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">TEST.ALT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">default_domain</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> test.alt</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[domain_realm]</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">dc</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> TEST.ALT</span></span></code></pre></div><p>Просмотр общей информации о домене:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">samba-tool</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> domain</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> info</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 127.0.0.1</span></span></code></pre></div><p>Просмотр предоставляемых служб:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">smbclient</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -L</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> localhost</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -U</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> administrator</span></span></code></pre></div><p>проверка имён узлов:</p><p><code>адрес _kerberos._udp.&lt;адрес домена с точкой&gt;</code>:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">host</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -t</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> SRV</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> _kerberos._udp.test.alt.</span></span></code></pre></div><p><code>адрес _ldap._tcp.&lt;адрес домена с точкой&gt;</code>:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">host</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -t</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> SRV</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> _ldap._tcp.test.alt.</span></span></code></pre></div><p><code>адрес адрес узла.&lt;адрес домена с точкой&gt;</code>:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">host</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -t</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> A</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dc1.test.alt.</span></span></code></pre></div><blockquote><p>Если имена не находятся, следует проверить выключение службы <code>bind</code> (если не включен плагин <code>BIND9_DLZ</code>)</p></blockquote><p>Проверка Kerberos (имя домена должно быть в верхнем регистре):</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kinit</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> administrator@TEST.ALT</span></span></code></pre></div><p>Просмотр полученного билета:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">klist</span></span></code></pre></div><h1 id="аутентификация-рабочих-станции" tabindex="-1">аутентификация рабочих станций; <a class="header-anchor" href="#аутентификация-рабочих-станции" aria-label="Permalink to &quot;аутентификация рабочих станций;&quot;">​</a></h1><h2 id="графическая-утилита" tabindex="-1">Графическая утилита: <a class="header-anchor" href="#графическая-утилита" aria-label="Permalink to &quot;Графическая утилита:&quot;">​</a></h2><p>Центр управления системой - Пользователи - Аутентификация:</p><p><img src="`+l+`" alt=""></p><h2 id="консольная-утилита" tabindex="-1">Консольная утилита: <a class="header-anchor" href="#консольная-утилита" aria-label="Permalink to &quot;Консольная утилита:&quot;">​</a></h2><p>Для ввода машины в домен необходимо выполнить команду:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">system-auth</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> write</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ad</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> test.alt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> host-01</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> test</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;administrator&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;Pa$$word&#39;</span></span></code></pre></div><p>где: <code>test.alt</code> - домен <code>host-01</code> - имя компьютера <code>test</code> - рабочая группа <code>Pa\\$$word</code> - пароль администратора домена</p><h2 id="проверка-подключения-к-домену" tabindex="-1">Проверка подключения к домену <a class="header-anchor" href="#проверка-подключения-к-домену" aria-label="Permalink to &quot;Проверка подключения к домену&quot;">​</a></h2><p>Отображение сведений о доменном пользователе (находясь в его сеансе):</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getent</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> passwd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> domain_user_name</span></span></code></pre></div><p>Информация о домене:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">net</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ads</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> info</span></span></code></pre></div><p>Проверка на аутентификацию:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">net</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ads</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> testjoin</span></span></code></pre></div><h1 id="авторизация-и-предоставление-ресурсов-без-дополнительного-ввода-пароля-single-sign-on" tabindex="-1">авторизация и предоставление ресурсов без дополнительного ввода пароля (Single Sign-On); <a class="header-anchor" href="#авторизация-и-предоставление-ресурсов-без-дополнительного-ввода-пароля-single-sign-on" aria-label="Permalink to &quot;авторизация и предоставление ресурсов без дополнительного ввода пароля (Single Sign-On);&quot;">​</a></h1><p><a href="https://docs.altlinux.org/ru-RU/domain/10.4/html-single/samba/index.html#id1027" target="_blank" rel="noreferrer">https://docs.altlinux.org/ru-RU/domain/10.4/html-single/samba/index.html#id1027</a><a href="https://www.altlinux.org/%D0%93%D1%80%D1%83%D0%BF%D0%BF%D0%BE%D0%B2%D1%8B%D0%B5_%D0%BF%D0%BE%D0%BB%D0%B8%D1%82%D0%B8%D0%BA%D0%B8/%D0%9F%D0%BE%D0%B4%D0%BA%D0%BB%D1%8E%D1%87%D0%B5%D0%BD%D0%B8%D0%B5_%D1%81%D0%B5%D1%82%D0%B5%D0%B2%D1%8B%D1%85_%D0%B4%D0%B8%D1%81%D0%BA%D0%BE%D0%B2" target="_blank" rel="noreferrer">https://www.altlinux.org/Групповые_политики/Подключение_сетевых_дисков</a></p><h2 id="графическая-утилита-1" tabindex="-1">Графическая утилита <a class="header-anchor" href="#графическая-утилита-1" aria-label="Permalink to &quot;Графическая утилита&quot;">​</a></h2><p>**Групповые политики/Подключение сетевых дисков</p><p>Эта групповая политика позволяет осуществлять доступ к сетевым общим каталогам как к каталогам в локальной файловой системе. Политика служит для создания, замены, обновления и удаления сопоставленных дисков и их свойств.</p><p>Точки монтирования для отображения общих ресурсов на машинах Альт:</p><ul><li><code>/media/gpupdate/drives.system</code> — для системных ресурсов;</li><li><code>/media/gpupdate/.drives.system</code> — для скрытых системных ресурсов;</li><li><code>/run/media/USERNAME/drives</code> — для общих ресурсов пользователя;</li><li><code>/run/media/USERNAME/.drives</code> — для скрытых общих ресурсов пользователя.</li></ul><p>**Настройка политики На машине ALT</p><p><strong>Шаг 1.</strong> На машине с установленными <a href="https://www.altlinux.org/ADMC" title="ADMC" target="_blank" rel="noreferrer">ADMC</a> и <a href="https://www.altlinux.org/%D0%93%D1%80%D1%83%D0%BF%D0%BF%D0%BE%D0%B2%D1%8B%D0%B5_%D0%BF%D0%BE%D0%BB%D0%B8%D1%82%D0%B8%D0%BA%D0%B8/GPUI" title="Групповые политики/GPUI" target="_blank" rel="noreferrer">GPUI</a> получить ключ Kerberos для администратора домена.</p><p><strong>Шаг 2.</strong> В <a href="https://www.altlinux.org/ADMC" title="ADMC" target="_blank" rel="noreferrer">ADMC</a> создать новый объект групповой политики (GPO) и связать его с OU, куда входят учетные записи пользователей для которых создаются сетевые диски.</p><p><strong>Шаг 3.</strong> Запустить <a href="https://www.altlinux.org/%D0%93%D1%80%D1%83%D0%BF%D0%BF%D0%BE%D0%B2%D1%8B%D0%B5_%D0%BF%D0%BE%D0%BB%D0%B8%D1%82%D0%B8%D0%BA%D0%B8/GPUI" title="Групповые политики/GPUI" target="_blank" rel="noreferrer">GPUI</a>:</p><ul><li><p>из <a href="https://www.altlinux.org/ADMC" title="ADMC" target="_blank" rel="noreferrer">модуля удаленного управления базой данных конфигурации (ADMC)</a>, выбрав в контекстном меню объекта групповой политики пункт «Изменить…»:</p><p><a href="https://www.altlinux.org/%D0%A4%D0%B0%D0%B9%D0%BB:Admc-gp-edit-drivers.png" title="Запуск GPUI из ADMC" target="_blank" rel="noreferrer"><img src="https://www.altlinux.org/Images.www.altlinux.org/d/d4/Admc-gp-edit-drivers.png" alt="Запуск GPUI из ADMC"></a></p></li><li><p>или с указанием каталога групповой политики:</p></li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">gpui-main</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;smb://dc1.test.alt/SysVol/test.alt/Policies/{75411A5F-5A46-4616-BB1A-4DE7C3EEDBD1}&quot;</span></span></code></pre></div><p>где <code>dc1.test.alt</code> — имя контроллера домена, а <code>{XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXXXX}</code> — GUID шаблона групповой политики для редактирования.</p><p>Откроется окно редактирования групповых политик.</p><p><strong>Шаг 4.</strong> Перейти в «Компьютер»/«Пользователь» -&gt; «Настройки» -&gt; «Настройки системы» -&gt; «Сетевые диски». Создайте новый параметр политики (в контекстном меню свободной области выбрать пункт «Новый» -&gt; «Сетевой диск»):</p><p><a href="https://www.altlinux.org/%D0%A4%D0%B0%D0%B9%D0%BB:Gpui-drivers-01.png" title="GPUI. Создание нового параметра политики «Сетевой диск»" target="_blank" rel="noreferrer"><img src="https://www.altlinux.org/Images.www.altlinux.org/4/49/Gpui-drivers-01.png" alt="GPUI. Создание нового параметра политики «Сетевой диск»"></a><strong>Шаг 5.</strong> В диалоговом окне «Диалог настроек» указать параметры подключения сетевого диска:</p><p><a href="https://www.altlinux.org/%D0%A4%D0%B0%D0%B9%D0%BB:Gpui-drivers-02.png" title="GPUI. Диалоговое окно настройки политики «Сетевой диск» ­— вкладка «Основные настройки»" target="_blank" rel="noreferrer"><img src="https://www.altlinux.org/Images.www.altlinux.org/0/0a/Gpui-drivers-02.png" alt="GPUI. Диалоговое окно настройки политики «Сетевой диск» ­— вкладка «Основные настройки»"></a></p><p>Доступные опции на вкладке «Основные настройки» («General»):</p><ul><li>«Действие» — поведение элемента настройки зависит от выбранного действия и от того, существует ли уже выбранная буква диска: <ul><li>«Создать» — создание нового сетевого диска;</li><li>«Удалить» — удаление сетевого диска. Нельзя удалить локальный диск рабочей станции (жесткий диск, CD-Drive);</li><li>«Заменить» — удаление и повторное создание сетевого диска. Если диск до этого не был до создан, то будет создан новый диск. Нельзя заменить локальный диск рабочей станции (жесткий диск, CD-Drive);</li><li>«Обновить» — изменение параметров существующего сетевого диска или создание нового, если диска с заданной буквой не существует. Это действие отличается от «Заменить» тем, что оно не удаляет диск, а только обновляет настройки (кроме пути к общей папке и буквы).</li></ul></li><li>«Путь» — путь к общей папке или диску, который нужно отобразить (полный UNC-путь к сетевому общему ресурсу, например, <code>\\\\server\\sharename</code>, <code>\\\\server\\hiddenshare$</code> или <code>\\\\server\\sharename\\foldername</code>). Это поле может содержать переменные. Чтобы изменить существующий сетевой диска (определяемый по букве диска), следует оставить это поле пустым.</li></ul><blockquote><p><strong>Внимание!</strong> При указании пути к общей папке необходимо использовать имя сервера, а не его IP-адрес.</p></blockquote><blockquote><p><strong>Примечание:</strong> Список допустимых переменных (для систем «Альт»): Машинные: - <code>&#39;HOME&#39;</code>, <code>&#39;HOMEPATH&#39;</code> — каталог <code>/etc/skel</code>; - <code>&#39;HOMEDRIVE&#39;</code>, <code>&#39;SystemRoot&#39;</code>, <code>&#39;SystemDrive&#39;</code> — корневой каталог (/); - <code>&#39;StartMenuDir&#39;</code> — каталог <code>/usr/share/applications</code>; Пользовательские: - <code>&#39;LogonUser&#39;</code> — имя текущего пользователя (username); - <code>&#39;HOME&#39;</code>, <code>&#39;HOMEPATH&#39;</code> — домашний каталог текущего пользователя (<code>get_homedir(username)</code>); - <code>&#39;DesktopDir&#39;</code> — рабочий стол текущего пользователя (<code>get_desktop(username, variables\\[&#39;HOME&#39;])</code>).</p></blockquote><ul><li>«Переподключиться» — сохранять подключенный диск в настройках пользователя и повторно подключать его при каждом входе в систему.</li><li>«Название» — пользовательское имя для диска (можно оставить это поле пустым).</li></ul><blockquote><p><strong>Внимание!</strong> Если в названии есть кириллица или пробелы, то название необходимо заключить в двойные кавычки (для <a href="https://packages.altlinux.org/ru/sisyphus/gpupdate" target="_blank" rel="noreferrer">gpupdate</a> до версии 0.9.13.4 включительно).</p></blockquote><ul><li>«Имя диска» — буква, на которую будет назначен диск: <ul><li>чтобы назначить сетевому диску первую доступную букву диска, следует выбрать «Первый доступный, начиная с», а затем выбрать букву диска, с которой начинать проверку доступности букв;</li><li>чтобы назначить сетевому диску определенную букву, следует выбрать «Использовать», а затем выбрать букву диска (если рабочая станция уже использует выбранную здесь букву, сопоставление дисков групповой политики завершится неудачно);</li><li>чтобы изменить существующее сопоставление диска (определяемое буквой диска), следует выбрать «Использовать», а затем выбрать букву диска;</li><li>чтобы удалить все сопоставления дисков начиная с определенной буквы, следует выбрать «Удалить, начиная с», а затем выбрать букву диска, с которой следует начать удаление сопоставлений дисков. Физические диски пропускаются без ошибок. Данный параметр доступен только при выбранном действии «Удалить»;</li><li>чтобы удалить определенный сопоставленный диск, следует выбрать «Удалить», а затем выбрать букву диска. Данный параметр доступен только при выбранном действии «Удалить».</li></ul></li></ul><blockquote><p><strong>Внимание!</strong> Пункт «Имя диска» совместно с «Первый доступный, начиная с» рекомендуется использовать для дисков, которые должны подключаться в ОС Windows. Т.к. если будет создано несколько дисков с данными параметрами, то в ОС «Альт» будет отображаться только один диск (последний).</p></blockquote><p>Параметры «Скрыть/Показать» — настройка отображения сопоставленного диска (параметры «Скрыть/Показать диск» имеют приоритет над параметрами «Скрыть/Показать все диски»):</p><ul><li>«Без изменений» — оставить отображение сопоставленного диска неизменным;</li><li>«Скрыть диск» — скрыть диск в окне файлового менеджера;</li><li>«Показать диск» — отобразить диск в окне файлового менеджера.</li></ul><blockquote><p><strong>Примечание:</strong> При выборе параметра «Показать диск» к точке монтирования (файл <code>/etc/auto.master.gpupdate.d/&lt;имя&gt;.autofs</code>) добавляется опция <code>--browse</code>. В этом случае для данной точки монтирования будет создан пустой каталог, независимо от того, смонтирована ли какая-либо файловая система в него или нет.</p><p>Это удобно так как доступные автоматически монтируемые файловые системы будут показаны как существующие каталоги, даже если их файловые системы в данный момент не смонтированы.</p><p>При выборе параметра «Скрыть диск» необходимо запомнить название каталога, так как доступ к этому каталогу можно получить только при непосредственном обращении к нему. Каталог будет создан и файловая система будет смонтирована только при попытке доступа к нему. Незадействованный ресурс по истечении тайм-аута (по умолчанию 120 секунд) будет отмонтирован, а каталог удалён.</p></blockquote><p><a href="https://www.altlinux.org/%D0%A4%D0%B0%D0%B9%D0%BB:Gpui-preferences-common.png" title="GPUI. Диалоговое окно настройки предпочтения ­— вкладка «Общие»" target="_blank" rel="noreferrer"><img src="https://www.altlinux.org/Images.www.altlinux.org/1/1b/Gpui-preferences-common.png" alt="GPUI. Диалоговое окно настройки предпочтения ­— вкладка «Общие»"></a></p><p>Доступные опции на вкладке «Общие» («Common»):</p><ul><li>«Остановить обработку элементов в этом расширении при возникновении ошибки» — при сбое элемента предпочтений обработка других элементов предпочтений в этом расширении останавливается;</li><li>«Выполнять в контексте безопасности текущего пользователя (опция пользовательских политик)»;</li><li>«Удалить элемент, если больше не применим»;</li><li>«Описание».</li></ul><h2 id="консольные-утилиты" tabindex="-1">Консольные утилиты <a class="header-anchor" href="#консольные-утилиты" aria-label="Permalink to &quot;Консольные утилиты&quot;">​</a></h2><p>Рассматриваемые ниже способы позволяют подключать файловые ресурсы (file shares) для доменного пользователя без повторного ввода пароля (SSO, Single Sign-On).</p><h3 id="подключение-с-использованием-gio" tabindex="-1">Подключение с использованием gio <a class="header-anchor" href="#подключение-с-использованием-gio" aria-label="Permalink to &quot;Подключение с использованием gio&quot;">​</a></h3><blockquote><p>Примечание. Способ актуален для дистрибутивов, использующих <code>gio</code>.</p></blockquote><p>Недостаток этого способа – необходимо открыть ресурс в файловом менеджере (<code>Caja</code>, <code>Pcmanfm</code>). Однако можно открывать любые ресурсы на любых серверах, входящие в домен.</p><p>Процедура монтирования общих ресурсов с использованием <code>gio</code>:</p><ul><li>установить необходимые пакеты:</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">apt-get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> fuse-gvfs</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gvfs-backend-smb</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> libgio</span></span></code></pre></div><ul><li>включить пользователя в группу <code>fuse</code>:</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">gpasswd</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -a</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">пользовател</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ь</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> fuse</span></span></code></pre></div><ul><li>разрешить для всех доступ к <code>fuse</code> под root:</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">control</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> fusermount</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> public</span></span></code></pre></div><ul><li><p>войти под доменным пользователем;</p></li><li><p>открыть ресурс в файловом менеджере (например, по адресу smb://server/sysvol). Ресурс смонтирован по пути <code>/var/run/&lt;uid_пользователя&gt;/gvfs</code> или <code>/var/run/user/&lt;uid_пользователя&gt;/gvfs/smb-share:server=сервер,share=ресурс</code></p></li><li><p>другой вариант (полезно для скриптов в автозапуске):</p></li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">gio</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mount</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> smb://server/sysvol/</span></span></code></pre></div><blockquote><p>Примечание. Если необходимо открывать что-то с ресурса в <code>WINE</code>, в <code>winecfg</code> следует добавить диск с путем <code>/var/run/uid_пользователя/gvfs</code>.</p></blockquote><h3 id="подключение-с-использованием-pam-mount" tabindex="-1">Подключение с использованием pam_mount <a class="header-anchor" href="#подключение-с-использованием-pam-mount" aria-label="Permalink to &quot;Подключение с использованием pam_mount&quot;">​</a></h3><p>При подключении общих ресурсов с использованием <code>pam_mount</code> сетевой ресурс подключается с заданного сервера автоматически при каждом входе доменным пользователем. Процедура монтирования общих ресурсов с использованием <code>pam_mount</code>:</p><ul><li>установить пакеты <code>pam_mount</code> и <code>cifs-utils</code>:</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">apt-get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pam_mount</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cifs-utils</span></span></code></pre></div><blockquote><p>Примечание. Для того, чтобы файловые ресурсы, подключенные с помощью <code>pam_mount</code>, корректно отключались при завершении сеанса, следует установить пакет <code>systemd-settings-enable-kill-user-processes</code> и перезагрузить систему:</p></blockquote><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">apt-get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemd-settings-enable-kill-user-processes</span></span></code></pre></div><ul><li>прописать <code>pam_mount</code> в схему аутентификации по умолчанию. Для этого в конец файла <code>/etc/pam.d/system-auth</code> добавить строки:</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">session</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [success=1 </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">default=ignore]</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pam_succeed_if.so</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> service</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemd-user</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> quiet</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">session</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> optional</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pam_mount.so</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> disable_interactive</span></span></code></pre></div><ul><li>установить правило монтирования ресурса в файле <code>/etc/security/pam_mount.conf.xml</code> (перед тегом <code>&lt;cifsmount&gt;</code>):</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">volume uid</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;10000-2000200000&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> fstype</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;cifs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;dc1.test.alt&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">path</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;sysvol&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> mountpoint</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;~/share&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">options</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;sec=krb5i,cruid=%(USERUID),nounix,uid=%(USERUID),gid=%(USERGID</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">),file_mode=0664,dir_mode=0775&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> /</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span></code></pre></div><p>где: <code>uid=&quot;10000-2000200000&quot;</code> – диапазон присваиваемых для доменных пользователей UID (подходит для Winbind и для SSSD); <code>server=&quot;dc1.test.alt&quot;</code> – имя сервера с ресурсом; <code>path=&quot;sysvol&quot;</code> – имя файлового ресурса; <code>mountpoint=&quot;~/share&quot;</code> – путь монтирования в домашней папке пользователя.</p><p>Опционально можно добавить:</p><p><code>sgrp=&quot;group_name&quot;</code> – имя группы, при членстве пользователя в которой, папка будет примонтирована.</p><p>Параметр <code>sec=krb5i</code> более безопасный, но требует больше вычислительных ресурсов. Вместо него можно указать <code>sec=krb5</code>. В параметре server необходимо указывать настоящее имя сервера, а не имя домена.</p><h3 id="подключение-с-использованием-autofs" tabindex="-1">Подключение с использованием Autofs <a class="header-anchor" href="#подключение-с-использованием-autofs" aria-label="Permalink to &quot;Подключение с использованием Autofs&quot;">​</a></h3><p>При этом способе заданный ресурс подключается автоматически при каждом обращении пользователя и отключается после определенного времени бездействия (определяется конфигурацией <code>Autofs</code>).</p><p>Принцип работы:</p><ul><li>задается каталог, в котором будет происходить подключение, например, <code>/mnt/auto/</code>;</li><li>при необходимости обратиться к сетевой файловой системе, следует обратиться к каталогу с именем этой ФС в этом каталоге. Например, <code>/mnt/auto/server/share/</code> ;</li><li>при обращении будет произведена попытка смонтировать соответствующий сетевой ресурс;</li><li>при отсутствии обращения, после заданного таймаута, сетевой ресурс будет отмонтирован;</li><li>AutoFS использует для конфигурирования шаблоны <code>/etc/auto*</code>. Основной шаблон называется <code>auto.master</code>, он может указывать на один или несколько других шаблонов для конкретных типов носителей. Пример содержимого файла <code>/etc/auto.master</code>:</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Format of this file:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># mountpoint map options</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># For details of the format look at autofs(8).</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/mnt/auto</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/auto.tab</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -t</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 5</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/mnt/net</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/auto.avahi</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -t</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 120</span></span></code></pre></div><p>Первое значение в каждой строке определяет базовый каталог, в который носители будут монтироваться, второе значение – файл конфигурации или скрипт, который будет использован.</p><blockquote><p>Примечание. Параметр <code>-t (--timeout)</code> устанавливает количество секунд, после истечения которых каталоги будут размонтированы. Значение <code>0</code> отключает таймаут. Значения параметра по умолчанию задаются в файле <code>/etc/autofs.conf</code> .</p></blockquote><p>Базовый каталог будет создан, если он не существует. Он станет точкой монтирования, отображающей в себе динамически подключаемые носители, что означает, что существующее содержимое базового каталога будет недоступно пока autofs работает.</p><p>Пример настройки автоматического подключения сетевых файловых ресурсов Windows (Samba) при входе пользователя:</p><ol><li>добавить в <code>/etc/auto.master</code> строку:</li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/mnt/samba</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/auto.smb</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -t</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 120</span></span></code></pre></div><p>где:</p><ul><li><code>/mnt/samba</code> – каталог в котором будут подключаться сетевые файловые системы;</li><li><code>/etc/auto.smb</code> – стандартный скрипт, входящий в состав пакета <code>autofs</code>;</li><li><code>120</code> – таймаут подключения при отсутствии обращения;</li></ul><ol start="2"><li>включить и запустить сервис <code>autofs</code>:</li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> enable</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --now</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> autofs</span></span></code></pre></div><ol start="3"><li>для автоматического подключения ресурсов достаточно обратиться к ресурсу по имени хоста в диспетчере файл или в командной строке, например:</li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/mnt/samba/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;имя_хоста&gt;</span></span></code></pre></div><p>![[sadasdas.png]]</p><h1 id="поддержка-ролеи-и-привилегии-назначение-ролеи-группам" tabindex="-1">поддержка ролей и привилегий (назначение ролей группам); <a class="header-anchor" href="#поддержка-ролеи-и-привилегии-назначение-ролеи-группам" aria-label="Permalink to &quot;поддержка ролей и привилегий (назначение ролей группам);&quot;">​</a></h1><p>Модуль ролей — это модуль для службы переключения имён NSS. Модуль реализует возможность добавления групп в группы. Для администрирования модуля ролей реализованы специальные вспомогательные утилиты, которые рассматривают все группы поделёнными на две категории: роли и привилегии.</p><p>Привилегия</p><p>Обычная POSIX-группа, которая может быть назначена пользователю. После этого пользователь может совершать действия, соответствующие данной привилегии. К привилегиям относятся такие группы, как <code>cdwriter</code>, <code>audio</code>, <code>serial</code>, <code>virtualbox</code> и др.</p><p>Роль</p><p>Роль так же является POSIX группой, но её предназначение указывать, на характерную деятельность, которую выполняет пользователь, работая за компьютером. Такими группами могут быть группы <code>localadmins</code>, <code>users</code>, <code>poweruser</code>, <code>developer</code> и др.</p><p>Для того чтобы пользователь мог выполнять определённую роль ему могут понадобиться определённые права (привилегии), поэтому полезно уметь назначать привилегии как непосредственно пользователю (как это делается в POSIX), так и косвенно добавлять ему наборы привилегий через назначение роли. Например, пользователь, которому назначена роль <code>localadmins</code> мог бы получать кроме группы <code>localadmins</code>, ещё и группы-привилегии <code>wheel</code>, <code>ssh</code>, <code>root</code> и пр.</p><p>Модуль ролей позволяет реализовать подобное назначение прав пользователям системы. Группы-роли назначаются непосредственно пользователю, а группы-привилегии назначаются как пользователю непосредственно, так и группам-ролям. Деление групп на два сорта условно, и администратор может управлять им самостоятельно.</p><p>При вводе машины в домен создаются следующие локальные роли:</p><ul><li>роль пользователей (<code>users</code>);</li><li>роль пользователей с расширенными правами (<code>powerusers</code>);</li><li>роль локальных администраторов (<code>localadmins</code>).</li></ul><p>Локальные роли <code>users</code> и <code>localadmins</code> назначаются для глобальных групп в домене.</p><h2 id="графическая-утилита-2" tabindex="-1">Графическая утилита <a class="header-anchor" href="#графическая-утилита-2" aria-label="Permalink to &quot;Графическая утилита&quot;">​</a></h2><p>Если необходимо выдать права администраторов пользователям, которые не являются администраторами домена (Domain Admins), то нужно на контроллере домена завести новую группу в AD (например, PC Admins):</p><p>На контроллере домена ADMC:</p><ol><li><p>В контекстном меню контейнера выберите пункт «Создать»→«Группа».</p></li><li><p>Откроется окно «Создать группу — ADMC»:</p><p><a href="https://www.altlinux.org/%D0%A4%D0%B0%D0%B9%D0%BB:Admc-group-add.png" title="ADMC. Создание новой группы" target="_blank" rel="noreferrer"><img src="https://www.altlinux.org/Images.www.altlinux.org/e/e4/Admc-group-add.png" alt="ADMC. Создание новой группы"></a></p></li><li><p>В поле «Имя» введите название группы.</p></li><li><p>В поле «Имя для входа (до Windows 2000)» введите название группы для старых систем.</p></li><li><p>В выпадающем списке «Область группы» выберите область действия группы:</p><ul><li>«Глобальная» — членами глобальной группы могут быть другие группы и учётные записи только из того домена, в котором определена группа. Членам этой группы разрешения могут назначаться в любом домене леса;</li></ul></li><li><p>В выпадающем списке «Тип группы» выберите тип группы:</p><ul><li>«Безопасность» — используется для назначения разрешений доступа к общим ресурсам;</li><li>«Рассылка» — используется для создания списков рассылки электронной почты.</li></ul></li><li><p>Нажмите кнопку «ОК».</p></li></ol><p>Добавить туда необходимых пользователей (например, пользователя ivanov):</p><ol><li><p>В контекстном меню пользователя выбрать пункт «Добавить в группу…».</p></li><li><p>Откроется окно «Добавить в группу — ADMC»:</p><p><a href="https://www.altlinux.org/%D0%A4%D0%B0%D0%B9%D0%BB:Admc-select3.png" title="Диалоговое окно «Добавить в группу — ADMC»" target="_blank" rel="noreferrer"><img src="https://www.altlinux.org/Images.www.altlinux.org/0/06/Admc-select3.png" alt="Диалоговое окно «Добавить в группу — ADMC»"></a></p></li><li><p>Выберите группы, в которые вы хотите добавить учётную запись пользователя в качестве участника.</p></li><li><p>Нажмите кнопку «ОК».</p></li></ol><p>Затем на машине, введённой в домен, добавить роль для данной группы:</p><p>пакет alterator-roles <a href="https://www.altlinux.org/Alterator-roles" target="_blank" rel="noreferrer">https://www.altlinux.org/Alterator-roles</a></p><p>Для добавления привилегии для существующей системной роли, следует выделить системную роль и нажать кнопку «Добавить привилегию…». В открывшемся диалоговом окне необходимо в поле «Привилегия» указать имя привилегии и нажать кнопку «ОК»:</p><p>![[Pasted image 20250603133734.png]]</p><ul><li>Роль: localadmins</li><li>Привилегия: PC Admins</li></ul><h2 id="консольная-утилита-1" tabindex="-1">Консольная утилита <a class="header-anchor" href="#консольная-утилита-1" aria-label="Permalink to &quot;Консольная утилита&quot;">​</a></h2><p>Если необходимо выдать права администраторов пользователям, которые не являются администраторами домена (Domain Admins), то нужно на контроллере домена завести новую группу в AD (например, PC Admins):</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">samba-tool</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> group</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> add</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;PC Admins&#39;</span></span></code></pre></div><p>Добавить туда необходимых пользователей (например, пользователя ivanov):</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">samba-tool</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> group</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> addmembers</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;PC Admins&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ivanov</span></span></code></pre></div><p>Затем на машине, введённой в домен, добавить роль для данной группы:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">roleadd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;PC Admins&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> localadmins</span></span></code></pre></div><p>Проверить список назначенных ролей и привилегий текущего пользователя:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rolelst</span></span></code></pre></div><h1 id="групповые-политики-gpo" tabindex="-1">групповые политики (GPO). <a class="header-anchor" href="#групповые-политики-gpo" aria-label="Permalink to &quot;групповые политики (GPO).&quot;">​</a></h1><h2 id="графическая-утилита-3" tabindex="-1">Графическая утилита <a class="header-anchor" href="#графическая-утилита-3" aria-label="Permalink to &quot;Графическая утилита&quot;">​</a></h2><p>![[35) Графический инструмент для работы с AD и GPO]]</p><h2 id="консольная-утилита-2" tabindex="-1">Консольная утилита <a class="header-anchor" href="#консольная-утилита-2" aria-label="Permalink to &quot;Консольная утилита&quot;">​</a></h2><h3 id="samba-tool" tabindex="-1">samba-tool <a class="header-anchor" href="#samba-tool" aria-label="Permalink to &quot;samba-tool&quot;">​</a></h3><p>Для управления Samba AD DC в состав пакета Samba входит инструмент командной строки <code>samba-tool</code>.</p><table tabindex="0"><thead><tr><th>Команда</th><th>Описание</th></tr></thead><tbody><tr><td>computer</td><td>Управление учетными записями компьютеров</td></tr><tr><td>contact</td><td>Управление контактами</td></tr><tr><td>dbcheck</td><td>Проверка локальной базы данных AD на наличие ошибок</td></tr><tr><td>delegation</td><td>Управление делегированием</td></tr><tr><td>dns</td><td>Управление параметрами доменной службы DNS</td></tr><tr><td>domain</td><td>Управление параметрами домена</td></tr><tr><td>drs</td><td>Управление службой репликации каталогов (Directory Replication Services, DRS)</td></tr><tr><td>dsacl</td><td>Управление списками контроля доступа DS</td></tr><tr><td>forest</td><td>Управление конфигурацией леса</td></tr><tr><td>fsmo</td><td>Управление ролями (Flexible Single Master Operations, FSMO)</td></tr><tr><td>==gpo==</td><td>==Управление групповыми политиками==</td></tr><tr><td>group</td><td>Управление группами</td></tr><tr><td>ldapcmp</td><td>Сравнение двух баз данных ldap</td></tr><tr><td>ntacl</td><td>Управление списками контроля доступа ACL</td></tr><tr><td>processes</td><td>Вывод списка процессов</td></tr><tr><td>ou</td><td>Управление организационными подразделениями (OU)</td></tr><tr><td>rodc</td><td>Управление контроллером домена (Read-Only Domain Controller, RODC)</td></tr><tr><td>schema</td><td>Управление и запрос схемы</td></tr><tr><td>sites</td><td>Управление сайтами</td></tr><tr><td>spn</td><td>Управление службой принципалов (Service Principal Name, SPN)</td></tr><tr><td>testparm</td><td>Проверка конфигурационного файла на корректность синтаксиса</td></tr><tr><td>time</td><td>Получение показаний текущего времени сервера</td></tr><tr><td>user</td><td>Управление пользователями</td></tr><tr><td>visualize</td><td>Графическое представление состояния сети Samba</td></tr></tbody></table><p>Например:</p><p>вывести список групповых политик:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">samba-tool</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gpo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> listall</span></span></code></pre></div><p><img src="`+p+'" alt=""></p><p>вывести список групповых политик, связанных с контейнером:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">samba-tool</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gpo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> getlink</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> OU=OU,DC=test,DC=alt</span></span></code></pre></div><p><img src="'+n+'" alt=""></p>',215)]))}const b=i(h,[["render",d]]);export{u as __pageData,b as default};
