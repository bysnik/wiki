import{_ as a,c as i,o as e,ag as t}from"./chunks/framework.D4Vqf8I7.js";const c=JSON.parse('{"title":"⁠Установка сервера FreeIPA","description":"","frontmatter":{},"headers":[],"relativePath":"docs/wi/altsp/39.freeipa.md","filePath":"docs/wi/altsp/39.freeipa.md","lastUpdated":1757674415000}'),p={name:"docs/wi/altsp/39.freeipa.md"};function n(l,s,h,r,d,k){return e(),i("div",null,s[0]||(s[0]=[t(`<p>Операционная система должна иметь возможность интеграции в домен FreeIPA, функционал должен включать ==поддержку групповых политик==. Реализация функционала должна быть обеспечена как консольными, так и графическими утилитами.</p><hr><p><strong>FreeIPA</strong> — это комплексное решение по управлению безопасностью Linux-систем, 389 Directory Server, MIT Kerberos, NTP, DNS, Dogtag, состоит из веб-интерфейса и интерфейса командной строки.</p><p><strong>FreeIPA</strong> является интегрированной системой проверки подлинности и авторизации в сетевой среде Linux, FreeIPA сервер обеспечивает централизованную проверку подлинности, авторизацию и контроль за аккаунтами пользователей сохраняя сведения о пользователе, группах, узлах и других объектах необходимых для обеспечения сетевой безопасности.</p><h1 id="⁠установка-сервера-freeipa" tabindex="-1">⁠Установка сервера <strong>FreeIPA</strong> <a class="header-anchor" href="#⁠установка-сервера-freeipa" aria-label="Permalink to &quot;⁠Установка сервера **FreeIPA**&quot;">​</a></h1><p>В качестве примера показана установка сервера <strong>FreeIPA</strong> со встроенным DNS сервером и доменом EXAMPLE.TEST в локальной сети 192.168.135.0/24.</p><p>Во избежание конфликтов с разворачиваемым tomcat необходимо отключить ahttpd, работающий на порту 8080, а также отключить HTTPS в Apache2:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">service</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ahttpd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> stop</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">a2dissite</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 000-default_https</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">a2disport</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">service</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> httpd2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> condreload</span></span></code></pre></div><p>Установить необходимые пакеты (если во время установки сервера не был выбран пункт сервер FreeIPA):</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">apt-get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> freeipa-server</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> freeipa-server-dns</span></span></code></pre></div><p>Задать имя сервера:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">hostnamectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> set-hostname</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ipa.example.test</span></span></code></pre></div><p>Запустить скрипт настройки сервера. В пакетном режиме:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ipa-server-install</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -U</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --hostname=$(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">hostname</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">)</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -r</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> EXAMPLE.TEST</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> example.test</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 12345678</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -a</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 12345678</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --setup-dns</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --no-forwarders</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --no-reverse</span></span></code></pre></div><p>или интерактивно:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ipa-server-install</span></span></code></pre></div><blockquote><p><strong>Предупреждение</strong> Пароли должны быть не менее 8 символов</p></blockquote><p>Обратите внимание на ответ на вопрос, не совпадающий с предложенным:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Do you want to configure integrated DNS (BIND)? [no]: yes</span></span></code></pre></div><p>остальные вопросы необходимо выбрать по умолчанию (можно просто нажать <strong>Enter</strong>). Так же при установке необходимо ввести пароль администратора системы и пароль администратора каталогов.</p><p>Для возможности управлять <strong>FreeIPA</strong> сервером из командной строки необходимо получить билет Kerberos:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kinit</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> admin</span></span></code></pre></div><p>Добавить в DNS запись о сервере времени:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ipa</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dnsrecord-add</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> example.test</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> _ntp._udp</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --srv-priority=0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --srv-weight=100</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --srv-port=123</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --srv-target=ipa.example.test.</span></span></code></pre></div><p>Проверить работу ntp сервера можно командой:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ntpdate</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -q</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> localhost</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># server 127.0.0.1, stratum 3, offset 0.000018, delay 0.02568</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 27 Nov 10:27:00 ntpdate[29854]: adjust time server 127.0.0.1 offset 0.000018 sec</span></span></code></pre></div><p>Веб-интерфейс доступен по адресу: <a href="https://ipa.example.test/ipa/ui/" target="_blank" rel="noreferrer">https://ipa.example.test/ipa/ui/</a></p><h1 id="установка-freeipa-клиента-и-подключение-к-серверу" tabindex="-1">Установка <strong>FreeIPA</strong> клиента и подключение к серверу <a class="header-anchor" href="#установка-freeipa-клиента-и-подключение-к-серверу" aria-label="Permalink to &quot;Установка **FreeIPA** клиента и подключение к серверу&quot;">​</a></h1><p>Установить необходимые пакеты:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">apt-get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> freeipa-client</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> libsss_sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> krb5-kinit</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bind-utils</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> libbind</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> zip</span></span></code></pre></div><h2 id="подключение-к-серверу-в-консоли" tabindex="-1">Подключение к серверу в консоли <a class="header-anchor" href="#подключение-к-серверу-в-консоли" aria-label="Permalink to &quot;Подключение к серверу в консоли&quot;">​</a></h2><p>Задать имя компьютера:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">hostnamectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> set-hostname</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> comp01.example.test</span></span></code></pre></div><p>Добавить DNS сервер, для этого необходимо создать файл <code>/etc/net/ifaces/ens19/resolv.conf</code> со следующим содержимым:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nameserver</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 192.168.135.1</span></span></code></pre></div><p>192.168.135.1 — IP-адрес <strong>FreeIPA</strong> сервера.</p><p>Указать службе resolvconf, использовать DNS <strong>FreeIPA</strong> и наш домен для поиска. Для этого в файл <code>/etc/resolvconf.conf</code> необходимо добавить/отредактировать следующие параметры:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">interface_order</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;lo lo[0-9]* lo.* ens19&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">search_domains</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">example.test</span></span></code></pre></div><p>где ens19 — интерфейс, на котором доступен <strong>FreeIPA</strong> сервер, example.test — наш домен.</p><p>Обновить DNS адреса:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">resolvconf</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -u</span></span></code></pre></div><p>После этого в файле <code>/etc/resolv.conf</code> должны появиться строки:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">search</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> example.test</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nameserver</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 192.168.135.1</span></span></code></pre></div><p>Запустить скрипт настройки клиента в пакетном режиме:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ipa-client-install</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -U</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> admin</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -w</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 12345678</span></span></code></pre></div><p>или интерактивно:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ipa-client-install</span></span></code></pre></div><p>Если все настроено верно, скрипт должен выдать такое сообщение:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>&#39;&#39;&#39;Discovery was successful!&#39;&#39;&#39;</span></span>
<span class="line"><span>Client hostname: comp02.example.test</span></span>
<span class="line"><span>Realm: EXAMPLE.TEST</span></span>
<span class="line"><span>DNS Domain: example.test</span></span>
<span class="line"><span>IPA Server: ipa.example.test</span></span>
<span class="line"><span>BaseDN: dc=example,dc=test</span></span>
<span class="line"><span>Continue to configure the system with these values? [no]:</span></span></code></pre></div><p>Необходимо ответить <strong>yes</strong>, ввести имя пользователя, имеющего право вводить машины в домен, и его пароль.</p><p>В случае возникновения ошибки, необходимо перед повторной установкой запустить процедуру удаления:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ipa-client-install</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -U</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --uninstall</span></span></code></pre></div><p>Для работы sudo-политик для доменных пользователей на клиентской машине необходимо разрешить доступ к sudo:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">control</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> public</span></span></code></pre></div><h2 id="подключение-к-серверу-в-цус" tabindex="-1">Подключение к серверу в ЦУС <a class="header-anchor" href="#подключение-к-серверу-в-цус" aria-label="Permalink to &quot;Подключение к серверу в ЦУС&quot;">​</a></h2><p>В Центре управления системой, в разделе <strong>Пользователи</strong>, подраздел <strong>Аутентификация</strong>, необходимо выбрать пункт <strong>Домен FreeIPA</strong>, заполнить поля <strong>Домен</strong> и <strong>Имя компьютера</strong>, нажать кнопку <strong>Применить</strong>.</p><h1 id="групповые-политики" tabindex="-1">Групповые политики <a class="header-anchor" href="#групповые-политики" aria-label="Permalink to &quot;Групповые политики&quot;">​</a></h1><p><a href="https://www.altlinux.org/%D0%93%D1%80%D1%83%D0%BF%D0%BF%D0%BE%D0%B2%D1%8B%D0%B5_%D0%BF%D0%BE%D0%BB%D0%B8%D1%82%D0%B8%D0%BA%D0%B8/FreeIPA" target="_blank" rel="noreferrer">https://www.altlinux.org/Групповые_политики/FreeIPA</a></p><blockquote><p>В FreeIPA отсутствует концепция групповых политик (GPO). В AD групповые политики состоят из Group Policy Container (GPC), хранящегося в базе данных Active Directory, и Group Policy Template (GPT), который представляет собой набор файлов в каталоге SYSVOL на контроллере домена. Для реализации поддержки групповых политик на клиентах FreeIPA с использованием инструмента gpupdate необходимо создать сетевую шару Samba, которая будет использоваться для хранения и распространения GPO аналогично AD.</p></blockquote>`,59)]))}const g=a(p,[["render",n]]);export{c as __pageData,g as default};
