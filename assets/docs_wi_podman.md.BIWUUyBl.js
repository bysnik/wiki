import{_ as i,c as a,o as e,ag as t}from"./chunks/framework.D4Vqf8I7.js";const r=JSON.parse('{"title":"Podman","description":"","frontmatter":{},"headers":[],"relativePath":"docs/wi/podman.md","filePath":"docs/wi/podman.md","lastUpdated":1755522630000}'),n={name:"docs/wi/podman.md"};function p(l,s,h,d,o,k){return e(),a("div",null,s[0]||(s[0]=[t(`<h1 id="podman" tabindex="-1">Podman <a class="header-anchor" href="#podman" aria-label="Permalink to &quot;Podman&quot;">​</a></h1><p><img src="https://basis.gnulinux.pro/ru/latest/_images/podman.png" alt=""></p><p>Podman – это инструмент с открытым исходным кодом для поиска, сборки, передачи и запуска приложений. Является утилитой командной строки с аналогичными docker командами, однако не требует дополнительный сервис для работы и может работать без прав доступа root. По умолчанию использует в качестве Container Runtime crun (ранее runc).</p><p>Возможность работать с контейнерами без прав root приводит к нескольким особенностям:</p><ul><li>все файлы Podman (образы, контейнеры и др.) пользователей с правами доступа root хранятся в каталоге <code>/var/lib/containers</code>, без прав доступа root – в <code>~/.local/share/containers</code></li><li>пользователи без root прав по умолчанию не могут использовать привилегированные порты и полноценно использовать некоторые команды</li></ul><h2 id="установка-podman" tabindex="-1">Установка Podman <a class="header-anchor" href="#установка-podman" aria-label="Permalink to &quot;Установка Podman&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">apt-get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> podman</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> podman-compose</span></span></code></pre></div><p>Если Вам нужен Docker-совместимый сокет (например, для Docker CLI или других инструментов), включите службу:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> enable</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --now</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> podman.socket</span></span></code></pre></div><p>Для rootless (пользовательский режим):</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --user</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> enable</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --now</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> podman.socket</span></span></code></pre></div><h2 id="rootless-режим" tabindex="-1">Rootless режим <a class="header-anchor" href="#rootless-режим" aria-label="Permalink to &quot;Rootless режим&quot;">​</a></h2><p>Для использования podman непривилегированными пользователями, необходимо произвести ряд дополнительных действий по настройке прав:</p><p>Проверить наличие разрешения на создание пользовательских пространств имён:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sysctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kernel.unprivileged_userns_clone</span></span></code></pre></div><p>Если отсутствует, то разрешаем (устанавливаем пакет с необходимой конфигурацией)</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">apt-get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sysctl-conf-userns</span></span></code></pre></div><p>Предоставить права на запуск исполняемых файлов <code>/usr/bin/newuidmap</code> и <code>/usr/bin/newgidmap</code> пользователям, не являющимся владельцами файла и не принадлежащим к группе владельца файла:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">control</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> newgidmap</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> public</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">control</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> newuidmap</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> public</span></span></code></pre></div><p>Поскольку эти исполняемые файлы обращаются к системным вызовам <code>setuid()</code> и <code>setgid()</code>, чтобы лишний раз не выдавать SUID бит, задайте этим файлам соответствующие file capabilities:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setcap</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cap_setuid+ep</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /usr/bin/newuidmap</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setcap</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cap_setgid+ep</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /usr/bin/newgidmap</span></span></code></pre></div><p>Если при попытке работы с podman под непривилегированным пользователем (например, <code>&quot;$ podman images&quot;</code>) выдаётся ошибка <code>&quot;Error: kernel does not support overlay fs: &#39;overlay&#39; is not supported ...&quot;</code>, то нужно донастроить <code>Fuse</code>:</p><p>Под пользователем root:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">apt-get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> fuse-overlayfs</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">control</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> fusermount</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> fuseonly</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">usermod</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -aG</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> fuse</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">your_unprivileged_user_her</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span></code></pre></div><p>Далее нужно перезайти под непривилегированным пользователем и проверить, что нет ошибок - вывод должен быть примерно такого вида:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> fusermount</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -V</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># fusermount version: 2.9.9</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> fusermount3</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -V</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># fusermount3 version: 3.16.2</span></span></code></pre></div><p>Этих действий достаточно для запуска podman непривилегированными пользователями.</p><div class="tip custom-block"><p class="custom-block-title">Примечание:</p><p>Чтобы podman могли запускать непривилегированные пользователи, для каждого такого пользователя должна существовать запись конфигурации subuid и subgid. Новые пользователи, созданные после установки podman, имеют эти записи по умолчанию.</p><p>Для пользователей, у которых нет записей в <code>/etc/subuid</code> и <code>/etc/subgid</code>, можно создать запись с помощью команды <code>usermod</code>, например:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">usermod</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --add-subuids</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 100000-165535</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --add-subgids</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 100000-165535</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> имя_пользователя</span></span></code></pre></div><p>Данная команда выделяет заданный диапазон UID и GID пользователю, что позволит пользователю и группе с именем пользователя запускать контейнеры Podman.</p><p>В случае попытки добавить доменного пользователя, имя пользователя вносится в <code>/etc/subuid</code> и <code>/etc/subgid</code> вручную.</p><p>Указанный выше диапазон UID и GID уже может быть занят другим пользователем, т.к. это диапазон по умолчанию для первого пользователя. Просмотреть занятые диапазоны можно в файлах <code>/etc/subuid</code> и <code>/etc/subgid</code>, например:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/subuid</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># user:100000:65536</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># user2:165536:65536</span></span></code></pre></div><p>Многим образам требуется 65536 uid/gid для сопоставления. Рекомендуется выделять как минимум столько uid/gid для каждого пользователя.</p><p>Для применения изменений в <code>subuid</code> и <code>subgid</code> необходимо выполнить команду:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> podman</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> system</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> migrate</span></span></code></pre></div></div><h2 id="запуск-образов" tabindex="-1">Запуск образов <a class="header-anchor" href="#запуск-образов" aria-label="Permalink to &quot;Запуск образов&quot;">​</a></h2><p>Podman предоставляет совместимый с Docker интерфейс CLI, а следовательно допустимо настроить при необходимости <code>alias docker=podman</code>:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;alias docker=podman&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~/.bashrc</span></span></code></pre></div><p>Загрузка образа из репозитория:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">podman</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pull</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> registry.altlinux.org/alt/alt</span></span></code></pre></div><p>Запуск контейнера из образа:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">podman</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -it</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> alt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> registry.altlinux.org/alt/alt</span></span></code></pre></div>`,35)]))}const g=i(n,[["render",p]]);export{r as __pageData,g as default};
