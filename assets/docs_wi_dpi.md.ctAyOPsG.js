import{_ as a,c as i,o as e,ag as t}from"./chunks/framework.D4Vqf8I7.js";const c=JSON.parse('{"title":"DPI","description":"","frontmatter":{},"headers":[],"relativePath":"docs/wi/dpi.md","filePath":"docs/wi/dpi.md","lastUpdated":1760613678000}'),n={name:"docs/wi/dpi.md"};function l(h,s,p,r,o,d){return e(),i("div",null,s[0]||(s[0]=[t(`<h1 id="dpi" tabindex="-1">DPI <a class="header-anchor" href="#dpi" aria-label="Permalink to &quot;DPI&quot;">‚Äã</a></h1><p><strong>DPI (Deep Packet Inspection ‚Äî –≥–ª—É–±–æ–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞–∫–µ—Ç–æ–≤)</strong> ‚Äî —ç—Ç–æ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è –∞–Ω–∞–ª–∏–∑–∞ —Å–µ—Ç–µ–≤–æ–≥–æ —Ç—Ä–∞—Ñ–∏–∫–∞, –ø—Ä–∏ –∫–æ—Ç–æ—Ä–æ–π –∏–Ω—Å–ø–µ–∫—Ç–∏—Ä—É–µ—Ç—Å—è –Ω–µ —Ç–æ–ª—å–∫–æ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –ø–∞–∫–µ—Ç–∞ (IP-–∞–¥—Ä–µ—Å–∞, –ø–æ—Ä—Ç—ã, –ø—Ä–æ—Ç–æ–∫–æ–ª), –Ω–æ –∏ <strong>—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø–æ–ª–µ–∑–Ω–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏ (payload)</strong> –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø—Ä–∏–∫–ª–∞–¥–Ω–æ–≥–æ —É—Ä–æ–≤–Ω—è (L7 –º–æ–¥–µ–ª–∏ OSI). –í –æ—Ç–ª–∏—á–∏–µ –æ—Ç —Ç—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω—ã—Ö –º–µ–∂—Å–µ—Ç–µ–≤—ã—Ö —ç–∫—Ä–∞–Ω–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–∞ —É—Ä–æ–≤–Ω—è—Ö L3‚ÄìL4 –∏ –ø—Ä–∏–Ω–∏–º–∞—é—Ç —Ä–µ—à–µ–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ IP –∏ –ø–æ—Ä—Ç–æ–≤, DPI —Å–ø–æ—Å–æ–±–µ–Ω —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, —Å–µ—Ä–≤–∏—Å—ã, –∫–æ–º–∞–Ω–¥—ã –∏ –¥–∞–∂–µ —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö –≤–Ω—É—Ç—Ä–∏ —Ç—Ä–∞—Ñ–∏–∫–∞ ‚Äî –Ω–∞–ø—Ä–∏–º–µ—Ä, –æ—Ç–ª–∏—á–∏—Ç—å –≤–∏–¥–µ–æ–ø–æ—Ç–æ–∫ YouTube –æ—Ç –æ–±—ã—á–Ω–æ–≥–æ HTTPS-—Ç—Ä–∞—Ñ–∏–∫–∞, –æ–±–Ω–∞—Ä—É–∂–∏—Ç—å —Ç–æ—Ä—Ä–µ–Ω—Ç-—Å–µ—Å—Å–∏—é –∏–ª–∏ –≤—ã—è–≤–∏—Ç—å –ø–æ–ø—ã—Ç–∫—É –ø–µ—Ä–µ–¥–∞—á–∏ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏.</p><p><strong>–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?</strong><br> DPI-—Å–∏—Å—Ç–µ–º–∞ –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç —Å–µ—Ç–µ–≤—ã–µ –ø–∞–∫–µ—Ç—ã, —Å–æ–±–∏—Ä–∞–µ—Ç –∏—Ö –≤ –ª–æ–≥–∏—á–µ—Å–∫–∏–µ –ø–æ—Ç–æ–∫–∏ (flows), –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å–µ—Å—Å–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, HTTP-–∑–∞–ø—Ä–æ—Å—ã –∏–ª–∏ TLS-—Ä—É–∫–æ–ø–æ–∂–∞—Ç–∏—è) –∏ –ø—Ä–∏–º–µ–Ω—è–µ—Ç –∫ –Ω–∏–º –Ω–∞–±–æ—Ä –ø—Ä–∞–≤–∏–ª –∏–ª–∏ —Å–∏–≥–Ω–∞—Ç—É—Ä. –≠—Ç–∏ –ø—Ä–∞–≤–∏–ª–∞ –º–æ–≥—É—Ç –±—ã—Ç—å –æ—Å–Ω–æ–≤–∞–Ω—ã –Ω–∞:</p><ul><li><strong>–°—Ç—Ä–æ–∫–æ–≤—ã—Ö —à–∞–±–ª–æ–Ω–∞—Ö</strong> (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ–∏—Å–∫ &quot;User-Agent: BitTorrent&quot; –≤ –∑–∞–≥–æ–ª–æ–≤–∫–∞—Ö),</li><li><strong>–ü–æ–≤–µ–¥–µ–Ω—á–µ—Å–∫–∏—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–∞—Ö</strong> (—Ö–∞—Ä–∞–∫—Ç–µ—Ä–Ω—ã–π –æ–±–º–µ–Ω –ø–∞–∫–µ—Ç–∞–º–∏ —É –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–æ–≤),</li><li><strong>–ê–Ω–∞–ª–∏–∑–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö</strong> (SNI –≤ TLS, JA3-—Ñ–∏–Ω–≥–µ—Ä–ø—Ä–∏–Ω—Ç—ã, DNS-–∑–∞–ø—Ä–æ—Å—ã),</li><li><strong>–ú–∞—à–∏–Ω–Ω–æ–º –æ–±—É—á–µ–Ω–∏–∏</strong> (–≤ –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö).</li></ul><p>–ï—Å–ª–∏ —Ç—Ä–∞—Ñ–∏–∫ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –∫—Ä–∏—Ç–µ—Ä–∏—è–º –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –æ–±–Ω–∞—Ä—É–∂–µ–Ω –∑–∞–ø—Ä–µ—â—ë–Ω–Ω—ã–π —Å–µ—Ä–≤–∏—Å), DPI-—Å–∏—Å—Ç–µ–º–∞ –º–æ–∂–µ—Ç <strong>–æ—Ç–±—Ä–æ—Å–∏—Ç—å –ø–∞–∫–µ—Ç</strong>, <strong>–ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç—å –µ–≥–æ</strong>, <strong>–æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å –ø—Ä–æ–ø—É—Å–∫–Ω—É—é —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å</strong> –∏–ª–∏ <strong>–∑–∞–ø–∏—Å–∞—Ç—å –≤ –ª–æ–≥</strong> –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ –∞–Ω–∞–ª–∏–∑–∞.</p><p><strong>–ì–¥–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è DPI?</strong><br> –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è —à–∏—Ä–æ–∫–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞–º–∏ –¥–ª—è —Ç–∞—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, ¬´–±–µ–∑–ª–∏–º–∏—Ç –Ω–∞ YouTube¬ª), –∫–æ—Ä–ø–æ—Ä–∞—Ü–∏—è–º–∏ ‚Äî –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è –∑–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Ä–µ—Å—É—Ä—Å–æ–≤ –∏ –∑–∞—â–∏—Ç—ã –æ—Ç —É—Ç–µ—á–µ–∫ –¥–∞–Ω–Ω—ã—Ö, –∞ —Ç–∞–∫–∂–µ –≤ —Å–∏—Å—Ç–µ–º–∞—Ö –∫–∏–±–µ—Ä–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (IDS/IPS) –¥–ª—è –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è –≤—Ä–µ–¥–æ–Ω–æ—Å–Ω–æ–≥–æ —Ç—Ä–∞—Ñ–∏–∫–∞. –û–¥–Ω–∞–∫–æ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å DPI —Å–Ω–∏–∂–∞–µ—Ç—Å—è –ø—Ä–∏ –º–∞—Å—Å–æ–≤–æ–º –ø–µ—Ä–µ—Ö–æ–¥–µ –Ω–∞ <strong>—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ (HTTPS, TLS 1.3)</strong>, —Ç–∞–∫ –∫–∞–∫ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø–∞–∫–µ—Ç–æ–≤ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã–º –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞. –í —Ç–∞–∫–∏—Ö —Å–ª—É—á–∞—è—Ö DPI –≤—ã–Ω—É–∂–¥–µ–Ω –ø–æ–ª–∞–≥–∞—Ç—å—Å—è –Ω–∞ –∫–æ—Å–≤–µ–Ω–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ ‚Äî –Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–æ–º–µ–Ω–Ω–æ–µ –∏–º—è –∏–∑ SNI (Server Name Indication) –∏–ª–∏ –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è.</p><p><a href="https://packages.altlinux.org/ru/p11/binary/libnDPI/x86_64/2705258196539121831" target="_blank" rel="noreferrer">https://packages.altlinux.org/ru/p11/binary/libnDPI/x86_64/2705258196539121831</a></p><p><a href="https://github.com/ntop/nDPI" target="_blank" rel="noreferrer">https://github.com/ntop/nDPI</a></p><p>ntopng</p><p>Netify</p><p>[–°–µ—Ç–µ–≤–æ–π —Ç—Ä–∞—Ñ–∏–∫] ‚Üì [iptables + NFQUEUE] ‚Üí –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –ø–∞–∫–µ—Ç—ã –≤ userspace ‚Üì [Suricata <a href="https://packages.altlinux.org/ru/p11/binary/suricata/x86_64/" target="_blank" rel="noreferrer">https://packages.altlinux.org/ru/p11/binary/suricata/x86_64/</a>] ‚Üí DPI-–∞–Ω–∞–ª–∏–∑ ‚Üì [–†–µ—à–µ–Ω–∏–µ: DROP / ACCEPT] ‚Üì [iptables] ‚Üê —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ NFQUEUE –∏–ª–∏ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –ø—Ä–∞–≤–∏–ª–∞</p><p><a href="https://docs.securityonion.net/en/2.4/getting-started.html" target="_blank" rel="noreferrer">https://docs.securityonion.net/en/2.4/getting-started.html</a> - –∫–∞–∫ –∑–∞–º–µ–Ω–∞ —Å–±–æ—Ä–∫–∏ –Ω–∏–∂–µ</p><h2 id="suricata-–≤-—Ä–µ–∂–∏–º–µ-ips-nfqueue-iptables" tabindex="-1">Suricata (–≤ —Ä–µ–∂–∏–º–µ IPS) + NFQUEUE + iptables <a class="header-anchor" href="#suricata-–≤-—Ä–µ–∂–∏–º–µ-ips-nfqueue-iptables" aria-label="Permalink to &quot;Suricata (–≤ —Ä–µ–∂–∏–º–µ IPS) + NFQUEUE + iptables&quot;">‚Äã</a></h2><h2 id="üîß-—à–∞–≥-1-—É—Å—Ç–∞–Ω–æ–≤–∫–∞-suricata" tabindex="-1">üîß –®–∞–≥ 1: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Suricata <a class="header-anchor" href="#üîß-—à–∞–≥-1-—É—Å—Ç–∞–Ω–æ–≤–∫–∞-suricata" aria-label="Permalink to &quot;üîß –®–∞–≥ 1: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Suricata&quot;">‚Äã</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apt-get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> suricata</span></span></code></pre></div><p>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–µ—Ä—Å–∏—é:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">suricata</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --build-info</span></span></code></pre></div><p>–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è <strong>NFQUEUE</strong>:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">suricata</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --build-info</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> grep</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> NFQ</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: NFQ support:                       yes</span></span></code></pre></div><hr><h2 id="üîß-—à–∞–≥-2-–Ω–∞—Å—Ç—Ä–æ–∏–∫–∞-suricata-–¥–ª—è-—Ä–∞–±–æ—Ç—ã-–≤-—Ä–µ–∂–∏–º–µ-ips-—á–µ—Ä–µ–∑-nfqueue" tabindex="-1">üîß –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Suricata –¥–ª—è —Ä–∞–±–æ—Ç—ã –≤ —Ä–µ–∂–∏–º–µ IPS —á–µ—Ä–µ–∑ NFQUEUE <a class="header-anchor" href="#üîß-—à–∞–≥-2-–Ω–∞—Å—Ç—Ä–æ–∏–∫–∞-suricata-–¥–ª—è-—Ä–∞–±–æ—Ç—ã-–≤-—Ä–µ–∂–∏–º–µ-ips-—á–µ—Ä–µ–∑-nfqueue" aria-label="Permalink to &quot;üîß –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Suricata –¥–ª—è —Ä–∞–±–æ—Ç—ã –≤ —Ä–µ–∂–∏–º–µ IPS —á–µ—Ä–µ–∑ NFQUEUE&quot;">‚Äã</a></h2><h3 id="_2-1-—Ä–µ–∑–µ—Ä–≤–Ω–∞—è-–∫–æ–ø–∏—è-–∫–æ–Ω—Ñ–∏–≥–∞" tabindex="-1">2.1 –†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è –∫–æ–Ω—Ñ–∏–≥–∞ <a class="header-anchor" href="#_2-1-—Ä–µ–∑–µ—Ä–≤–Ω–∞—è-–∫–æ–ø–∏—è-–∫–æ–Ω—Ñ–∏–≥–∞" aria-label="Permalink to &quot;2.1 –†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è –∫–æ–Ω—Ñ–∏–≥–∞&quot;">‚Äã</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/suricata/suricata.yaml</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/suricata/suricata.yaml.bak</span></span></code></pre></div><h3 id="_2-2-–æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–∏—Ç–µ-–æ—Å–Ω–æ–≤–Ω–æ–∏-–∫–æ–Ω—Ñ–∏–≥" tabindex="-1">2.2 –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥ <a class="header-anchor" href="#_2-2-–æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–∏—Ç–µ-–æ—Å–Ω–æ–≤–Ω–æ–∏-–∫–æ–Ω—Ñ–∏–≥" aria-label="Permalink to &quot;2.2 –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥&quot;">‚Äã</a></h3><p>–û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nano</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/suricata/suricata.yaml</span></span></code></pre></div><h4 id="üîπ-–Ω–∞–∏–¥–∏—Ç–µ-—Å–µ–∫—Ü–∏—é-af-packet-–∏-–∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–∏—Ç–µ-–∏–ª–∏-—É–¥–∞–ª–∏—Ç–µ-–µ–µ-–º—ã-–Ω–µ-–±—É–¥–µ–º-–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å-af-packet-—Ç–∞–∫-–∫–∞–∫-—Ç—Ä–∞—Ñ–∏–∫-–ø—Ä–∏—Ö–æ–¥–∏—Ç-—á–µ—Ä–µ–∑-nfqueue" tabindex="-1">üîπ –ù–∞–π–¥–∏—Ç–µ —Å–µ–∫—Ü–∏—é <code>af-packet</code> –∏ <strong>–∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –∏–ª–∏ —É–¥–∞–ª–∏—Ç–µ</strong> –µ—ë (–º—ã –Ω–µ –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å AF_PACKET, —Ç–∞–∫ –∫–∞–∫ —Ç—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ NFQUEUE). <a class="header-anchor" href="#üîπ-–Ω–∞–∏–¥–∏—Ç–µ-—Å–µ–∫—Ü–∏—é-af-packet-–∏-–∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–∏—Ç–µ-–∏–ª–∏-—É–¥–∞–ª–∏—Ç–µ-–µ–µ-–º—ã-–Ω–µ-–±—É–¥–µ–º-–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å-af-packet-—Ç–∞–∫-–∫–∞–∫-—Ç—Ä–∞—Ñ–∏–∫-–ø—Ä–∏—Ö–æ–¥–∏—Ç-—á–µ—Ä–µ–∑-nfqueue" aria-label="Permalink to &quot;üîπ –ù–∞–π–¥–∏—Ç–µ —Å–µ–∫—Ü–∏—é \`af-packet\` –∏ **–∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –∏–ª–∏ —É–¥–∞–ª–∏—Ç–µ** –µ—ë (–º—ã –Ω–µ –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å AF_PACKET, —Ç–∞–∫ –∫–∞–∫ —Ç—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ NFQUEUE).&quot;">‚Äã</a></h4><h4 id="üîπ-–Ω–∞–∏–¥–∏—Ç–µ-—Å–µ–∫—Ü–∏—é-outputs-–∏-–≤–∫–ª—é—á–∏—Ç–µ-nfqueue" tabindex="-1">üîπ –ù–∞–π–¥–∏—Ç–µ —Å–µ–∫—Ü–∏—é <code>outputs</code> –∏ <strong>–≤–∫–ª—é—á–∏—Ç–µ NFQUEUE</strong> <a class="header-anchor" href="#üîπ-–Ω–∞–∏–¥–∏—Ç–µ-—Å–µ–∫—Ü–∏—é-outputs-–∏-–≤–∫–ª—é—á–∏—Ç–µ-nfqueue" aria-label="Permalink to &quot;üîπ –ù–∞–π–¥–∏—Ç–µ —Å–µ–∫—Ü–∏—é \`outputs\` –∏ **–≤–∫–ª—é—á–∏—Ç–µ NFQUEUE**&quot;">‚Äã</a></h4><p>–ü—Ä–∏–º–µ—Ä:</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">outputs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      enabled</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">no</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">file</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      enabled</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">no</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">eve-log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      enabled</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">no</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">stats</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      enabled</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">no</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">nfq</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      enabled</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">yes</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      queue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      # –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: –µ—Å–ª–∏ –ø—Ä–∞–≤–∏–ª–æ —Å action &quot;drop&quot;, –ø–∞–∫–µ—Ç –±—É–¥–µ—Ç –æ—Ç–±—Ä–æ—à–µ–Ω</span></span></code></pre></div><blockquote><p><code>queue: 0</code> ‚Äî –Ω–æ–º–µ—Ä –æ—á–µ—Ä–µ–¥–∏ NFQUEUE, —Å –∫–æ—Ç–æ—Ä–æ–π –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å Suricata.</p></blockquote><h4 id="üîπ-–æ—Ç–∫–ª—é—á–∏—Ç–µ-–Ω–µ–Ω—É–∂–Ω—ã–µ-–ª–æ–≥–∏-–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ-–¥–ª—è-–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏" tabindex="-1">üîπ –û—Ç–∫–ª—é—á–∏—Ç–µ –Ω–µ–Ω—É–∂–Ω—ã–µ –ª–æ–≥–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏) <a class="header-anchor" href="#üîπ-–æ—Ç–∫–ª—é—á–∏—Ç–µ-–Ω–µ–Ω—É–∂–Ω—ã–µ-–ª–æ–≥–∏-–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ-–¥–ª—è-–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏" aria-label="Permalink to &quot;üîπ –û—Ç–∫–ª—é—á–∏—Ç–µ –Ω–µ–Ω—É–∂–Ω—ã–µ –ª–æ–≥–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏)&quot;">‚Äã</a></h4><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">logging</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  default-log-level</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">warning</span></span></code></pre></div><h4 id="üîπ-—É–±–µ–¥–∏—Ç–µ—Å—å-—á—Ç–æ-–≤–∫–ª—é—á–µ–Ω–∞-–ø–æ–¥–¥–µ—Ä–∂–∫–∞-–ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤" tabindex="-1">üîπ –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤–∫–ª—é—á–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤ <a class="header-anchor" href="#üîπ-—É–±–µ–¥–∏—Ç–µ—Å—å-—á—Ç–æ-–≤–∫–ª—é—á–µ–Ω–∞-–ø–æ–¥–¥–µ—Ä–∂–∫–∞-–ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤" aria-label="Permalink to &quot;üîπ –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤–∫–ª—é—á–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤&quot;">‚Äã</a></h4><p>–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤–∫–ª—é—á–µ–Ω—ã HTTP, TLS, DNS –∏ –¥—Ä. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">app-layer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  protocols</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    tls</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      enabled</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">yes</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    http</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      enabled</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">yes</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    dns</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      enabled</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">yes</span></span></code></pre></div><hr><h2 id="üîß-—à–∞–≥-3-—Å–æ–∑–¥–∞–Ω–∏–µ-–ø—Ä–∞–≤–∏–ª-dpi-–ª–æ–∫–∞–ª—å–Ω—ã–µ-–ø—Ä–∞–≤–∏–ª–∞" tabindex="-1">üîß –®–∞–≥ 3: –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–∞–≤–∏–ª DPI (–ª–æ–∫–∞–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞) <a class="header-anchor" href="#üîß-—à–∞–≥-3-—Å–æ–∑–¥–∞–Ω–∏–µ-–ø—Ä–∞–≤–∏–ª-dpi-–ª–æ–∫–∞–ª—å–Ω—ã–µ-–ø—Ä–∞–≤–∏–ª–∞" aria-label="Permalink to &quot;üîß –®–∞–≥ 3: –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–∞–≤–∏–ª DPI (–ª–æ–∫–∞–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞)&quot;">‚Äã</a></h2><p>Suricata –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–∞–≤–∏–ª–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ Snort. –ú—ã —Å–æ–∑–¥–∞–¥–∏–º —Å–≤–æ–∏.</p><h3 id="_3-1-—Å–æ–∑–¥–∞–∏—Ç–µ-—Ñ–∞–∏–ª-–ª–æ–∫–∞–ª—å–Ω—ã—Ö-–ø—Ä–∞–≤–∏–ª" tabindex="-1">3.1 –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª –ª–æ–∫–∞–ª—å–Ω—ã—Ö –ø—Ä–∞–≤–∏–ª <a class="header-anchor" href="#_3-1-—Å–æ–∑–¥–∞–∏—Ç–µ-—Ñ–∞–∏–ª-–ª–æ–∫–∞–ª—å–Ω—ã—Ö-–ø—Ä–∞–≤–∏–ª" aria-label="Permalink to &quot;3.1 –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª –ª–æ–∫–∞–ª—å–Ω—ã—Ö –ø—Ä–∞–≤–∏–ª&quot;">‚Äã</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nano</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/suricata/rules/local.rules</span></span></code></pre></div><p>–î–æ–±–∞–≤—å—Ç–µ –ø—Ä–∏–º–µ—Ä—ã:</p><div class="language-suricata vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">suricata</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># –ë–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å —Ç–æ—Ä—Ä–µ–Ω—Ç-—Ç—Ä–∞—Ñ–∏–∫ –ø–æ —Å–∏–≥–Ω–∞—Ç—É—Ä–µ</span></span>
<span class="line"><span>drop ip any any -&gt; any any (msg:&quot;P2P BitTorrent detected&quot;; flow:established,to_server; content:&quot;BitTorrent&quot;; nocase; reference:url,example.com; sid:1000001; rev:1;)</span></span>
<span class="line"><span></span></span>
<span class="line"><span># –ë–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –¥–æ—Å—Ç—É–ø –∫ youtube.com –ø–æ HTTP Host</span></span>
<span class="line"><span>drop http any any -&gt; any any (msg:&quot;Block YouTube HTTP&quot;; http.host; content:&quot;youtube.com&quot;; nocase; sid:1000002; rev:1;)</span></span>
<span class="line"><span></span></span>
<span class="line"><span># –ë–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ SNI –≤ TLS (HTTPS)</span></span>
<span class="line"><span>drop tls any any -&gt; any any (msg:&quot;Block YouTube TLS&quot;; tls.sni; content:&quot;youtube.com&quot;; nocase; sid:1000003; rev:1;)</span></span>
<span class="line"><span></span></span>
<span class="line"><span># –ë–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å Telegram (–ø–æ –¥–æ–º–µ–Ω—É)</span></span>
<span class="line"><span>drop tls any any -&gt; any any (msg:&quot;Block Telegram&quot;; tls.sni; content:&quot;telegram.org&quot;; nocase; sid:1000004; rev:1;)</span></span></code></pre></div><blockquote><p>‚ö†Ô∏è <strong>–í–∞–∂–Ω–æ</strong>:</p><ul><li>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ <code>drop</code>, –∞ –Ω–µ <code>alert</code>, —á—Ç–æ–±—ã <strong>–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å</strong> —Ç—Ä–∞—Ñ–∏–∫.</li><li><code>sid</code> (Signature ID) –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º –∏ &gt; 1000000 –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –ø—Ä–∞–≤–∏–ª.</li></ul></blockquote><h3 id="_3-2-–ø–æ–¥–∫–ª—é—á–∏—Ç–µ-—Ñ–∞–∏–ª-–ø—Ä–∞–≤–∏–ª-–≤-–∫–æ–Ω—Ñ–∏–≥–µ" tabindex="-1">3.2 –ü–æ–¥–∫–ª—é—á–∏—Ç–µ —Ñ–∞–π–ª –ø—Ä–∞–≤–∏–ª –≤ –∫–æ–Ω—Ñ–∏–≥–µ <a class="header-anchor" href="#_3-2-–ø–æ–¥–∫–ª—é—á–∏—Ç–µ-—Ñ–∞–∏–ª-–ø—Ä–∞–≤–∏–ª-–≤-–∫–æ–Ω—Ñ–∏–≥–µ" aria-label="Permalink to &quot;3.2 –ü–æ–¥–∫–ª—é—á–∏—Ç–µ —Ñ–∞–π–ª –ø—Ä–∞–≤–∏–ª –≤ –∫–æ–Ω—Ñ–∏–≥–µ&quot;">‚Äã</a></h3><p>–í —Ç–æ–º –∂–µ <code>suricata.yaml</code> –Ω–∞–π–¥–∏—Ç–µ —Å–µ–∫—Ü–∏—é:</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">rule-files</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">suricata.rules</span></span></code></pre></div><p>–î–æ–±–∞–≤—å—Ç–µ –≤–∞—à —Ñ–∞–π–ª:</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">rule-files</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">suricata.rules</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">local.rules</span></span></code></pre></div><hr><h2 id="üîß-—à–∞–≥-4-–Ω–∞—Å—Ç—Ä–æ–∏–∫–∞-iptables-–¥–ª—è-–ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è-—Ç—Ä–∞—Ñ–∏–∫–∞-–≤-suricata" tabindex="-1">üîß –®–∞–≥ 4: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ iptables –¥–ª—è –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç—Ä–∞—Ñ–∏–∫–∞ –≤ Suricata <a class="header-anchor" href="#üîß-—à–∞–≥-4-–Ω–∞—Å—Ç—Ä–æ–∏–∫–∞-iptables-–¥–ª—è-–ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è-—Ç—Ä–∞—Ñ–∏–∫–∞-–≤-suricata" aria-label="Permalink to &quot;üîß –®–∞–≥ 4: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ iptables –¥–ª—è –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç—Ä–∞—Ñ–∏–∫–∞ –≤ Suricata&quot;">‚Äã</a></h2><p>Suricata –Ω–µ –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç —Ç—Ä–∞—Ñ–∏–∫ —Å–∞–º ‚Äî –µ–≥–æ –Ω—É–∂–Ω–æ –Ω–∞–ø—Ä–∞–≤–∏—Ç—å —á–µ—Ä–µ–∑ <strong>NFQUEUE</strong>.</p><h3 id="–≤–∞—Ä–∏–∞–Ω—Ç-a-—Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è-–≤—Å–µ–≥–æ-—Ç—Ä–∞—Ñ–∏–∫–∞-—á–µ—Ä–µ–∑-–º–∞—à–∏–Ω—É-–µ—Å–ª–∏-—ç—Ç–æ-—à–ª—é–∑" tabindex="-1">–í–∞—Ä–∏–∞–Ω—Ç A: –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è <strong>–≤—Å–µ–≥–æ —Ç—Ä–∞—Ñ–∏–∫–∞ —á–µ—Ä–µ–∑ –º–∞—à–∏–Ω—É</strong> (–µ—Å–ª–∏ —ç—Ç–æ —à–ª—é–∑) <a class="header-anchor" href="#–≤–∞—Ä–∏–∞–Ω—Ç-a-—Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è-–≤—Å–µ–≥–æ-—Ç—Ä–∞—Ñ–∏–∫–∞-—á–µ—Ä–µ–∑-–º–∞—à–∏–Ω—É-–µ—Å–ª–∏-—ç—Ç–æ-—à–ª—é–∑" aria-label="Permalink to &quot;–í–∞—Ä–∏–∞–Ω—Ç A: –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è **–≤—Å–µ–≥–æ —Ç—Ä–∞—Ñ–∏–∫–∞ —á–µ—Ä–µ–∑ –º–∞—à–∏–Ω—É** (–µ—Å–ª–∏ —ç—Ç–æ —à–ª—é–∑)&quot;">‚Äã</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># –û—á–∏—Å—Ç–∏—Ç–µ —Ü–µ–ø–æ—á–∫—É (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> iptables</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -F</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –í–ï–°–¨ –ø—Ä–æ—Ö–æ–¥—è—â–∏–π —Ç—Ä–∞—Ñ–∏–∫ –≤ NFQUEUE 0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> iptables</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -I</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> FORWARD</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -j</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> NFQUEUE</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --queue-num</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span></span></code></pre></div><blockquote><p>–≠—Ç–æ –∞–∫—Ç—É–∞–ª—å–Ω–æ, –µ—Å–ª–∏ –º–∞—à–∏–Ω–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ <strong>—Ä–æ—É—Ç–µ—Ä/—à–ª—é–∑</strong> –¥–ª—è –¥—Ä—É–≥–∏—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤.</p></blockquote><h3 id="–≤–∞—Ä–∏–∞–Ω—Ç-b-—Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è-–ª–æ–∫–∞–ª—å–Ω–æ–≥–æ-–∏—Å—Ö–æ–¥—è—â–µ–≥–æ-—Ç—Ä–∞—Ñ–∏–∫–∞" tabindex="-1">–í–∞—Ä–∏–∞–Ω—Ç B: –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è <strong>–ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∏—Å—Ö–æ–¥—è—â–µ–≥–æ —Ç—Ä–∞—Ñ–∏–∫–∞</strong> <a class="header-anchor" href="#–≤–∞—Ä–∏–∞–Ω—Ç-b-—Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è-–ª–æ–∫–∞–ª—å–Ω–æ–≥–æ-–∏—Å—Ö–æ–¥—è—â–µ–≥–æ-—Ç—Ä–∞—Ñ–∏–∫–∞" aria-label="Permalink to &quot;–í–∞—Ä–∏–∞–Ω—Ç B: –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è **–ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∏—Å—Ö–æ–¥—è—â–µ–≥–æ —Ç—Ä–∞—Ñ–∏–∫–∞**&quot;">‚Äã</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> iptables</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -I</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> OUTPUT</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -j</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> NFQUEUE</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --queue-num</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span></span></code></pre></div><blockquote><p>–ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ –æ–¥–Ω–æ–º –ü–ö.</p></blockquote><h3 id="‚ö†Ô∏è-–≤–∞–∂–Ω–æ-–Ω–µ-–±–ª–æ–∫–∏—Ä—É–∏—Ç–µ-ssh" tabindex="-1">‚ö†Ô∏è –í–∞–∂–Ω–æ: –Ω–µ –±–ª–æ–∫–∏—Ä—É–π—Ç–µ SSH! <a class="header-anchor" href="#‚ö†Ô∏è-–≤–∞–∂–Ω–æ-–Ω–µ-–±–ª–æ–∫–∏—Ä—É–∏—Ç–µ-ssh" aria-label="Permalink to &quot;‚ö†Ô∏è –í–∞–∂–Ω–æ: –Ω–µ –±–ª–æ–∫–∏—Ä—É–π—Ç–µ SSH!&quot;">‚Äã</a></h3><p>–ï—Å–ª–∏ –≤—ã –ø–æ–¥–∫–ª—é—á–µ–Ω—ã –ø–æ SSH, –¥–æ–±–∞–≤—å—Ç–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># –†–∞–∑—Ä–µ—à–∏—Ç—å SSH –¥–æ NFQUEUE</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> iptables</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -I</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> OUTPUT</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tcp</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --dport</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 22</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -j</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ACCEPT</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># –ò–õ–ò –¥–ª—è —à–ª—é–∑–∞:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> iptables</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -I</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> FORWARD</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tcp</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --dport</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 22</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -j</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ACCEPT</span></span></code></pre></div><p>–ò–Ω–∞—á–µ –≤—ã –º–æ–∂–µ—Ç–µ –ø–æ—Ç–µ—Ä—è—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ!</p><hr><h2 id="üîß-—à–∞–≥-5-–∑–∞–ø—É—Å–∫-suricata-–≤-—Ä–µ–∂–∏–º–µ-ips" tabindex="-1">üîß –®–∞–≥ 5: –ó–∞–ø—É—Å–∫ Suricata –≤ —Ä–µ–∂–∏–º–µ IPS <a class="header-anchor" href="#üîß-—à–∞–≥-5-–∑–∞–ø—É—Å–∫-suricata-–≤-—Ä–µ–∂–∏–º–µ-ips" aria-label="Permalink to &quot;üîß –®–∞–≥ 5: –ó–∞–ø—É—Å–∫ Suricata –≤ —Ä–µ–∂–∏–º–µ IPS&quot;">‚Äã</a></h2><p>–û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Å–ª—É–∂–±—É (–µ—Å–ª–∏ –∑–∞–ø—É—â–µ–Ω–∞):</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> stop</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> suricata</span></span></code></pre></div><p>–ó–∞–ø—É—Å—Ç–∏—Ç–µ –≤—Ä—É—á–Ω—É—é –¥–ª—è —Ç–µ—Å—Ç–∞:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> suricata</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -c</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/suricata/suricata.yaml</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -q</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span></span></code></pre></div><p>–§–ª–∞–≥–∏:</p><ul><li><code>-c</code> ‚Äî –ø—É—Ç—å –∫ –∫–æ–Ω—Ñ–∏–≥—É,</li><li><code>-q 0</code> ‚Äî –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –æ—á–µ—Ä–µ–¥—å NFQUEUE ‚Ññ0.</li></ul><blockquote><p>–ï—Å–ª–∏ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç, –≤—ã —É–≤–∏–¥–∏—Ç–µ –ª–æ–≥–∏ –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ. –ù–∞–∂–º–∏—Ç–µ <code>Ctrl+C</code> –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏.</p></blockquote><h3 id="–∑–∞–ø—É—Å–∫-–∫–∞–∫-—Å–ª—É–∂–±—ã-–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ" tabindex="-1">–ó–∞–ø—É—Å–∫ –∫–∞–∫ —Å–ª—É–∂–±—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) <a class="header-anchor" href="#–∑–∞–ø—É—Å–∫-–∫–∞–∫-—Å–ª—É–∂–±—ã-–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ" aria-label="Permalink to &quot;–ó–∞–ø—É—Å–∫ –∫–∞–∫ —Å–ª—É–∂–±—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)&quot;">‚Äã</a></h3><p>–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ <code>/lib/systemd/system/suricata.service</code> –∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ override:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> edit</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> suricata</span></span></code></pre></div><p>–î–æ–±–∞–≤—å—Ç–µ:</p><div class="language-ini vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ini</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">[Service]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ExecStart</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ExecStart</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=/usr/bin/suricata -c /etc/suricata/suricata.yaml -q 0</span></span></code></pre></div><p>–ó–∞—Ç–µ–º:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> daemon-reload</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> enable</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> suricata</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> start</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> suricata</span></span></code></pre></div><hr><h2 id="üîç-—à–∞–≥-6-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ" tabindex="-1">üîç –®–∞–≥ 6: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ <a class="header-anchor" href="#üîç-—à–∞–≥-6-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ" aria-label="Permalink to &quot;üîç –®–∞–≥ 6: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ&quot;">‚Äã</a></h2><h3 id="—Ç–µ—Å—Ç-1-–ø–æ–ø—Ä–æ–±—É–∏—Ç–µ-–æ—Ç–∫—Ä—ã—Ç—å-youtube-–≤-–±—Ä–∞—É–∑–µ—Ä–µ" tabindex="-1">–¢–µ—Å—Ç 1: –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ—Ç–∫—Ä—ã—Ç—å YouTube –≤ –±—Ä–∞—É–∑–µ—Ä–µ <a class="header-anchor" href="#—Ç–µ—Å—Ç-1-–ø–æ–ø—Ä–æ–±—É–∏—Ç–µ-–æ—Ç–∫—Ä—ã—Ç—å-youtube-–≤-–±—Ä–∞—É–∑–µ—Ä–µ" aria-label="Permalink to &quot;–¢–µ—Å—Ç 1: –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ—Ç–∫—Ä—ã—Ç—å YouTube –≤ –±—Ä–∞—É–∑–µ—Ä–µ&quot;">‚Äã</a></h3><ul><li>–ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è HTTP (—Ä–µ–¥–∫–æ), –ø—Ä–∞–≤–∏–ª–æ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç.</li><li>–ï—Å–ª–∏ HTTPS ‚Äî Suricata –ø—Ä–æ–≤–µ—Ä–∏—Ç <strong>SNI</strong> –≤ TLS handshake –∏ <strong>–∑–∞–±–ª–æ–∫–∏—Ä—É–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ</strong>, –µ—Å–ª–∏ –ø—Ä–∞–≤–∏–ª–æ –∞–∫—Ç–∏–≤–Ω–æ.</li></ul><h3 id="—Ç–µ—Å—Ç-2-–ø—Ä–æ–≤–µ—Ä–∫–∞-—Ç–æ—Ä—Ä–µ–Ω—Ç-—Ç—Ä–∞—Ñ–∏–∫–∞" tabindex="-1">–¢–µ—Å—Ç 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ—Ä—Ä–µ–Ω—Ç-—Ç—Ä–∞—Ñ–∏–∫–∞ <a class="header-anchor" href="#—Ç–µ—Å—Ç-2-–ø—Ä–æ–≤–µ—Ä–∫–∞-—Ç–æ—Ä—Ä–µ–Ω—Ç-—Ç—Ä–∞—Ñ–∏–∫–∞" aria-label="Permalink to &quot;–¢–µ—Å—Ç 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ—Ä—Ä–µ–Ω—Ç-—Ç—Ä–∞—Ñ–∏–∫–∞&quot;">‚Äã</a></h3><p>–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–æ—Ä—Ä–µ–Ω—Ç-–∫–ª–∏–µ–Ω—Ç ‚Üí Suricata –¥–æ–ª–∂–µ–Ω –æ–±–Ω–∞—Ä—É–∂–∏—Ç—å —Å—Ç—Ä–æ–∫—É <code>BitTorrent</code> –∏ <strong>—Å–±—Ä–æ—Å–∏—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ</strong>.</p><h3 id="—Ç–µ—Å—Ç-3-–ø—Ä–æ—Å–º–æ—Ç—Ä-–ª–æ–≥–æ–≤" tabindex="-1">–¢–µ—Å—Ç 3: –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ <a class="header-anchor" href="#—Ç–µ—Å—Ç-3-–ø—Ä–æ—Å–º–æ—Ç—Ä-–ª–æ–≥–æ–≤" aria-label="Permalink to &quot;–¢–µ—Å—Ç 3: –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤&quot;">‚Äã</a></h3><p>–õ–æ–≥–∏ Suricata (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω—ã):</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tail</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/log/suricata/fast.log</span></span></code></pre></div><p>–ò–ª–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ –ø—Ä–∏ —Ä—É—á–Ω–æ–º –∑–∞–ø—É—Å–∫–µ ‚Äî –≤ –∫–æ–Ω—Å–æ–ª–∏.</p><hr><h2 id="üõ°Ô∏è-–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å-–∏-–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å" tabindex="-1">üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å <a class="header-anchor" href="#üõ°Ô∏è-–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å-–∏-–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å" aria-label="Permalink to &quot;üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å&quot;">‚Äã</a></h2><h3 id="—Å–æ–≤–µ—Ç—ã" tabindex="-1">–°–æ–≤–µ—Ç—ã: <a class="header-anchor" href="#—Å–æ–≤–µ—Ç—ã" aria-label="Permalink to &quot;–°–æ–≤–µ—Ç—ã:&quot;">‚Äã</a></h3><ul><li>–ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –ø—Ä–∞–≤–∏–ª ‚Äî —ç—Ç–æ —Å–Ω–∏–∂–∞–µ—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å.</li><li>–î–ª—è HTTPS –ø–æ–º–Ω–∏—Ç–µ: <strong>SNI –Ω–µ —à–∏—Ñ—Ä—É–µ—Ç—Å—è</strong>, –Ω–æ –≤ –±—É–¥—É—â–µ–º (—Å ESNI/ECH) —ç—Ç–æ –∏–∑–º–µ–Ω–∏—Ç—Å—è.</li><li>Suricata –ø–æ—Ç—Ä–µ–±–ª—è–µ—Ç CPU. –ù–∞ —Å–ª–∞–±—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, Raspberry Pi) –æ–≥—Ä–∞–Ω–∏—á—å—Ç–µ –æ–±—ä—ë–º —Ç—Ä–∞—Ñ–∏–∫–∞.</li><li>–†–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è–π—Ç–µ –ø—Ä–∞–≤–∏–ª–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —á–µ—Ä–µ–∑ <code>suricata-update</code>).</li></ul><p>–£—Å—Ç–∞–Ω–æ–≤–∫–∞ <code>suricata-update</code> (–µ—Å–ª–∏ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞):</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> suricata-update</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> suricata-update</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> suricata-update</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> enable-source</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> et/open</span></span></code></pre></div><blockquote><p>–ù–æ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –ø—Ä–∞–≤–∏–ª (<code>local.rules</code>) –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–µ –Ω—É–∂–Ω—ã.</p></blockquote><hr><h2 id="üß™-–ø—Ä–∏–º–µ—Ä-–ø–æ–ª–Ω—ã–∏-—Å—Ü–µ–Ω–∞—Ä–∏–∏-–¥–ª—è-–¥–æ–º–∞—à–Ω–µ–≥–æ-—à–ª—é–∑–∞" tabindex="-1">üß™ –ü—Ä–∏–º–µ—Ä: –ø–æ–ª–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π –¥–ª—è –¥–æ–º–∞—à–Ω–µ–≥–æ —à–ª—é–∑–∞ <a class="header-anchor" href="#üß™-–ø—Ä–∏–º–µ—Ä-–ø–æ–ª–Ω—ã–∏-—Å—Ü–µ–Ω–∞—Ä–∏–∏-–¥–ª—è-–¥–æ–º–∞—à–Ω–µ–≥–æ-—à–ª—é–∑–∞" aria-label="Permalink to &quot;üß™ –ü—Ä–∏–º–µ—Ä: –ø–æ–ª–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π –¥–ª—è –¥–æ–º–∞—à–Ω–µ–≥–æ —à–ª—é–∑–∞&quot;">‚Äã</a></h2><ol><li>–ú–∞—à–∏–Ω–∞ —Å –¥–≤—É–º—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞–º–∏: <code>eth0</code> (WAN), <code>eth1</code> (LAN).</li><li>–ù–∞—Å—Ç—Ä–æ–µ–Ω–∞ –ø–µ—Ä–µ–∞–¥—Ä–µ—Å–∞—Ü–∏—è IP:<div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tee</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /proc/sys/net/ipv4/ip_forward</span></span></code></pre></div></li><li>iptables:<div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">iptables</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -t</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nat</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -A</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> POSTROUTING</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -o</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> eth0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -j</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> MASQUERADE</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">iptables</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -A</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> FORWARD</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -i</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> eth1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -o</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> eth0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -j</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ACCEPT</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">iptables</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -A</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> FORWARD</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -i</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> eth0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -o</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> eth1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -m</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> state</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --state</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> RELATED,ESTABLISHED</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -j</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ACCEPT</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">iptables</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -I</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> FORWARD</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -j</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> NFQUEUE</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --queue-num</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span></span></code></pre></div></li><li>Suricata –∑–∞–ø—É—â–µ–Ω —Å <code>-q 0</code>.</li></ol><p>‚Üí –¢–µ–ø–µ—Ä—å <strong>–≤–µ—Å—å —Ç—Ä–∞—Ñ–∏–∫ LAN ‚Üí WAN</strong> –ø—Ä–æ—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ DPI –∏ —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç—Å—è!</p><h1 id="evebox" tabindex="-1">EveBox <a class="header-anchor" href="#evebox" aria-label="Permalink to &quot;EveBox&quot;">‚Äã</a></h1><p>EveBox is a web based Suricata &quot;EVE&quot; event viewer for Elastic Search.</p><ul><li>Homepage and documentation: <a href="https://evebox.org" target="_blank" rel="noreferrer">https://evebox.org</a></li></ul><p><img src="https://evebox.org/img/evebox-inbox-dark.png" alt="EveBox"></p><h2 id="features" tabindex="-1">Features <a class="header-anchor" href="#features" aria-label="Permalink to &quot;Features&quot;">‚Äã</a></h2><ul><li>A web based event viewer with an &quot;Inbox&quot; approach to alert management.</li><li>Event search.</li><li>An agent for sending Suricata events to the EveBox server (but you can use Filebeat/Logstash instead).</li><li>Embedded SQLite for self-contained installations.</li></ul><h2 id="requirements" tabindex="-1">Requirements <a class="header-anchor" href="#requirements" aria-label="Permalink to &quot;Requirements&quot;">‚Äã</a></h2><ul><li>Suricata - to generate alerts and events.</li></ul><p>And one of...</p><ul><li>An existing ElasticSearch/Logstash (version 7 or greater) setup already handling Suricata events (EveBox has issues with Filebeat indices at this time).</li><li>Just Elastic Search, using EveBox or the EveBox agent to add events.</li><li>Nothing - EveBox can use an embedded SQLite database suitable for lower load installations (note: not all features supported yet).</li><li>A modern web browser.</li></ul><h2 id="installation" tabindex="-1">Installation. <a class="header-anchor" href="#installation" aria-label="Permalink to &quot;Installation.&quot;">‚Äã</a></h2><p>Download a package and run the evebox application against your existing Elastic Search server.</p><p>Example:</p><pre><code>./evebox server -e http://localhost:9200
</code></pre><p>Then visit <a href="http://localhost:5636" target="_blank" rel="noreferrer">http://localhost:5636</a> with your browser.</p><p>Available downloads including RPM and Debian package repositories can be found at <a href="https://evebox.org/#downloads" target="_blank" rel="noreferrer">https://evebox.org/#downloads</a>.</p><h3 id="evectl" tabindex="-1">EveCtl <a class="header-anchor" href="#evectl" aria-label="Permalink to &quot;EveCtl&quot;">‚Äã</a></h3><p>EveCtl (<a href="https://evebox.org/evectl" target="_blank" rel="noreferrer">https://evebox.org/evectl</a>) is an easy way to get started with Suricata and EveBox on Linux machines. (Note: Podman or Docker required).</p><h3 id="clearndr-community-edition" tabindex="-1">ClearNDR Community Edition <a class="header-anchor" href="#clearndr-community-edition" aria-label="Permalink to &quot;ClearNDR Community Edition&quot;">‚Äã</a></h3><p>EveBox is included in the <a href="https://www.stamus-networks.com/clear-ndr-community" target="_blank" rel="noreferrer">ClearNDR Community Edition</a>.</p><h3 id="docker" tabindex="-1">Docker <a class="header-anchor" href="#docker" aria-label="Permalink to &quot;Docker&quot;">‚Äã</a></h3><p>If you wish to install EveBox with Docker an up to date image is hosted on Docker hub.</p><p>Example:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>docker pull jasonish/evebox:latest</span></span>
<span class="line"><span>docker run -it -p 5636:5636 jasonish/evebox:latest -e http://elasticsearch:9200</span></span></code></pre></div><p>replacing your <strong><a href="http://elasticsearch:9200" target="_blank" rel="noreferrer">http://elasticsearch:9200</a></strong> with that of your Elastic Search URL. You most likely do not want to use localhost here as that will be the localhost of the container, not of the host.</p><p>OR if you want to link to an already running Elastic Search container:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>docker run -it -p 5636:5636 --link elasticsearch jasonish/evebox:latest</span></span></code></pre></div><p>Then visit <a href="http://localhost:5636" target="_blank" rel="noreferrer">http://localhost:5636</a> with your browser.</p><h2 id="usage" tabindex="-1">Usage <a class="header-anchor" href="#usage" aria-label="Permalink to &quot;Usage&quot;">‚Äã</a></h2><p>EveBox runs as a server exposing a web interface on port 5636 by default.</p><h3 id="with-an-existing-elastic-search-server-with-events" tabindex="-1">With an Existing Elastic Search Server With Events <a class="header-anchor" href="#with-an-existing-elastic-search-server-with-events" aria-label="Permalink to &quot;With an Existing Elastic Search Server With Events&quot;">‚Äã</a></h3><p>The basic mode where <code>eve</code> events are being sent to Elastic Search with Logstash and or Filebeat.</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>evebox server -e http://elasticsearch:9200</span></span></code></pre></div><h3 id="with-the-embedded-sqlite-database" tabindex="-1">With the Embedded SQLite Database <a class="header-anchor" href="#with-the-embedded-sqlite-database" aria-label="Permalink to &quot;With the Embedded SQLite Database&quot;">‚Äã</a></h3><p>This is useful if you don&#39;t have Elastic Search and running EveBox on the same machine as Suricata. It uses an embedded SQLite database for events and is suitable for ligher loads. Currently SQLite does not support reporting.</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>evebox server -D . --datastore sqlite --input /var/log/suricata/eve.json</span></span></code></pre></div><p>More documentation can be found at <a href="http://evebox.readthedocs.io/en/latest/" target="_blank" rel="noreferrer">http://evebox.readthedocs.io/en/latest/</a>.</p><h2 id="building-evebox" tabindex="-1">Building EveBox <a class="header-anchor" href="#building-evebox" aria-label="Permalink to &quot;Building EveBox&quot;">‚Äã</a></h2><p>EveBox consists of a JavaScript frontend, and a backend written in Rust. To build Evebox the following requirements must first be satisfied:</p><ul><li>Node.js v18 or newer installed.</li><li>Latest Rust stable.</li></ul><p>First checkout EveBox:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>git clone https://github.com/jasonish/evebox.git ~/projects/evebox</span></span></code></pre></div><p>Then to build the binary:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>make</span></span></code></pre></div><p>Or to build a release package:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>make dist</span></span></code></pre></div><h3 id="possible-issues" tabindex="-1">Possible Issues <a class="header-anchor" href="#possible-issues" aria-label="Permalink to &quot;Possible Issues&quot;">‚Äã</a></h3><h2 id="run-in-development-mode" tabindex="-1">Run in Development Mode <a class="header-anchor" href="#run-in-development-mode" aria-label="Permalink to &quot;Run in Development Mode&quot;">‚Äã</a></h2><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>./dev.sh -e http://elasticsearch:9200</span></span></code></pre></div><p>to run in development mode using an Elastic Search datastore at <a href="http://elasticsearch:9200" target="_blank" rel="noreferrer">http://elasticsearch:9200</a>.</p><p>The connect your browser to <a href="http://localhost:4200" target="_blank" rel="noreferrer">http://localhost:4200</a>. Note this port is different than the EveBox port, as the Angular CLI/Webpack development server is used to serve up the web application with backend requests being proxied to the Go application.</p><p>In development mode changes to Go files will trigger a recompile/restart, and changes to the web app will trigger a recompile of the javascript and a browser refresh.</p>`,151)]))}const g=a(n,[["render",l]]);export{c as __pageData,g as default};
