import{_ as a,c as i,o as n,ag as e}from"./chunks/framework.D4Vqf8I7.js";const c=JSON.parse('{"title":"ZeroTier","description":"","frontmatter":{"outline":"deep"},"headers":[],"relativePath":"docs/wi/zerotier.md","filePath":"docs/wi/zerotier.md","lastUpdated":1763623794000}'),p={name:"docs/wi/zerotier.md"};function t(l,s,h,k,o,r){return n(),i("div",null,s[0]||(s[0]=[e(`<h1 id="zerotier" tabindex="-1">ZeroTier <a class="header-anchor" href="#zerotier" aria-label="Permalink to &quot;ZeroTier&quot;">​</a></h1><p><img src="https://www.zerotier.com/wp-content/uploads/2025/01/Default-OG-Image.jpg" alt=""></p><p>ZeroTier — это программное обеспечение с открытым исходным кодом, предназначенное для создания виртуальных частных сетей (VPN) на основе концепции «сети как услуги» (Network as a Service). Оно позволяет объединять устройства, находящиеся в разных физических сетях и географических локациях, в одну логическую сеть, как если бы они были подключены к одному локальному коммутатору. Это особенно полезно для удалённой работы, распределённых команд, IoT-устройств или гибридных облачных инфраструктур, где требуется безопасное и прозрачное сетевое взаимодействие.</p><p>Архитектура ZeroTier основана на децентрализованной модели с использованием глобальной распределённой системы управления, называемой планетой (Planet). Планета — это набор публичных корневых серверов (roots), которые обеспечивают начальное обнаружение узлов и маршрутизацию между ними. Каждая сеть в ZeroTier идентифицируется 64-битным идентификатором и управляется через веб-интерфейс или API. Администратор может настраивать правила доступа, IP-адресацию, маршруты и другие параметры, не требуя сложной настройки на каждом клиенте.</p><p>Когда устройство (нода) подключается к сети ZeroTier, оно получает виртуальный сетевой интерфейс с собственным MAC- и IP-адресом. Весь трафик между узлами шифруется с использованием современных криптографических протоколов (на основе Curve25519, Salsa20 и Poly1305), что обеспечивает высокий уровень безопасности. ZeroTier использует технологию peer-to-peer (P2P): как только узлы обнаруживают друг друга через корневые серверы, они стремятся установить прямое соединение, минуя центральные серверы, что снижает задержки и нагрузку на инфраструктуру.</p><p>Если прямое P2P-соединение невозможно (например, из-за NAT или файрволов), ZeroTier автоматически переключается на ретрансляцию трафика через промежуточные реле-серверы (relays), обеспечивая работоспособность сети в любых условиях. При этом вся логика маршрутизации и авторизации остаётся прозрачной для пользователя — достаточно установить клиент и присоединиться к нужной сети по её идентификатору.</p><p>ZeroTier поддерживает все основные операционные системы — Windows, macOS, Linux, Android, iOS, а также может работать на маршрутизаторах и встраиваемых устройствах. Это делает его универсальным решением для создания защищённых и масштабируемых сетей без необходимости в сложной настройке традиционных VPN-серверов или специализированного оборудования.</p><p>Важно отметить, что, несмотря на использование централизованных компонентов (планеты и реле), ZeroTier сохраняет контроль за сетью в руках её владельца: администратор полностью управляет политиками доступа, а трафик между доверенными узлами остаётся зашифрованным и не подвержен вмешательству со стороны третьих лиц, включая саму компанию ZeroTier. Это сочетание простоты, безопасности и гибкости делает ZeroTier популярным выбором как для частных пользователей, так и для корпоративных сред.</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>Ссылка на последнюю версю пакета для Альт Линукс <a href="https://git.altlinux.org/tasks/337183/build/100/x86_64/rpms/zerotier-one-1.12.2-alt1.x86_64.rpm" target="_blank" rel="noreferrer">https://git.altlinux.org/tasks/337183/build/100/x86_64/rpms/zerotier-one-1.12.2-alt1.x86_64.rpm</a></p><p>Сейчас последняя версия это 1.16.0, а для альта - 1.12.2, так как он был удалён из репозитория <a href="https://packages.altlinux.org/ru/sisyphus/srpms/zerotier-one/" target="_blank" rel="noreferrer">https://packages.altlinux.org/ru/sisyphus/srpms/zerotier-one/</a></p><p>Вот графический интерфейс контроллера: <a href="https://github.com/key-networks/ztncui" target="_blank" rel="noreferrer">https://github.com/key-networks/ztncui</a></p><p>Вот графический интерфейс клиента: <a href="https://github.com/zerotier/DesktopUI" target="_blank" rel="noreferrer">https://github.com/zerotier/DesktopUI</a></p></div><div class="danger custom-block"><p class="custom-block-title">Дублирую ссылки на мои пакеты</p><p>ZeroTier-One: <a href="https://raw.githubusercontent.com/bysnik/wiki/main/rpms/zerotier-one-1.16.0-alt1.x86_64.rpm" target="_blank" rel="noreferrer">zerotier-one-1.16.0-alt1.x86_64.rpm</a></p><p>ZeroTier-One NonFree: <a href="https://raw.githubusercontent.com/bysnik/wiki/main/rpms/zerotier-one-1.16.0-alt1.nf.x86_64.rpm" target="_blank" rel="noreferrer">zerotier-one-1.16.0-alt1.nf.x86_64.rpm</a></p><p>ZeroTier Desktop UI: <a href="https://raw.githubusercontent.com/bysnik/wiki/main/rpms/zerotier-desktop-ui-1.8.3-alt1.x86_64.rpm" target="_blank" rel="noreferrer">zerotier-desktop-ui-1.8.3-alt1.x86_64.rpm</a></p><p>ZTNCUI: <a href="https://raw.githubusercontent.com/bysnik/wiki/main/rpms/ztncui-0.8.14-alt1.x86_64.rpm" target="_blank" rel="noreferrer">ztncui-0.8.14-alt1.x86_64.rpm</a></p><p>Пишите, если будут ошибки)</p></div><p>Ниже описаны мои потуги по сборке последней версии ZeroTierOne для Альт Линукс П11 (версия 1.16.0 на момент написания статьи), а также пакетов DesktopUI и ztncui.</p><h2 id="сборка-rpm-пакета-zerotier-one" tabindex="-1">Сборка rpm-пакета ZeroTier-One <a class="header-anchor" href="#сборка-rpm-пакета-zerotier-one" aria-label="Permalink to &quot;Сборка rpm-пакета ZeroTier-One&quot;">​</a></h2><ol><li>Устновка необходимых пакетов (скорее всего тут перечислены не все)</li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">apt-get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rpmdevtools</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rpm-build</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gcc-c++</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> git-core</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gem-ronn-ng</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gem-ronn</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ronn</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> libstdc++-devel</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> libminiupnpc-devel</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rust</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rust-cargo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> udev-rules</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> clang</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> libssl-devel</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> libminiupnpc-devel</span></span></code></pre></div><ol start="2"><li>Не знаю почему, но я не использовал <code>GEAR</code>, так что собирал чисто с помощью <code>rpmbuild</code>. Подготавливаем дерево каталогов для сборки:</li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rpmdev-setuptree</span></span></code></pre></div><ol start="3"><li>Просто куда-нибудь клонируем два репозитория: один с исходниками и готовой спекой для 1.12.2 версии, и второй - последняя версия от разработчиков:</li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> clone</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://git.altlinux.org/gears/z/zerotier-one.git</span></span></code></pre></div><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> clone</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://github.com/zerotier/ZeroTierOne.git</span></span></code></pre></div><ol start="4"><li>Переходим в директорию с 1.12.2 версией и начинаем шаманить:</li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> zerotier-one</span></span></code></pre></div><ul><li>Редактируем спеку, меняем только версию (можно ещё changelog написать, если охота):</li></ul><div class="language-spec vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">spec</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Version: 1.16.0</span></span></code></pre></div><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>Для некоммерческого использования: в строку 58 добавляем параметр <code>ZT_NONFREE=1</code>:</p><div class="language-spec vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">spec</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>%make_build ZT_USE_MINIUPNPC=1 ZT_NONFREE=1 one</span></span></code></pre></div><p>При добавлении данного параметра должна произойти Non Free сборка, содержащая контролер, ранее же этот контроллер шёл в поставке свободно, теперь только так (подробнее об этом ниже).</p></div><ul><li>Копируем спеку в директорию сборки:</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> zerotier-one.spec</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~/RPM/SPECS/</span></span></code></pre></div><ul><li>Создаем директорию:</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mkdir</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> zerotier-one-development-1.16.0</span></span></code></pre></div><ul><li>Копируем какие-то растовские файлы:</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cp</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -R</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> zerotier-one/zeroidc</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> zerotier-one-development-1.16.0/</span></span></code></pre></div><ul><li>Проваливаемся в скопированные файлы:</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> zerotier-one-development-1.16.0/zeroidc</span></span></code></pre></div><ul><li>Генерируем директорию <code>vendor</code>:</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cargo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> vendor</span></span></code></pre></div><ul><li>Переносим сгенерированную директорию:</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mv</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ./vendor</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ../</span></span></code></pre></div><p>Должна получиться следующая структура:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">zerotier-one-development-1.16.0/</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">├──</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> vendor</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">└──</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> zeroidc</span></span></code></pre></div><ul><li>Поднимаемся на уровень выше:</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ..</span></span></code></pre></div><ul><li>Архивируем директорию и сразу переносим её в нашу сборочницу:</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tar</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cvf</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~/RPM/SOURCES/zerotier-one-development-1.16.0.tar</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> zerotier-one-development-1.16.0</span></span></code></pre></div><ol start="5"><li>Теперь работаем с исходниками.</li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ..</span></span></code></pre></div><ul><li>После клонирования должна быть директория <code>ZeroTierOne</code>. Переименовываем её:</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mv</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ZeroTierOne</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> zerotier-one-1.16.0</span></span></code></pre></div><ul><li>Архивируем директорию и сразу переносим её в нашу сборочницу:</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tar</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cvf</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~/RPM/SOURCES/zerotier-one-1.16.0.tar</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> zerotier-one-1.16.0</span></span></code></pre></div><ol start="6"><li>Если всё сделано правильно и я нигде не ошибся при описании, то можно проводить сборку пакета:</li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rpmbuild</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -ba</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~/RPM/SPECS/zerotier-one.spec</span></span></code></pre></div><ol start="7"><li>По завершению сборки должен появиться пакет <code>~/RPM/RPMS/x86_64/zerotier-one-1.16.0-alt1.x86_64.rpm</code>, который можно попробовать установить:</li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">apt-get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~/RPM/RPMS/x86_64/zerotier-one-1.16.0-alt1.x86_64.rpm</span></span></code></pre></div><ol start="8"><li>Проверьте его статус после установки (он не должен быть запущен) и действуйте дальше сами):</li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> status</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> zerotie-one</span></span></code></pre></div><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>Эта инструкция далеко не истина в последней инстанции. Собирал по наитию, как ёжик в тумане. А устанавливал этот пакет я вообще поверх уже установленной версии 1.12.2, и вот что плохое у меня случилось:</p><ol><li>После обновления, ztncui, не смотря на то, что увидел zerotier, выдает ошибку HTTPError: Response code 404 (Not Found), но при этом ZeroTier version 1.16.0 он определяет. Вот за это всё-таки обидно.</li></ol><p>P.S. по пункту 2:</p><p>Открыл я тут ZeroTier Release Notes 2025-08-21 -- Version 1.16.0 и вот что тут написано: <code>The network controller (\`controller/\`) is now under a commercial source-available license. Default binary builds no longer contain the controller.</code></p><p>То есть, он теперь идёт отдельно и не поставляется вместе с клиентом, который я собирал. Ну, теперь хотя бы понятно, почему вебморда контроллера не работает как надо)</p><p>Но при этом у меня продолжила спокойно работать сеть, созданная на сайте zerotier.com, панель управления увидила, что у меня последняя версия.</p><p>P.S.2 по пункту 2:</p><p>Контроллер по-прежнему существует в основном репозитории ZeroTierOne, но теперь находится в подкаталоге: <code>ZeroTierOne/nonfree/controller/</code></p><p>Для некоммерческого использования: можно попробовать собрать из исходников с <code>ZT_NONFREE=1</code>.</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">make</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ZT_NONFREE=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span></span></code></pre></div></div><div class="danger custom-block"><p class="custom-block-title">DANGER</p><p>В принципе, я считаю, что шалость удалась. Вот сама собранная rpm\`ка (без контроллера) если кому надо: <a href="https://raw.githubusercontent.com/bysnik/wiki/main/rpms/zerotier-one-1.16.0-alt1.x86_64.rpm" target="_blank" rel="noreferrer">zerotier-one-1.16.0-alt1.x86_64.rpm</a></p><p>Также, собрал Non Free версию: <a href="https://raw.githubusercontent.com/bysnik/wiki/main/rpms/zerotier-one-1.16.0-alt1.nf.x86_64.rpm" target="_blank" rel="noreferrer">zerotier-one-1.16.0-alt1.nf.x86_64.rpm</a></p></div><h2 id="desktop-ui" tabindex="-1">Desktop UI <a class="header-anchor" href="#desktop-ui" aria-label="Permalink to &quot;Desktop UI&quot;">​</a></h2><p>Соберём и сделаем автозапуск графического интерфейса, который будет висеть в трее. С помощью него можно подключаться к сетям и чёт там настраивать.</p><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>Была попытка сборка именно релиза 1.8.3, а не текущего состояния main ветки (6 октября 2025 года). Там у меня проблема с зависимостями, а именно <code>tauri-libappindicator-sys</code> требует именно <code>appindicator3</code> которого в Альте нет и ради которого делается патч (при сборке пакета).</p></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>Кстати, в репозитории уже несколько лет висит Pull Request на тоже самое, что мы тут патчим: <a href="https://github.com/zerotier/DesktopUI/pull/57" target="_blank" rel="noreferrer">https://github.com/zerotier/DesktopUI/pull/57</a></p></div><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>Для работы этого трея нужно, чтобы хотя бы единожды у пользователя, который запускает сервис, были права на sudo, потом их можно отключить. Иначе Вы увидите ошибку sudo (я тестил на чистой машине)</p></div><h3 id="сборка-руками-из-исходников" tabindex="-1">Сборка руками из исходников <a class="header-anchor" href="#сборка-руками-из-исходников" aria-label="Permalink to &quot;Сборка руками из исходников&quot;">​</a></h3><ol><li>Устанавливаем необходимые пакеты:</li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">apt-get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> meson</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ninja-build</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> libgtk+3-devel</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pkg-config</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> libayatana-appindicator3-devel</span></span></code></pre></div><ol start="2"><li>Клонируем репозиторий:</li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> clone</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://github.com/zerotier/DesktopUI.git</span></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>Кстати, без изменений этой инструкции, по состоянию на 6 октября 2025 года, можно собрать ветку 1.16.0 из этого же репозитория:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> clone</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -b</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1.16.0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://github.com/zerotier/DesktopUI.git</span></span></code></pre></div></div><ol start="3"><li>Переходим в корень склонированного репозитория. Дальше я никуда перемещаться не буду. Все пути будут описаны от этой точки.</li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DesktopUI</span></span></code></pre></div><ol start="4"><li>Редактируем файл <code>tray/Makefile</code> строки 24 и 25:</li></ol><div class="language-Makefile vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">Makefile</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">TRAY_CFLAGS := </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">$(</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">OPT_FLAGS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> -DTRAY_APPINDICATOR=1 </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">$(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">shell</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pkg-config --cflags appindicator3-0.1)</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> -std=c99</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">TRAY_LDFLAGS := </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">$(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">shell</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pkg-config --libs appindicator3-0.1)</span></span></code></pre></div><p>Необходимо заменить <code>appindicator3-0.1</code> на <code>ayatana-appindicator3-0.1</code>.</p><ol start="5"><li>Редактируем файл <code>tray/tray.h</code> строку 34</li></ol><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;libappindicator/app-indicator.h&gt;</span></span></code></pre></div><p>Необходимо заменить <code>libappindicator/app-indicator.h</code> на <code>libayatana-appindicator/app-indicator.h</code></p><ol start="6"><li>Редактируем файл <code>build.rs</code> строку 17:</li></ol><div class="language-rust vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">println!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;cargo:rustc-link-lib=dylib=appindicator3&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><p>Необходимо заменить <code>appindicator3</code> на <code>ayatana-appindicator3</code>.</p><ol start="7"><li>Начинаем процесс сборки:</li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">make</span></span></code></pre></div><ol start="8"><li>Далее будет настраивать автозапуск. Переносим собранный бинарный файл:</li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mv</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ./target/debug/zerotier_desktop_ui</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /usr/local/bin/</span></span></code></pre></div><ol start="9"><li>Будем создавать пользовательский юнит systemd. Создаём директорию для юнитов (если её нет):</li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mkdir</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~/.config/systemd/user</span></span></code></pre></div><ol start="10"><li>Создаём файл юнита:</li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nano</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~/.config/systemd/user/zerotier-desktop-ui.service</span></span></code></pre></div><ol start="11"><li>Вставляем следующее содержимое:</li></ol><div class="language-systemd vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">systemd</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">[Unit]</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">Description</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ZeroTier Desktop UI</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">After</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">graphical-session.target</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">PartOf</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">graphical-session.target</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">[Service]</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">Type</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">simple</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">ExecStart</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/usr/local/bin/zerotier_desktop_ui</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">Restart</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">on-failure</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">RestartSec</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">Environment</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">DISPLAY</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:0</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">Environment</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">XDG_RUNTIME_DIR</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/run/user/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">%U</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">[Install]</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">WantedBy</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">default.target</span></span></code></pre></div><ol start="12"><li>Перезагрузка конфигурации systemd для пользователя:</li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --user</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> daemon-reload</span></span></code></pre></div><ol start="13"><li>Включение автозапуска:</li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --user</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> enable</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> zerotier-desktop-ui.service</span></span></code></pre></div><ol start="14"><li>Запустк сервиса:</li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --user</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> start</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> zerotier-desktop-ui.service</span></span></code></pre></div><h3 id="собираем-rpm-пакет" tabindex="-1">Собираем rpm-пакет <a class="header-anchor" href="#собираем-rpm-пакет" aria-label="Permalink to &quot;Собираем rpm-пакет&quot;">​</a></h3><ol><li>Клонируем репозиторий:</li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> clone</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://github.com/zerotier/DesktopUI.git</span></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>Кстати, без изменений этой инструкции, по состоянию на 6 октября 2025 года, можно собрать ветку 1.16.0 из этого же репозитория:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> clone</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -b</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1.16.0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://github.com/zerotier/DesktopUI.git</span></span></code></pre></div></div><ol start="2"><li>Переименуйте директорию <code>DesktopUI</code> в <code>DesktopUI-1.8.3</code>:</li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mv</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DesktopUI</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DesktopUI-1.8.3</span></span></code></pre></div><ol start="3"><li>Создаём файл <code>zerotier-desktop-ui.spec</code></li></ol><div class="language-spec vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">spec</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Name:           zerotier-desktop-ui</span></span>
<span class="line"><span>Version:        1.8.3</span></span>
<span class="line"><span>Release:        alt1</span></span>
<span class="line"><span>Summary:        ZeroTier Desktop UI — system tray application for managing ZeroTier networks</span></span>
<span class="line"><span>Group:          Applications/Internet</span></span>
<span class="line"><span></span></span>
<span class="line"><span>License:        MPL-2.0</span></span>
<span class="line"><span>URL:            https://github.com/zerotier/DesktopUI</span></span>
<span class="line"><span></span></span>
<span class="line"><span># Build dependencies</span></span>
<span class="line"><span>BuildRequires:  meson</span></span>
<span class="line"><span>BuildRequires:  ninja-build</span></span>
<span class="line"><span>BuildRequires:  pkgconfig(gtk+-3.0)</span></span>
<span class="line"><span>BuildRequires:  pkgconfig(ayatana-appindicator3-0.1)</span></span>
<span class="line"><span>BuildRequires:  rust</span></span>
<span class="line"><span></span></span>
<span class="line"><span># Runtime dependencies</span></span>
<span class="line"><span>Requires:       zerotier-one</span></span>
<span class="line"><span></span></span>
<span class="line"><span># Патчи для совместимости с Ayatana AppIndicator</span></span>
<span class="line"><span>Patch0:         use-ayatana-appindicator.patch</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Source0:        %{name}-%{version}.tar</span></span>
<span class="line"><span></span></span>
<span class="line"><span>%description</span></span>
<span class="line"><span>ZeroTier Desktop UI is a system tray application that allows you to manage ZeroTier networks</span></span>
<span class="line"><span>from your desktop environment. This RPM builds the UI with Ayatana AppIndicator support.</span></span>
<span class="line"><span></span></span>
<span class="line"><span>%prep</span></span>
<span class="line"><span>%setup -q -n DesktopUI-%{version}</span></span>
<span class="line"><span></span></span>
<span class="line"><span># Применяем патч для замены appindicator → ayatana-appindicator</span></span>
<span class="line"><span>%patch0 -p1</span></span>
<span class="line"><span></span></span>
<span class="line"><span>%build</span></span>
<span class="line"><span># Сборка через make (внутри Makefile вызывается cargo и meson)</span></span>
<span class="line"><span>make %{?_smp_mflags}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>%install</span></span>
<span class="line"><span># Очистка</span></span>
<span class="line"><span>rm -rf %{buildroot}</span></span>
<span class="line"><span></span></span>
<span class="line"><span># Установка бинарника</span></span>
<span class="line"><span>install -Dm755 target/debug/zerotier_desktop_ui \\</span></span>
<span class="line"><span>    %{buildroot}%{_bindir}/zerotier_desktop_ui</span></span>
<span class="line"><span></span></span>
<span class="line"><span># Установка systemd user unit</span></span>
<span class="line"><span>install -Dm644 packaging/systemd/zerotier-desktop-ui.service \\</span></span>
<span class="line"><span>    %{buildroot}%{_userunitdir}/zerotier-desktop-ui.service</span></span>
<span class="line"><span></span></span>
<span class="line"><span>%files</span></span>
<span class="line"><span>%{_bindir}/zerotier_desktop_ui</span></span>
<span class="line"><span>%{_userunitdir}/zerotier-desktop-ui.service</span></span>
<span class="line"><span></span></span>
<span class="line"><span>%changelog</span></span>
<span class="line"><span>* Mon Oct 06 2025 Nikita Bystrov bystrovno@basealt.ru - 1.8.3-alt1</span></span>
<span class="line"><span>- Initial RPM package for ZeroTier Desktop UI with Ayatana AppIndicator support</span></span></code></pre></div><ol start="4"><li>Вам понадобится создать <strong>патч</strong>, который автоматизирует изменения, описанные в шагах 4–6 инструкции по ручной сборке:</li></ol><ul><li>Распакуйте исходники релиза во временную директорию (или скопируйте директорию <code>DesktopUI-1.8.3</code>)</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tar</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -xzf</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DesktopUI-1.8.3.tar.gz</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /tmp/DesktopUI-1.8.3</span></span></code></pre></div><p>Или</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DesktopUI-1.8.3/</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /tmp/DesktopUI-1.8.3</span></span></code></pre></div><ul><li>Перейдите в данную директорию</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /tmp/DesktopUI-1.8.3</span></span></code></pre></div><ul><li>Сохраните исходное состояние исходных файлов.</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> init</span></span></code></pre></div><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> add</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .</span></span></code></pre></div><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> commit</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -m</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;original&quot;</span></span></code></pre></div><ul><li>Внесите нужные изменения <strong>вручную</strong>:</li></ul><p><code>tray/Makefile</code>: Найдите строки с <code>appindicator3-0.1</code> и замените на <code>ayatana-appindicator3-0.1</code>:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sed</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -i</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;s/appindicator3-0.1/ayatana-appindicator3-0.1/g&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tray/Makefile</span></span></code></pre></div><p><code>tray/tray.h</code>: Замените заголовок:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sed</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -i</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;s|libappindicator/app-indicator.h|libayatana-appindicator/app-indicator.h|&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tray/tray.h</span></span></code></pre></div><p><code>build.rs</code>: Замените имя библиотеки:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sed</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -i</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;s/appindicator3/ayatana-appindicator3/&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build.rs</span></span></code></pre></div><ul><li>Сгенерируйте новый патч</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> diff</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~/RPM/SOURCES/use-ayatana-appindicator.patch</span></span></code></pre></div><ul><li>Проверьте патч</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /tmp/DesktopUI-1.8.3</span></span></code></pre></div><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> reset</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --hard</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # или удалите изменения</span></span></code></pre></div><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">patch</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~/RPM/SOURCES/use-ayatana-appindicator.patch</span></span></code></pre></div><p>Если нет ошибок — патч готов.</p><p>Должен получиться следующий патч <code>use-ayatana-appindicator.patch</code>:</p><div class="language-diff vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">diff</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">diff --git a/build.rs b/build.rs</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">index a332a99..e6edaab 100644</span></span>
<span class="line"><span style="--shiki-light:#B31D28;--shiki-dark:#FDAEB7;">--- a/build.rs</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+++ b/build.rs</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-light-font-weight:bold;--shiki-dark:#B392F0;--shiki-dark-font-weight:bold;">@@ -14,6 +14,6 @@</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> fn main() {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">         println!(&quot;cargo:rustc-link-lib=dylib=gdk-3&quot;);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">         println!(&quot;cargo:rustc-link-lib=dylib=gobject-2.0&quot;);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">         println!(&quot;cargo:rustc-link-lib=dylib=glib-2.0&quot;);</span></span>
<span class="line"><span style="--shiki-light:#B31D28;--shiki-dark:#FDAEB7;">-        println!(&quot;cargo:rustc-link-lib=dylib=appindicator3&quot;);</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+        println!(&quot;cargo:rustc-link-lib=dylib=ayatana-appindicator3&quot;);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">     }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">diff --git a/tray/Makefile b/tray/Makefile</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">index 2111412..2b6ed01 100644</span></span>
<span class="line"><span style="--shiki-light:#B31D28;--shiki-dark:#FDAEB7;">--- a/tray/Makefile</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+++ b/tray/Makefile</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-light-font-weight:bold;--shiki-dark:#B392F0;--shiki-dark-font-weight:bold;">@@ -21,8 +21,8 @@</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> else ifeq ($(shell uname -s),Linux)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 	else</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 		OPT_FLAGS := -Og</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 	endif</span></span>
<span class="line"><span style="--shiki-light:#B31D28;--shiki-dark:#FDAEB7;">-	TRAY_CFLAGS := $(OPT_FLAGS) -DTRAY_APPINDICATOR=1 $(shell pkg-config --cflags appindicator3-0.1) -std=c99</span></span>
<span class="line"><span style="--shiki-light:#B31D28;--shiki-dark:#FDAEB7;">-	TRAY_LDFLAGS := $(shell pkg-config --libs appindicator3-0.1)</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+	TRAY_CFLAGS := $(OPT_FLAGS) -DTRAY_APPINDICATOR=1 $(shell pkg-config --cflags ayatana-appindicator3-0.1) -std=c99</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+	TRAY_LDFLAGS := $(shell pkg-config --libs ayatana-appindicator3-0.1)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> else ifeq ($(shell uname -s),Darwin)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 	RM=rm -f</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 	LIB_NAME=libzt_desktop_tray.a</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">diff --git a/tray/tray.h b/tray/tray.h</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">index fe18fea..0ed4ffc 100644</span></span>
<span class="line"><span style="--shiki-light:#B31D28;--shiki-dark:#FDAEB7;">--- a/tray/tray.h</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+++ b/tray/tray.h</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-light-font-weight:bold;--shiki-dark:#B392F0;--shiki-dark-font-weight:bold;">@@ -31,7 +31,7 @@</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> void tray_update(struct tray *tray);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> #if defined(TRAY_APPINDICATOR)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> #include &lt;gtk/gtk.h&gt;</span></span>
<span class="line"><span style="--shiki-light:#B31D28;--shiki-dark:#FDAEB7;">-#include &lt;libappindicator/app-indicator.h&gt;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+#include &lt;libayatana-appindicator/app-indicator.h&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> #define TRAY_APPINDICATOR_ID &quot;tray-id&quot;</span></span></code></pre></div><ol start="5"><li>Создайте папку <code>DesktopUI-1.8.3/packaging/systemd/</code> в корне исходников (не <code>/tmp</code> !) и поместите туда файл <code>DesktopUI-1.8.3/packaging/systemd/zerotier-desktop-ui.service</code>:</li></ol><div class="language-systemd vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">systemd</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">[Unit]</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">Description</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ZeroTier Desktop UI</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">After</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">graphical-session.target</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">PartOf</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">graphical-session.target</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">[Service]</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">Type</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">simple</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">ExecStart</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/usr/bin/zerotier_desktop_ui</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">Restart</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">on-failure</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">RestartSec</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">Environment</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">DISPLAY</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:0</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">Environment</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">XDG_RUNTIME_DIR</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/run/user/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">%U</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">[Install]</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">WantedBy</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">default.target</span></span></code></pre></div><ol start="6"><li>Установите зависимости:</li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">apt-get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rpm-build</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> meson</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ninja-build</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gtk3-devel</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> libayatana-appindicator3-devel</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rust</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cargo</span></span></code></pre></div><ol start="7"><li>Подготовьте сборочницу, перенеся все подготовленные файлы:</li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> zerotier-desktop-ui.spec</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~/RPM/SPECS/</span></span></code></pre></div><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> use-ayatana-appindicator.patch</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~/RPM/SOURCES/</span></span></code></pre></div><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tar</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cvf</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~/RPM/SOURCES/zerotier-desktop-ui-1.8.3.tar</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DesktopUI-1.8.3/</span></span></code></pre></div><ol start="8"><li>Соберите:</li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rpmbuild</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -ba</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~/RPM/SPECS/zerotier-desktop-ui.spec</span></span></code></pre></div><div class="danger custom-block"><p class="custom-block-title">DANGER</p><p>В принципе, я считаю, что шалость2 удалась. Вот сама собранная rpmка (из ветки 1.16.0) если кому надо: <a href="https://raw.githubusercontent.com/bysnik/wiki/main/rpms/zerotier-desktop-ui-1.8.3-alt1.x86_64.rpm" target="_blank" rel="noreferrer">zerotier-desktop-ui-1.8.3-alt1.x86_64.rpm</a> (Вероятнее всего пакет вообще не установится без уже установленного <code>zerotier-one</code> и будет кричать, что пакет битый, так как <code>apt</code> не сможет сам удовлетворить зависимость)</p><p>Так, обнаружена проблемка, что это програ требует права sudo у твоего пользователя.</p></div><p>После установки пакета необходимо включить сервис:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --user</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> enable</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --now</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> zerotier-desktop-ui.service</span></span></code></pre></div><h2 id="ztncui" tabindex="-1">ztncui <a class="header-anchor" href="#ztncui" aria-label="Permalink to &quot;ztncui&quot;">​</a></h2><div class="danger custom-block"><p class="custom-block-title">DANGER</p><p>Вот собранный пакет: <a href="https://raw.githubusercontent.com/bysnik/wiki/main/rpms/ztncui-0.8.14-alt1.x86_64.rpm" target="_blank" rel="noreferrer">ztncui-0.8.14-alt1.x86_64.rpm</a> Так, ну вроде пакет рабочий, я исправил права доступа, теперь вроде как всё нормально</p></div><p>Данный пакет:</p><ul><li>Устанавливает приложение в <code>/opt/ztncui</code></li><li>Управляет службой через systemd (<code>ztncui.service</code>)</li></ul><ol><li>Убедитесь, что установлены необходимые пакеты для сборки и создано дерево сборки:</li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">apt-get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rpm-build</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nodejs</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> npm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gcc-c++</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> make</span></span></code></pre></div><ol start="2"><li>Также установите <code>node-gyp</code> глобально:</li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -g</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> node-gyp</span></span></code></pre></div><ol start="3"><li>Клонирование репозитория:</li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /tmp</span></span></code></pre></div><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> clone</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://github.com/key-networks/ztncui.git</span></span></code></pre></div><ol start="4"><li>Создаём архив исходников (имя должно соответствовать версии)</li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tar</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -czf</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~/RPM/SOURCES/ztncui-0.8.14.tar.gz</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ztncui</span></span></code></pre></div><ol start="5"><li>Создайте файл <code>~/RPM/SPECS/ztncui.spec</code> со следующим содержимым:</li></ol><div class="language-spec vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">spec</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Name:           ztncui</span></span>
<span class="line"><span>Version:        0.8.14</span></span>
<span class="line"><span>Release:        alt1</span></span>
<span class="line"><span>Summary:        ZeroTier Network Controller Web UI</span></span>
<span class="line"><span>License:        GPL-3.0-or-later</span></span>
<span class="line"><span>Group:          Applications/Internet</span></span>
<span class="line"><span></span></span>
<span class="line"><span>AutoReqProv:    no</span></span>
<span class="line"><span></span></span>
<span class="line"><span>URL:            https://github.com/key-networks/ztncui</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Source0: %{name}-%{version}.tar.gz</span></span>
<span class="line"><span></span></span>
<span class="line"><span># Зависимости</span></span>
<span class="line"><span>Requires: nodejs &gt;= 14</span></span>
<span class="line"><span>Requires: npm</span></span>
<span class="line"><span>Requires: zerotier-one</span></span>
<span class="line"><span></span></span>
<span class="line"><span>BuildRequires: npm</span></span>
<span class="line"><span>BuildRequires: gcc-c++</span></span>
<span class="line"><span>BuildRequires: make</span></span>
<span class="line"><span></span></span>
<span class="line"><span>%description</span></span>
<span class="line"><span>ztncui is a web-based user interface for managing a standalone ZeroTier network controller.</span></span>
<span class="line"><span></span></span>
<span class="line"><span>%prep</span></span>
<span class="line"><span>%setup -q -n %{name}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>%build</span></span>
<span class="line"><span>cd src</span></span>
<span class="line"><span>npm install --production</span></span>
<span class="line"><span></span></span>
<span class="line"><span>%install</span></span>
<span class="line"><span>rm -rf %{buildroot}</span></span>
<span class="line"><span></span></span>
<span class="line"><span># Основная установка в /opt</span></span>
<span class="line"><span>install -d %{buildroot}/opt/%{name}</span></span>
<span class="line"><span>cp -r . %{buildroot}/opt/%{name}/</span></span>
<span class="line"><span></span></span>
<span class="line"><span># Удаляем .git и ненужные файлы</span></span>
<span class="line"><span>rm -rf %{buildroot}/opt/%{name}/.git*</span></span>
<span class="line"><span></span></span>
<span class="line"><span># Создаём конфигурационный каталог</span></span>
<span class="line"><span>install -d %{buildroot}/etc/%{name}</span></span>
<span class="line"><span>install -d %{buildroot}/var/lib/%{name}</span></span>
<span class="line"><span></span></span>
<span class="line"><span># Systemd unit</span></span>
<span class="line"><span>install -d %{buildroot}%{_unitdir}</span></span>
<span class="line"><span>cat &gt; %{buildroot}%{_unitdir}/%{name}.service &lt;&lt; &#39;EOF&#39;</span></span>
<span class="line"><span>[Unit]</span></span>
<span class="line"><span>Description=ZeroTier Network Controller UI</span></span>
<span class="line"><span>After=network.target zerotier-one.service</span></span>
<span class="line"><span></span></span>
<span class="line"><span>[Service]</span></span>
<span class="line"><span>Type=simple</span></span>
<span class="line"><span>User=zerotier-one</span></span>
<span class="line"><span>Group=zerotier-one</span></span>
<span class="line"><span>WorkingDirectory=/opt/ztncui/src</span></span>
<span class="line"><span>EnvironmentFile=-/opt/ztncui/src/.env</span></span>
<span class="line"><span>ExecStart=/usr/bin/npm start</span></span>
<span class="line"><span>Restart=always</span></span>
<span class="line"><span>RestartSec=10</span></span>
<span class="line"><span></span></span>
<span class="line"><span>[Install]</span></span>
<span class="line"><span>WantedBy=multi-user.target</span></span>
<span class="line"><span>EOF</span></span>
<span class="line"><span></span></span>
<span class="line"><span>%post</span></span>
<span class="line"><span># Копируем passwd, если не существует</span></span>
<span class="line"><span>if [ ! -f /opt/ztncui/src/etc/passwd ]; then</span></span>
<span class="line"><span>    cp -v /opt/ztncui/src/etc/default.passwd /opt/ztncui/src/etc/passwd</span></span>
<span class="line"><span>    chown zerotier-one:zerotier-one /opt/ztncui/src/etc/passwd</span></span>
<span class="line"><span>    chmod 600 /opt/ztncui/src/etc/passwd</span></span>
<span class="line"><span>fi</span></span>
<span class="line"><span></span></span>
<span class="line"><span># Создаём .env, если не существует</span></span>
<span class="line"><span>if [ ! -f /opt/ztncui/src/.env ]; then</span></span>
<span class="line"><span>    ZT_TOKEN=$(cat /var/lib/zerotier-one/authtoken.secret 2&gt;/dev/null || echo &quot;YOUR_TOKEN_HERE&quot;)</span></span>
<span class="line"><span>    cat &gt; /opt/ztncui/src/.env &lt;&lt; EOF</span></span>
<span class="line"><span>ZT_TOKEN=$ZT_TOKEN</span></span>
<span class="line"><span>NODE_ENV=production</span></span>
<span class="line"><span>EOF</span></span>
<span class="line"><span>    chown zerotier-one:zerotier-one /opt/ztncui/src/.env</span></span>
<span class="line"><span>    chmod 600 /opt/ztncui/src/.env</span></span>
<span class="line"><span>fi</span></span>
<span class="line"><span></span></span>
<span class="line"><span># Перезагружаем systemd, чтобы увидеть новый unit</span></span>
<span class="line"><span>systemctl daemon-reload || :</span></span>
<span class="line"><span></span></span>
<span class="line"><span>%files</span></span>
<span class="line"><span>%attr(755, zerotier-one, zerotier-one) /opt/%{name}</span></span>
<span class="line"><span>%dir %attr(755, zerotier-one, zerotier-one) /etc/%{name}</span></span>
<span class="line"><span>%{_unitdir}/%{name}.service</span></span>
<span class="line"><span>%dir %attr(755, zerotier-one, zerotier-one) /var/lib/%{name}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>%changelog</span></span>
<span class="line"><span>* Tue Oct 07 2025 Nikita Bystrov bystrovno@basealt.ru - 0.8.14-alt1</span></span>
<span class="line"><span>- Initial RPM package for ALT Linux</span></span></code></pre></div><ol start="6"><li>Сборка RPM:</li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rpmbuild</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -ba</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~/RPM/SPECS/ztncui.spec</span></span></code></pre></div><ol start="7"><li>Если всё прошло успешно, RPM-пакет будет в:</li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ls</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -l</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~/RPM/RPMS/x86_64/ztncui-0.8.14-alt1.x86_64.rpm</span></span></code></pre></div><ol start="8"><li>Установка и запуск:</li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">apt-get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~/RPM/RPMS/ztncui-0.8.14-alt1.x86_64.rpm</span></span></code></pre></div><p>Убедитесь, что ZeroTier запущен</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> enable</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --now</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> zerotier-one</span></span></code></pre></div><p>Запустите ztncui</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> enable</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --now</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ztncui</span></span></code></pre></div><p>Проверьте статус</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> status</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ztncui</span></span></code></pre></div><p>Доступ к веб-интерфейсу:</p><p>По умолчанию:</p><ul><li>HTTP на <code>http://localhost:3000</code></li></ul><p>Также в файл <code>/opt/ztncui/src/.env</code> можно добавить следующее:</p><ul><li><code>HTTP_ALL_INTERFACES=yes</code> Приложение можно заставить прослушивать все интерфейсы для HTTP-запросов, установив <code>HTTP_ALL_INTERFACES</code> в <code>.env</code> файл.</li><li><code>HTTPS_PORT=3443</code></li><li><code>HTTPS_HOST=12.34.56.78</code> Приложение можно заставить прослушивать на определенном интерфейсе HTTPS-запросов, указав <code>HTTPS_HOST (имя хоста или IP-адрес интерфейса)</code> в <code>.env</code> файл. Если <code>HTTPS_HOST</code> не указан, но указано <code>HTTPS_PORT</code>, то приложение будет прослушивать запросы HTTPS на всех интерфейсах.</li></ul><div class="tip custom-block"><p class="custom-block-title">Важные замечания:</p><p><strong>authtoken.secret</strong>: Пакет пытается автоматически прочитать токен из <code>/var/lib/zerotier-one/authtoken.secret</code>. Убедитесь, что <code>zerotier-one</code> установлен и запущен <strong>до</strong> установки <code>ztncui</code> (Нужно, чтобы <code>zerotier-one</code> был собран вместе с контроллером, иначе, очевидно, работать не будет) (Вероятнее всего пакет вообще не установится без уже установленного <code>zerotier-one</code> и будет кричать, что пакет битый, так как <code>apt</code> не сможет сам удовлетворить зависимость).</p></div>`,175)]))}const g=a(p,[["render",t]]);export{c as __pageData,g as default};
