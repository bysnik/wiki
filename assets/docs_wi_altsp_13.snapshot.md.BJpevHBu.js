import{_ as r,c as i,o as l,ag as a}from"./chunks/framework.D4Vqf8I7.js";const e="/wiki/assets/createsnapshot.BRDmqJDT.png",f=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"docs/wi/altsp/13.snapshot.md","filePath":"docs/wi/altsp/13.snapshot.md","lastUpdated":1760696810000}'),p={name:"docs/wi/altsp/13.snapshot.md"};function s(n,t,o,w,g,h){return l(),i("div",null,t[0]||(t[0]=[a('<p>Операционная система должна обеспечивать возможность создания точек восстановления (снапшотов) для последующего возвращения системы к исходному состоянию в случае сбоя.</p><hr><p>ссылка на дркументацию</p><p>Установлен Timeshift, с настройками дисков по умолчанию работает в режиме rsync</p><p><img src="'+e+'" alt=""></p><p>Timeshift — программа для автоматического периодического создания копий системы (снимков/snapshots).</p><p>Timeshift предназначен прежде всего для создания снимков системных файлов и настроек. Пользовательские данные по умолчанию не архивируются поэтому в случае сбоя системы, восстанавливаются системные файлы, а данные пользователей остаются в актуальном состоянии (конечно, если они не были повреждены).</p><p>Резервные копии не могут быть восстановлены на уровне отдельных файлов, восстановление всегда происходит в полном объеме настроек Timeshift.</p><h2 id="настроика-резервного-копирования" tabindex="-1">Настройка резервного копирования <a class="header-anchor" href="#настроика-резервного-копирования" aria-label="Permalink to &quot;Настройка резервного копирования&quot;">​</a></h2><h3 id="режим-rsync" tabindex="-1">Режим RSYNC <a class="header-anchor" href="#режим-rsync" aria-label="Permalink to &quot;Режим RSYNC&quot;">​</a></h3><p>Особенности режима RSYNC:</p><ul><li>снимки создаются путём копирования системных файлов при помощи rsync и создания жёстких ссылок на неизмененные файлы из предыдущего снимка;</li><li>все файлы копируются при создании первого снимка. Последующие снимки являются инкрементальными. Неизменные файлы будут связаны с предыдущим снимком, если он доступен;</li><li>создание первого снимка может занять до 10 минут;</li><li>системный раздел может быть отформатирован в любой файловой системе. Резервный раздел может быть отформатирован в любой файловой системе Linux, поддерживающей жесткие ссылки. Сохранение снимков на несистемный или внешний диск позволяет восстановить систему, даже если системный диск повреждён;</li><li>можно задать исключения для файлов и каталогов для экономии дискового пространства;</li><li>систему необходимо перезагрузить после восстановления снимка.</li></ul><p>На вкладке «Тип» выбрать тип снимков:</p><p><a href="https://www.altlinux.org/%D0%A4%D0%B0%D0%B9%D0%BB:Timeshift-rsync-01.png" title="Выбор режима RSYNC" target="_blank" rel="noreferrer"><img src="https://www.altlinux.org/Images.www.altlinux.org/a/a4/Timeshift-rsync-01.png" alt="Выбор режима RSYNC"></a></p><p>Снимки имеют большой размер, поэтому желательно хранить их на другом диске или разделе. По умолчанию снимки сохраняются в системном (корневом) разделе в /timeshift, также можно выбрать другие разделы Linux.</p><p>На вкладке «Место» можно выбрать место, где будут храниться снимки:</p><p><a href="https://www.altlinux.org/%D0%A4%D0%B0%D0%B9%D0%BB:Timeshift-rsync-02.png" title="Выбор расположения снимков RSYNC" target="_blank" rel="noreferrer"><img src="https://www.altlinux.org/Images.www.altlinux.org/c/ca/Timeshift-rsync-02.png" alt="Выбор расположения снимков RSYNC"></a></p><p>На вкладке «Расписание» можно выбрать несколько уровней создания снимков (ежемесячно, еженедельно, ежедневно, ежечасно, при загрузке) и указать количество сохраняемых снимков для каждого уровня:</p><p><a href="https://www.altlinux.org/%D0%A4%D0%B0%D0%B9%D0%BB:Timeshift-rsync-03.png" title="Расписание для снимков RSYNC" target="_blank" rel="noreferrer"><img src="https://www.altlinux.org/Images.www.altlinux.org/f/f0/Timeshift-rsync-03.png" alt="Расписание для снимков RSYNC"></a></p><p>Снимки уровня «Загрузка» создаются при каждом запуске системы (с задержкой в 10 минут). Они выполняются в фоне и не влияют на скорость загрузки системы.</p><p>На вкладке «Пользователи» можно указать, включать ли в резервную копию пользовательские данные.</p><p>Т.к. Timeshift не предназначен для резервного копирования пользовательских данных, по умолчанию домашние каталоги пользователей не включаются в резервную копию. Это сделано для предотвращения перезаписи пользовательских данных во время восстановления, а также для уменьшения размера резервных копий.</p><p>Если выбрать опцию «Включить только скрытые файлы», будет выполнено резервное копирование и восстановление скрытых файлов и каталогов в домашнем каталоге пользователя (эти каталоги содержат пользовательские файлы конфигурации):</p><p><a href="https://www.altlinux.org/%D0%A4%D0%B0%D0%B9%D0%BB:Timeshift-rsync-04.png" title="Вкладка «Пользователи»" target="_blank" rel="noreferrer"><img src="https://www.altlinux.org/Images.www.altlinux.org/9/9b/Timeshift-rsync-04.png" alt="Вкладка «Пользователи»"></a></p><p>На вкладке «Фильтры» можно выборочно указать, какие файлы/каталоги включать/исключать из резервного копирования (динамические каталоги исключаются по умолчанию: /dev, /proc, …):</p><p><a href="https://www.altlinux.org/%D0%A4%D0%B0%D0%B9%D0%BB:Timeshift-rsync-05.png" title="Вкладка «Фильтры»" target="_blank" rel="noreferrer"><img src="https://www.altlinux.org/Images.www.altlinux.org/8/88/Timeshift-rsync-05.png" alt="Вкладка «Фильтры»"></a></p><p>В данном примере из резервного копирования будут исключены все файлы mp3, все системные журналы, кроме журналов веб-сервера apache.</p><p>Редактировать шаблон можно дважды щелкнув левой кнопкой мыши по строке шаблона.</p><p><strong>Примечание:</strong> При переборе шаблонов, срабатывает первое правило под которое подпадает текущий путь.</p><ul><li>&#39;*&#39; в шаблоне соответствует любому компоненту пути кроме &quot;/&quot;;</li><li>&#39;**&#39; в шаблоне соответствует любому компоненту пути, включая &quot;/&quot;.</li></ul><p>Например:</p><ul><li>/mydir/ — каталог mydir (но не его содержимое);</li><li>/mydir/* — все файлы и каталоги в mydir (но не содержимое вложенных каталогов);</li><li>/mydir/** — все файлы и каталоги в mydir (включая содержимое вложенных каталогов, рекурсивно);</li><li>/mydir/*** — соответствует как каталогу mydir (как если бы было указано «/mydir/»), так и всему содержимому этого каталога (как если бы было указано «/mydir/**»).</li></ul><p>Для того чтобы исключить из снимка содержимое каталога, но сам каталог оставить, нужно указать в шаблоне &#39;/mydir/**&#39;, а не &#39;/mydir/&#39; (для каталога указание &quot;/&quot; в конце обязательно).</p><p>Шаблон не начинающийся с &#39;/&#39; проверяется с конца строки.</p><p>Если шаблон начинается на &quot;+&quot;, то он рассматривается как включающий шаблон.</p><p>Подробнее см. <strong>man rsync</strong>.</p><p><strong>Примечание:</strong> Не рекомендуется включать пользовательские данные в резервные копии, так как они будут перезаписаны при восстановлении снимка.</p><p>Просмотреть итоговый список исключений можно, нажав кнопку «Итог» на вкладке «Фильтры»:</p><p><a href="https://www.altlinux.org/%D0%A4%D0%B0%D0%B9%D0%BB:Timeshift-rsync-06.png" title="Итоговый список исключений" target="_blank" rel="noreferrer"><img src="https://www.altlinux.org/Images.www.altlinux.org/9/93/Timeshift-rsync-06.png" alt="Итоговый список исключений"></a></p><h3 id="режим-btrfs" tabindex="-1">Режим BTRFS <a class="header-anchor" href="#режим-btrfs" aria-label="Permalink to &quot;Режим BTRFS&quot;">​</a></h3><p>Особенности режима BTRFS:</p><ul><li>снимки создаются с использованием встроенных средств файловой системы BTRFS;</li><li>снимки создаются и восстанавливаются мгновенно (создание снимков — это атомарная транзакция на уровне файловой системы);</li><li>снимки восстанавливаются путём замены системных подразделов. Поскольку файлы никогда не копируются, не удаляются и не перезаписываются, риск потери данных отсутствует. Существующая система сохраняется как новый снимок после восстановления;</li><li>снимки сохраняются на том же диске, с которого они созданы (системном диске). Хранение на других дисках не поддерживается. Если системный диск выйдет из строя, снимки, хранящиеся на нём, будут потеряны вместе с системой;</li><li>нет возможности исключать файлы и каталоги;</li><li>размер снимков BTRFS изначально равен нулю. При изменении системных файлов, данные записываются в новые блоки данных, которые занимают дисковое пространство (копирование при записи). Файлы в снимке продолжают указывать на исходные блоки данных;</li><li>ОС должна быть установлена на раздел BTRFS с разбивкой на подразделы @ и @home (см. <a href="https://www.altlinux.org/Btrfs" title="Btrfs" target="_blank" rel="noreferrer">Btrfs</a>). Другие виды разделов не поддерживаются;</li><li>снимки можно восстановить без немедленной перезагрузки запущенной системы.</li></ul><p>На вкладке «Тип» выбрать тип снимков:</p><p><a href="https://www.altlinux.org/%D0%A4%D0%B0%D0%B9%D0%BB:Timeshift-btrfs-01.png" title="Выбор режима BTRFS" target="_blank" rel="noreferrer"><img src="https://www.altlinux.org/Images.www.altlinux.org/e/e1/Timeshift-btrfs-01.png" alt="Выбор режима BTRFS"></a></p><p>Настоятельно рекомендуется использовать моментальные снимки BTRFS в системах, установленных в разделе BTRFS.</p><p>На вкладке «Место» указать устройство, где будут храниться снимки:</p><p><a href="https://www.altlinux.org/%D0%A4%D0%B0%D0%B9%D0%BB:Timeshift-btrfs-02.png" title="Выбор расположения снимков BTRFS" target="_blank" rel="noreferrer"><img src="https://www.altlinux.org/Images.www.altlinux.org/c/c5/Timeshift-btrfs-02.png" alt="Выбор расположения снимков BTRFS"></a></p><p>На вкладке «Расписание» можно выбрать несколько уровней создания снимков (ежемесячно, еженедельно, ежедневно, ежечасно, при загрузке) и указать количество сохраняемых снимков для каждого уровня:</p><p><a href="https://www.altlinux.org/%D0%A4%D0%B0%D0%B9%D0%BB:Timeshift-btrfs-03.png" title="Расписание для снимков BTRFS" target="_blank" rel="noreferrer"><img src="https://www.altlinux.org/Images.www.altlinux.org/4/40/Timeshift-btrfs-03.png" alt="Расписание для снимков BTRFS"></a></p><p>Снимки уровня «Загрузка» создаются при каждом запуске системы (с задержкой в 10 минут). Они выполняются в фоне и не влияют на скорость загрузки системы.</p><p>Т.к. Timeshift не предназначен для резервного копирования пользовательских данных, по умолчанию домашние каталоги пользователей не включаются в резервную копию. На вкладке «Пользователи» можно включить подраздел @home в создаваемые снимки:</p><p><a href="https://www.altlinux.org/%D0%A4%D0%B0%D0%B9%D0%BB:Timeshift-btrfs-04.png" title="Домашние каталоги пользователей BTRFS" target="_blank" rel="noreferrer"><img src="https://www.altlinux.org/Images.www.altlinux.org/a/a4/Timeshift-btrfs-04.png" alt="Домашние каталоги пользователей BTRFS"></a></p>',52)]))}const B=r(p,[["render",s]]);export{f as __pageData,B as default};
