Подсистема контроля целостности операционной системы должна поддерживать технологии IMA и EVM. 

___

https://www.altlinux.org/IMA_EVM
[[ЛКНВ.11100-01 99 03 Руководство по комплексу средств защиты.pdf]], стр 122-129

==Поднят стенд: IMA EVM==

1) Изменить параметры монтирования файловой системы. Для этого следует выставить параметр `iversion` на всех записях в файле `/etc/fstab` относящихся к местам, где могут быть исполняемые файлы

```bash
vim /etc/fstab 
# UUID=c7834d14-d0f0-4d70-94f5-f1ce09fda00c / ext4 relatime,iversion 1 1 
# UUID=16b090bf-8b7a-4e69-8df6-6a4374f3d550 /home ext4 noexec,nosuid,relatime,iversion 1 2
```

2) Настроить контроль целостности. Желаемый алгоритм хеширования (SHA или ГОСТ) можно выбрать в файле `/etc/integrity/config`. Там же можно включить EVM в дополнение к IMA. Для изменения алгоритма хеширования необходимо изменить значение переменной `HASH_ALGO` в файле `/etc/integrity/config`, например, заменить `HASH_ALGO="sha512"` на `HASH_ALGO="streebog512"`. Если необходимо выполнить активацию EVM, то следует раскоментировать строку: `WITH_EVM=yes`

3) Запустить инициализацию подсистем контроля целостности в автоматическом режиме: 
```bash
integrity-applier --auto
```

4) После перезагрузки системы войти в систему и проверить параметры командной строки ядра:
```bash
cat /proc/cmdline 
# BOOT_IMAGE=/boot/vmlinuz root=UUID=19124d73-ad8b-4b83- ba28-350312a1b7f7 ro panic=30 init_on_free=1 loglevel=3 splash lsm=integrity quiet ima_hash=streebog512 ima_appraise=enforce
```

В командной строке ядра должен присутствовать параметр `ima_appraise=enforce` – система находится в режиме оценки контроля целостности;

5) Добавить в автозагрузку и включить службы: 
```bash
systemctl enable --now integrity-scanner.service integrity-notifier.service ima-check.service
```

6) Проверить наличие маркировки у файла можно, выполнив команду (пример для `/usr/bin/less`):
```bash
getfattr -m - -d /usr/bin/less
echo /usr/bin/less | integrity-sign --stdin --verbose --verify --with-evm
evmctl -v ima_verify /usr/bin/less
```

Строка `security.ima=...` свидетельствует о том, что файл маркирован. 

В журнале записи, связанные с нарушением целостности можно просмотреть командой: 

```bash
journalctl -r | grep INTEGRITY_DATA
```