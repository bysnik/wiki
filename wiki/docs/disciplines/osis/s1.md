---
outline: deep
---

### 1. Установка Arch Linux
Раздел:  
Тема:    
Количество часов: 2  
Задачи:   
Порядок выполнения работы:  

## Предисловние

Данная самостаятельная работа является руководством по установке Arch Linux с помощью системы, загруженной с официальным установочным образом.

Более подробные инструкции приведены в соответствующих статьях ArchWiki и на страницах справочных руководств (man) различных программ. Также вы можете получить помощь в IRC-канале и на англоязычном и русскоязычном форумах Arch Linux.

Arch Linux способен работать на любой x86_64-совместимой машине, имеющей хотя бы 512 МиБ ОЗУ, однако понадобится больше памяти для загрузки live-системы. Базовая установка занимает меньше 2 ГиБ дискового пространства. Поскольку для процесса установки требуется получать пакеты из удалённого репозитория, необходимо работающее интернет-соединение.

## Разметка дисков

Когда запущенная система распознает накопители, они становятся доступны как блочные устройства, например, `/dev/sda`, `/dev/nvme0n1` или `/dev/mmcblk0`. Чтобы посмотреть их список, используйте `lsblk` или `fdisk`:
```bash
fdisk -l
```

Результаты, оканчивающиеся на `rom`, `loop` и `airoot`, можно игнорировать.

Необходимо выбрать блочное устройство на которое планируется установка системы.

Используйте `fdisk` чтобы разметить диск:
```bash
fdisk /dev/диск_для_разметки
```
Создайте два раздела: основной раздел системы и SWAP раздел 

## Форматирование разделов

Когда новые разделы созданы, каждый из них необходимо отформатировать в подходящую файловую систему.

Например, чтобы отформатировать `/dev/корневой_раздел` в Ext4, выполните следующую команду:
```bash
mkfs.ext4 /dev/корневой_раздел
```

Если вы создали раздел для подкачки (swap), инициализируйте его с помощью утилиты `mkswap`:
```bash
mkswap /dev/раздел_подкачки
```

## Монтирование разделов

Смонтируйте корневой раздел в каталог `/mnt`. Например, если корневой раздел — `/dev/корневой_раздел`, выполните следующую команду:
```bash
mount /dev/корневой_раздел /mnt
```

Создайте точки монтирования для всех остальных разделов (например, `/mnt/efi`) и примонтируйте соответствующие разделы.
::: tip Совет
Команда `mount`, запущенная с опцией `--mkdir`, автоматически создаст требуемую точку монтирования. Можно создать их и вручную с помощью `mkdir`.
:::

Если вы ранее создали раздел подкачки (swap), активируйте его с помощью `swapon`:
```bash
swapon /dev/раздел_подкачки
```

В дальнейшем `genfstab` обнаружит смонтированные файловые системы и пространство подкачки.

## Установка

### Выбор зеркал

Пакеты для установки должны скачиваться с серверов-зеркал, прописанных в файле `/etc/pacman.d/mirrorlist`. В установочном образе, после подключения к сети, `reflector` обновит список зеркал (выбрав 20 наиболее актуальных HTTPS-зеркал) и отсортирует их по скорости загрузки.

Чем выше зеркало расположено в списке, тем больший приоритет оно имеет при скачивании пакета. Вы можете проверить этот файл и, при необходимости, отредактировать его вручную, переместив наверх наиболее географически близкие зеркала. При этом также учитывайте и другие критерии.

Позже `pacstrap` скопирует этот файл в новую систему, так что это действительно стоит сделать.
Установка основных пакетов


## Установка пакетов

Используйте скрипт `pacstrap`, чтобы установить пакет `base`, ядро `Linux` и прошивки часто встречающихся устройств:
```bash
pacstrap -K /mnt base linux linux-firmware dhcpcd nano openssh
```
::: tip Совет
В случае проблем с pgp key используйте:
```bash
pacman -Sy archlinux-keyring
```
:::

::: tip Совет
`linux` можно заменить на другой желаемый пакет ядра. Можно вообще не устанавливать ядро, если установка происходит в контейнере.

Можно пропустить установку пакета прошивок, если установка происходит в контейнере или виртуальной машине.

Пакет `base` содержит не все инструменты, имеющиеся на установочном носителе, из-за чего может потребоваться установка дополнительных пакетов для получения полностью функциональной базовой системы. В частности, вам могут пригодиться следующие программы:
- утилиты для управления файловыми системами в пользовательском пространстве, которые будут использоваться в системе,
- утилиты для доступа к RAID- или LVM-разделам,
- специфические прошивки других устройств, не включённые в `linux-firmware` (например, `sof-firmware` для некоторых звуковых карт),
- ПО, необходимое для организации сети (например, менеджер сети или DHCP-клиент),
- текстовый редактор,
- пакеты для доступа к документации в `man` и `info`: `man-db`, `man-pages` и `texinfo`.

Чтобы установить другие пакеты или группы, добавьте их названия к команде pacstrap (разделяя их пробелом) или используйте pacman во время этапа #Chroot. Список пакетов, присутствующих в установочном образе, доступен на странице `pkglist.x86_64.txt`.
:::

## Настройка системы

### Fstab

Сгенерируйте файл `fstab` (используйте ключ `-U` или `-L`, чтобы для идентификации разделов использовались UUID или метки, соответственно):
```bash
genfstab -U /mnt >> /mnt/etc/fstab
```
После этого проверьте файл `/mnt/etc/fstab` и отредактируйте его в случае необходимости.

### Chroot

Перейдите к корневому каталогу новой системы:
```bash
arch-chroot /mnt
```

### Часовой пояс

Задайте часовой пояс:
```bash
ln -sf /usr/share/zoneinfo/Регион/Город /etc/localtime
```

Запустите `hwclock`, чтобы сгенерировать `/etc/adjtime`:
```bash
hwclock --systohc
```

Эта команда предполагает, что аппаратные часы настроены в формате UTC.

### Пароль суперпользователя

Установите пароль суперпользователя:
```bash
passwd
```

## Загрузчик GRUB2

### Установка пакета

Файлы и утилиты для установки GRUB2 содержатся в пакете `grub`, и устанавливаются командой:
```bash
pacman -S grub
```

### Установка загрузчика

#### Установка BIOS-версии загрузчика

Для установки GRUB2 нужно выполнить команду от root:
```bash
grub-install /dev/sda
```
- где `/dev/sda` это устройство ***(не раздел!)*** для установки загрузочных образов GRUB. Файлы загрузчика будут установлены в каталог `/boot`. Код GRUB (`boot.img`) будет встроен в начальный сектор, а загрузочный образ `core.img` – в просвет перед первым разделом MBR, или BIOS boot partition для GPT.

Если при выполнении команды происходит ошибка, попробуйте добавить `--recheck` в аргументы как показано ниже:
```bash
grub-install --recheck /dev/sda
```

### После установки

В настоящее время GRUB2, сразу после установки, готов к работе только в режиме консоли. (Это будет продолжаться до тех пор, пока мейнтейнеры пакета "grub" не заменят бессмысленный дефолтный файл конфигурации загрузчика на рабочую статическую или автоматически генерируемую версию.)

Чтобы получить при загрузке действующее меню GRUB2, требуется заменить файл `grub.cfg` самостоятельно.

### Генерация конфига

Команда `grub-mkconfig` может быть использована для генерации файла `grub.cfg`.

Для автоматического обнаружения ОС отличных от Linux установите пакет `os-prober`. Если после установки пакета `os-prober` автоматическое обнаружение не работает должным образом, то может потребоваться установка пакета `hwinfo`.
Чтобы применить изменения, запустите команду:
```bash
grub-mkconfig -o /boot/grub/grub.cfg
```

Она не только создаст файл `/boot/grub/grub.cfg`, но и проверит конфигурацию на наличие ошибок.

::: warning Важно
Если вы запускаете конфигуратор при установке Arch Linux, убедитесь, что вы делаете это внутри `arch-chroot`, иначе программа будет читать и записывать файлы конфигурации текущей, а не устанавливаемой системы.
:::

## Перезагрузка

Выйдите из окружения chroot, набрав `exit` или нажав `Ctrl+d`.

Вы можете размонтировать все разделы с помощью команды:
```bash
umount -R /mnt
```

Теперь перезагрузите компьютер, набрав `reboot`: если какие-нибудь разделы остались смонтированными, `systemd` их размонтирует. Не забудьте извлечь установочный носитель. После загрузки войдите в систему в качестве суперпользователя.


## **Контрольные вопросы по теме: Установка Arch Linux**

### **1. Общие сведения**
1. Какие минимальные системные требования для установки Arch Linux?  
2. Зачем нужен работающий интернет-доступ при установке Arch Linux?  
3. Что представляет собой live-система при установке Arch Linux?  
4. Где можно найти официальную документацию по установке Arch Linux?  

### **2. Разметка дисков**
5. Какие команды можно использовать для просмотра списка доступных блочных устройств?  
6. Как определить, какой диск использовать для установки системы?  
7. Какие типы разделов необходимо создать при установке Arch Linux (минимальный набор)?  
8. Какая команда используется для разметки диска в интерактивном режиме?  
9. Почему при установке GRUB в режиме BIOS важно указывать не раздел, а само устройство (например, `/dev/sda`, а не `/dev/sda1`)?  

### **3. Форматирование и монтирование**
10. Какая команда используется для форматирования раздела в файловую систему ext4?  
11. Что делает команда `mkswap` и для какого раздела она применяется?  
12. Как активировать swap-раздел после его создания?  
13. В какую директорию монтируется корневой раздел при установке?  
14. Какая опция команды `mount` позволяет автоматически создать точку монтирования?  

### **4. Установка пакетов**
15. Что делает утилита `pacstrap`?  
16. Какие пакеты устанавливаются командой:  
```bash
pacstrap -K /mnt base linux linux-firmware dhcpcd nano openssh
```  
17. Зачем нужно обновлять `archlinux-keyring` при возникновении ошибок с PGP-ключами?  
18. Можно ли установить Arch Linux без ядра? В каком случае это допустимо?  
19. Какие дополнительные пакеты могут понадобиться для полноценной базовой системы?  

### **5. Настройка системы**
20. Как сгенерировать файл `/etc/fstab`? Какой ключ рекомендуется использовать и почему?  
21. Для чего используется команда `arch-chroot` и когда она применяется?  
22. Как установить часовой пояс в Arch Linux? Приведите пример команды.  
23. Какая команда синхронизирует системные часы с аппаратными?  
24. В каком формате предполагается, что работают аппаратные часы при выполнении `hwclock --systohc`?  
25. Как установить пароль для пользователя root?  

### **6. Загрузчик GRUB**
26. Какой пакет необходимо установить для работы с GRUB2?  
27. Какая команда устанавливает загрузчик GRUB2 на диск в режиме BIOS?  
28. Что делает опция `--recheck` в команде `grub-install`?  
29. Почему после установки GRUB2 требуется вручную генерировать `grub.cfg`?  
30. Какая команда генерирует конфигурационный файл GRUB?  
31. Какой пакет нужен для обнаружения других операционных систем при генерации `grub.cfg`?  
32. Почему важно запускать `grub-mkconfig` внутри `arch-chroot`?  

### **7. Завершение установки**
33. Как выйти из окружения `chroot`?  
34. Как размонтировать все разделы перед перезагрузкой?  
35. Что произойдёт, если не извлечь установочный носитель после перезагрузки?  
